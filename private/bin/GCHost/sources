TARGETNAME=GCHost
TARGETTYPE=PROGRAM
UMENTRY = wmain
UMTYPE = console

!if defined(_CHAKRA_UCRT_BUILD)
USE_UNICRT=1
USE_MSVCRT=1
!endif

USE_NOTHROW_NEW=1


!IF "$(_BUILDARCH)" == "arm" || "$(_BUILDARCH)" == "arm64"
NT_SIGNCODE=1
TEST_CODE=1
!ENDIF

# Turns on fretest for test code
!include $(JSCRIPT_ROOT)\jslibtest.inc

INCLUDES= \
    $(COREINCLUDES); \

# Make sure that common.memory.lib is passed to linker prior to msvcrt so that our new/delete
# do not cause 'already defined in msvcrt.lib error'.
CRTLIBS= \
    $(OBJECT_JSCRIPT_DIR)\private\lib\MemProtectHeap\static\$(JS_LIBTYPE)\$(O)\JScript.MemProtectHeap.static.lib

LINKLIBS= \
   $(JS_LIBS_COMMON)

# Libs needed
# oleaut32: Needed for SysAllocString used by CmdParser
# version: Needed by AutoSystemInfo to get version information
# Debug only:
# dbghelp: Needed by Js::Throw::GenerateDump
# user32: Needed by Js::Throw::ReportAssert to show a message box

TARGETLIBS=     \
!if !$(FREEBUILD)
    $(SDK_LIB_PATH)\dbghelp.lib \
    $(MINCORE_PRIV_SDK_LIB_VPATH)\ext-ms-win-ntuser-dialogbox-l1.lib \
!endif
    $(ONECORE_SDK_LIB_VPATH)\onecore.lib \
    $(SDK_LIB_PATH)\ntdll.lib \

DELAYLOAD = \
    oleaut32.dll; \
!IF (!$(FREEBUILD))
    ext-ms-win-ntuser-dialogbox-l1.dll; \
!ENDIF

ALLOW_NT_STYLE_DLOAD_ERROR_HANDLER=1
DLOAD_ERROR_HANDLER=kernelbase.dll

SOURCES= \
    GCHost.cpp \
    DefaultResource.rc # Autogenerated file name + version for Device Guard whitelisting effort

PRECOMPILED_INCLUDE=stdafx.h
PRECOMPILED_SOURCEFILE=stdafx.cpp
PRECOMPILED_CXX=1

# Autogenerated. Sets file name for Device Guard whitelisting effort, used in RC.exe.
C_DEFINES=$(C_DEFINES) -D___TARGETNAME="""$(TARGETNAME).$(TARGETTYPE)"""
MUI_VERIFY_NO_LOC_RESOURCE=1

