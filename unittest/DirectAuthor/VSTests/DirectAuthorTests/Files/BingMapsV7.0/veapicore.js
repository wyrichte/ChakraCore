Microsoft.Maps.Gimme=function(){var b=function(){var c,b,a,e,j,n;function u(b,a,c){return e[a](b,c)}function s(e,a){var b=[],d=a.length;do{var c=h(e,a[--d]||a);c&&b.push(c)}while(d);return b}function h(c,b){if(c===document||!b)return b;var a=b;while((a=a.parentNode)&&a!==c);return a===c&&b||null}function r(a,b){return h(a,document.getElementById(b))}function i(a,c){c=c||document;if(a.id)return o([r(c,a.id)],a);delete a.id;var b=c.getElementsByTagName(a.tag||"*");if((!a.classes||a.classes.length<1)&&(!a.attributes||a.attributes.length<1)&&(!a.pseudos||a.pseudos.length<1))return k(b);for(var f=[],g=b.length,e=0;e<g;e++)d(a,b[e])&&f.push(b[e]);return f}function d(d,c){if(!c)return false;for(var b=d.propNames,f=b.length,a=0;a<f;a++)if(!e[b[a]](c,d[b[a]]))return false;return true}function k(b){for(var c=[],d=b.length,a=0;a<d;a++)c[a]=b[a];return c}function o(b,f){for(var c=[],e=b.length,a=0;a<e;a++)b[a]&&b[a].nodeType===1&&d(f,b[a])&&c.push(b[a]);return c}var m=function(){return typeof Array.prototype.indexOf!=="undefined"?b:a;function b(a,b){return a.indexOf(b)}function a(b,c){for(var d=b.length,a=0;a<d;a++)if(b[a]===c)return a;return-1}}();function l(a,b){return m(a,b)!==-1}function p(e){c.inc();for(var f=c.name,d=[],g=e.length,b=0;b<g;b++){var a=e[b];if(a[f]!==c.t){a[f]=c.t;d.push(a)}}return d}var g=function(){return function(){var c=document.createElement("div");c.innerHTML='<a href="#test">test</a>';var d=c.firstChild;return d.getAttribute("href")==="#test"?a:b}();function a(b,a){return b.getAttribute(a)}function b(a,b){switch(b.toLowerCase()){case"class":return a.className||null;case"id":return a.id||null;case"href":case"src":if(typeof a.getAttribute!=="undefined")return a.getAttribute(b,2)}return a.attributes&&a.attributes[b]&&a.attributes[b].nodeValue||a.getAttribute(b)}}();function f(a){this.name=a;this.f=0;this.t=1;this.inc=function(){this.f=(this.t+=2)-1}}function t(a){this.parse=function(b){var e,c,g=a.preprocessInput;b=g&&g(b)||b;a.reset();var d=0,f=b.length;while(d<f){e=b.charAt(d);c=c||a[e]||a["default"];if(c){advance=c(b.substring(d,f));if(!advance)throw'No valid match found for "'+c.name+'" rule';d+=advance}else throw'No suitable rule found to handle character "'+e+'"';c=null}return a.finish()}}function q(f,b){var q=b;b=b||document;a.inc();if(typeof f!=="string")return s(b||document,f);var c,g=[];try{g=k(b.querySelectorAll(f))}catch(r){for(var l=n.parse(f),j=l.length,h=0;h<j;h++){var d=l[h],p=d.length,e=p%2-1;c=e===0?i(d[e],b):[b||document];while(d[++e]){var o=d[e++],m=d[e];m.root=b;c=u(c,o,m)}g=j>1?g.concat(c):c}}return g}c=new f("__$gimme$_unique__");b=new f("__$gimme$_genSib__");a=new f("__$gimme$_nth__");e={id:function(a,b){return a.id===b},tag:function(b,a){return b.tagName===a||a==="*"},classes:function(c,b){var a=c.className;if(typeof a!=="string")a=g(c,"class");if(!a)return false;var e=" "+a+" ",d=b.length;while(d--)if(e.indexOf(" "+b[d]+" ")===-1)return false;return true},attributes:function(){var b={},a={parse:function(c){var a=c.match(/^\[([\w-_]+)?(\=|\^=|\$=|\*=|\|=|~=|!=)?(.*)\]$/);return b[c]={name:a&&a[1],delim:a&&a[2],val:a&&a[3].replace(/^['"]|["']$/g,"")}},"=":function(a,b){return a===b},"^=":function(a,b){return a.indexOf(b)===0},"$=":function(a,b){var c=a.lastIndexOf(b);return c!==-1&&c+b.length===a.length},"*=":function(a,b){return a.indexOf(b)!==-1},"|=":function(a,b){return a===b||a.indexOf(b+"-")===0},"~=":function(a,b){return a===b||l(a.split(" "),b)},"!=":function(a,b){return a!==b},unknown:function(){return false}};return function(h,d){var e=d.length;while(e--){var c=b[d[e]]||a.parse(d[e]),f=g(h,c.name);if(!f)return false;if(!c.delim)continue;if(!a[c.delim||"unknown"](f,c.val))return false}return true}}(),pseudos:function(){var d={},b={parse:function(c){var a=c.match(/([\w-_]+)\b(\((((-?\d*)n)?([+-]?\d+)?|.*)\))?/),b={name:a&&a[1],param:{wholeValue:a&&a[3],a:a&&a[5]||0,b:a&&a[6]||0}};if(b.param.wholeValue==="even"){b.param.a=2;b.param.b=0}else if(b.param.wholeValue==="odd"){b.param.a=2;b.param.b=1}return d[c]=b},"first-child":c("previous"),"last-child":c("next"),"only-child":function(a){return b["first-child"](a)&&b["last-child"](a)},"nth-child":function(i,b){var k=1e4,h=a.t*k,d=a.name,c=i.parentNode,j=0;if(c){if(c[d+":parent"]!==a.t){c[d+":parent"]=a.t;var j=0,m,e=c.children||c.childNodes,f=-1,l=e.length;while(++f<l)if(e[f].nodeType===1){j++;e[f][d]=h+j}}var g=i[d]-h-b.param.b;return!b.param.a&&b.param.b?g===0:b.param.a*g>=0&&g%(b.param.a||1)===0}return false},contains:function(a,b){return(a.textContent||a.innerText||a.innerHTML).indexOf(b.param.wholeValue)!==-1},not:function(){return false}};function c(b){var a=b+"Sibling";return function(c){var b=c[a];while(b&&b.nodeType!==1)b=b[a];return!b}}return function(f,a){var c=a.length;while(c--){var e=d[a[c]]||b.parse(a[c]);if(!b[e.name](f,e))return false}return true}}()," ":function(d,e){for(var a=[],f=d.length,b=0;b<f;b++){var c=i(e,d[b]);a=a.concat(c);if(e.id&&c.length===1)break}return p(a)},">":function(c,e){for(var a=[],d=c.length,b=0;b<d;b++)a=a.concat(o(c[b].childNodes,e));return a},"+":function(e,h){for(var c=[],g=e.length,b=0;b<g;b++){var f=e[b],a=f.nextSibling;while(a&&a.nodeType!==1)a=a.nextSibling;d(h,a)&&c.push(a)}return c},"~":function(g,j){b.inc();for(var e=b.name,f=[],i=g.length,c=0;c<i;c++){var h=g[c],a=h.nextSibling;while(a&&a[e]!==b.t){if(a.nodeType===1){a[e]=b.t;d(j,a)&&f.push(a)}a=a.nextSibling}}return f}};j=new function(){var d,b,a;function c(){this.propNames=[]}c.prototype.propNames=[];c.prototype.storePropertyValue=function(a,b){this[a]=b;if(!this.propNames[a]){this.propNames.push(a);this.propNames[a]=true}};c.prototype.storeArrayValue=function(a,b){if(!this[a])this[a]=[];this[a].push(b);if(!this.propNames[a]){this.propNames.push(a);this.propNames[a]=true}};var e={preprocessInput:function(a){return a.replace(/\s*([ >+~,])\s*/g,"$1")},reset:function(){d=[];b=[];a=new c},finish:function(){a&&a.propNames.length>0&&b.push(a);b.length>0&&d.push(b);return d},"default":function(e){var d="tag",c=e.match(/(\w+|\*)/);if(c){var b=c[0].toUpperCase();a.storePropertyValue(d,b);return b.length}return null},"#":function(d){var c="id",b=d.match(/#([_\-\w]+)/);if(b){var e=b[1];a.storePropertyValue(c,e);return b[0].length}return null},".":function(d){var c="classes",b=d.match(/\.([_\-\w\d]+)/);if(b){var e=b[1];a.storeArrayValue(c,e);return b[0].length}},"[":function(e){var d="attributes",c=e.match(/(\[.*"\]|.*?\])/);if(c){var b=c[0];a.storeArrayValue(d,b);return b.length}return null},":":function(e){var d="pseudos",c=e.match(/:[\w-_]+\b(\(.*\))?/);if(c){var b=c[0];a.storeArrayValue(d,b);return b.length}return null}," ":function(){b.push(a," ");a=new c;return 1},">":function(){a.propNames.length>0&&b.push(a);b.push(">");a=new c;return 1},"~":function(){b.push(a,"~");a=new c;return 1},"+":function(){b.push(a,"+");a=new c;return 1},",":function(){b.push(a);d.push(b);b=[];a=new c;return 1}};return e};n=new t(j);q.Internal={unique:p,index_of:m,contains:l,has_class:e.classes,get_attr:g};return q}(),a=function(){function a(a){Array.prototype.push.apply(this,a)}a.prototype={length:Array.prototype.length,entities:function(){return Array.prototype.slice.apply(this)},sort:function(a){Array.prototype.sort.call(this,a);return this},reverse:function(){Array.prototype.reverse.call(this);return this},push:function(){Array.prototype.push.apply(this,arguments);return this},pop:function(){Array.prototype.pop.call(this);return this},shift:function(){Array.prototype.shift.call(this);return this},unshift:function(){Array.prototype.unshift.apply(this,arguments);return this},slice:function(){return new a(Array.prototype.slice.apply(this,arguments))},splice:function(){return new a(Array.prototype.splice.apply(this,arguments))},concat:function(b){return new a(Array.prototype.concat.apply(this.entities(),b.entities&&b.entities()||arguments))}};function b(c,d){var e=!c&&[]||(d||typeof c==="string")&&b.query(c,d)||c instanceof Array&&c||[c];return new a(e)}b.Helper={get_guid:function(){var a=0;return function(b){if(!b)return"";if(b===window)return"win";else if(b===document)return"doc";else if(b.uniqueID)return b.uniqueID;var c="__$gimme$_guid__";if(typeof b[c]==="undefined")b[c]=c+a++;return b[c]}}()};b.Browser=function(){var a=navigator.userAgent.toLowerCase();return{is_ie:typeof ActiveXObject!=="undefined",is_opera:typeof window.opera!=="undefined",is_khtml:a.indexOf("khtml")!==-1,is_gecko:a.indexOf("khtml")===-1&&a.indexOf("gecko")!==-1,is_in_quirks_mode:document.compatMode==="BackCompat"}}();b.undefined={}._$gimme$_undefined;b.ext=a.prototype;return b}();a.ext.select=function(b){return a(b,this[0])};if(typeof g==="undefined")window.g=a;a.query=b;a.Helper.index_of=a.query.Internal.index_of;a.Helper.contains=a.query.Internal.contains;a.Helper.unique=a.query.Internal.unique;a.Helper.has_class=a.query.Internal.has_class;a.Helper.get_attr=a.query.Internal.get_attr;a.Effects={Animation:function(b){var a=b.elements||[],f=b.duration||1,c=b.from||{},d=b.to||{},e={};(function(){var f,b,i,g={},h={},j={};for(b in c){g[b]=[];h[b]=[];j[b]=[];f=a.length;while(f--){i=a[f];g[b][f]=typeof c[b]==="function"?c[b](i,b):c[b];h[b][f]=typeof d[b]==="function"?d[b](i,b):d[b];j[b][f]=h[b][f]-g[b][f]}}c=g;d=h;e=j})();var g=b.animate,h=b.easing||function(a){return a};this.startTime=b.startTime||0;this.duration=f;this.add_element=function(b){a.push(b)};this.remove_element=function(c){var b=a.length;while(b--)if(a[b]===c){a.splice(b,1);break}};this.tick=i;function i(i){_ease=h(i);var d=a.length;while(d--){var b,f={};for(b in e)f[b]=c[b][d]+e[b][d]*_ease;g(a[d],f,i)}}},Storyboard:function(f){var m,h,a=0,b=1,e=false,c=f.animations,g=f.duration||0,j=f.completed,k=f.aborted;function d(){if(!e){e=true;h=(new Date).getTime();m=setInterval(v,1)}}this.begin=x;function x(){a=0;b=1;d()}this.abort=w;function w(){i();k&&k(a)}this.pause=i;function i(){clearInterval(m);e=false}this.resume=u;function u(){d()}this.forward=s;function s(){b=1;d()}this.backward=r;function r(){b=-1;d()}this.reverse=t;function t(){b*=-1;d()}this.seek=y;function y(b){a=b;l()}this.is_running=q;function q(){return e}this.get_direction=o;function o(){return b}this.get_animations=n;function n(){return c}this.get_duration=p;function p(){return g}function v(){var c=(new Date).getTime();a+=(c-h)/g*b;h=c;a=a<0?0:a>1?1:a;l();if(b===-1&&a===0||b===1&&a===1){i();j&&j(a)}}function l(){var e=c.length;while(e--){var d=(g*a-c[e].startTime)/c[e].duration;d=b===-1&&d<0?0:b===1&&d>1?1:d;d>=0&&d<=1&&c[e].tick(d)}}},Easing:{Back:new function(){function c(a,d,b,c){d=.5;b=0;c=.5;return Math.pow(1-a,b)*c*Math.sin(2*Math.PI*a*d)*-1+a}this.ease_in=c;function b(){}this.ease_out=b;function a(){}this.ease_in_out=a},Bounce:new function(){function d(c,a,b){a=a||1.5;b=b||4;return Math.abs(Math.pow(c,a)*Math.cos(Math.PI*c*b))}this.ease_in=d;function c(d,b,c){return 1-a.Effects.Easing.Bounce.ease_in(1-d,b,c)}this.ease_out=c;function b(b,e,f){var g=1,d=0,c=a.Effects.Easing.Bounce.ease_in;if(b>.5){c=a.Effects.Easing.Bounce.ease_out;b-=.5;d=g/2}return c(b,e,f)-d}this.ease_in_out=b},Elastic:new function(){function c(){}this.ease_in=c;function b(c,b,a){b=b||3.5;a=a||5;return 1-Math.pow(1-c,b)*Math.cos(2*Math.PI*c*a)}this.ease_out=b;function a(){}this.ease_in_out=a},Exponential:new function(){function b(b,a){return Math.pow(b,a)}this.ease_in=b;function a(b,a){return Math.pow(b,1/a)}this.ease_out=a;function c(c,d){return c<=.5?b(c*2,d)*.5:a((c-.5)*2,d)*.5+.5}this.ease_in_out=c}},Enums:{Directions:{vertically:1,horizontally:2,both:3},Speeds:{quickly:500,slowly:1e3}},RunningAnimations:function(){var b={};return{add:function(a,c){b[a]=c},remove:function(a){delete b[a]},"get":function(c){return b[c]||new a.Effects.Storyboard({animations:[]})},contains:function(a){return!!b[a]}}}()};a.Effects.Storyboard.create=function(h,i,j,f,b,c,e,g){b=Math.floor(b)||a.Effects.Enums.Speeds[b]||a.Effects.Enums.Speeds.quickly;var d=new a.Effects.Storyboard({duration:b,completed:function(){e&&e.call(this);a.Effects.RunningAnimations.remove(c);d=null},aborted:function(){a.Effects.RunningAnimations.remove(c);d=null},animations:[new a.Effects.Animation({from:i,to:j,duration:b,animate:f,easing:g,elements:h})]});c&&a.Effects.RunningAnimations.add(c,d);return d};a.Ajax=new function(){function c(c,b){a(c,b,true)}this.request_json=c;function b(c,b){a(c,b,false)}this.request_ahah=b;function d(){if(typeof XMLHttpRequest!=="undefined")return new XMLHttpRequest;else if(typeof ActiveXObject!=="undefined")try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){throw new Error("Error invoking XMLHTTP");}else throw new Error("XMLHttp is not supported");}function a(e,b,c){var a=d();a.onreadystatechange=function(){if(a.readyState===4){if(a.status===200){var d=a.responseText;if(c)d=eval("("+a.responseText+")");b.call(a,d)}a=null;callback=null}};a.open("GET",e,true);a.send("")}};a.Screen=new function(){function b(){var a={width:0,height:0};if(typeof window.innerWidth!=="undefined")a={width:window.innerWidth,height:window.innerHeight};else if(typeof document.documentElement!=="undefined"&&typeof document.documentElement.clientWidth!=="undefined"&&document.documentElement.clientWidth!==0)a={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight};else a={width:document.getElementsByTagName("body")[0].clientWidth,height:document.getElementsByTagName("body")[0].clientHeight};return a}this.get_viewport_size=b;function d(a){a=a||window.event;var b={x:0,y:0};if(typeof a.pageX!=="undefined"&&typeof a.x!=="undefined"){b.x=a.pageX;b.y=a.pageY}else{var c=this.get_scroll_pos();b.x=a.clientX+c.x;b.y=a.clientY+c.y}return b}this.get_mouse_pos=d;function c(){return a(window).get_scroll_pos()}this.get_scroll_pos=c};a.Util=new function(){function c(){return a(arguments,false)}this.set_timeout=c;function b(){return a(arguments,true)}this.set_interval=b;function a(a,c){var e=a[0],b=a[1];function d(){e.apply(this,Array.prototype.slice.call(a,2));if(!c)e=null}return c===true?window.setInterval(d,b):window.setTimeout(d,b)}};a.Style=new function(){function f(c){var e=c.scrollTop&&c!==document.documentElement&&c!==document.body&&c.tagName!=="TEXTAREA"&&c.tagName!=="INPUT"?-1:0,d={x:c.scrollLeft*e,y:c.scrollTop*e};if(a.Browser.is_ie&&b(c,"position")==="static"){var f=c.style.position;c.style.position="relative";d.x+=c.offsetLeft;d.y+=c.offsetTop;c.style.position=f}else{d.x+=c.offsetLeft;d.y+=c.offsetTop}return d}this.get_relative_pos=f;function g(c){var g={x:0,y:0};if(c.getBoundingClientRect){var k=c.getBoundingClientRect(),j=d(),i=a(window).get_scroll_pos();g.x=k.left-j.x+i.x;g.y=k.top-j.y+i.y}else{var h;while(c!==null){h=f(c);g.x+=h.x;g.y+=h.y;c=c.offsetParent;if(c&&!e()){g.x+=parseFloat(b(c,"borderLeftWidth"))||0;g.y+=parseFloat(b(c,"borderTopWidth"))||0}}}return g}this.get_absolute_pos=g;function e(){if(typeof arguments.callee.constantValue==="undefined"){var a=document.createElement("div");a.setAttribute("style","position:absolute;visibility:hidden;top:0;left:0;border:1px solid #000;");var b=document.createElement("div");a.appendChild(b);document.body.appendChild(a);arguments.callee.constantValue=b.offsetTop===1;document.body.removeChild(a);a=b=null}return arguments.callee.constantValue}this.offset_includes_borders=e;function d(){if(typeof arguments.callee.constantValue==="undefined"){var b=document.body,g=b.style.position,f=b.style.margin,e=b.style.border;b.style.position="static";b.style.margin="0";b.style.border="1px solid transparent";var d=b.getBoundingClientRect(),c=a(window).get_scroll_pos();arguments.callee.constantValue={x:d.left+c.x,y:d.top+c.y};b.style.position=g;b.style.margin=f;b.style.border=e}return arguments.callee.constantValue}this.get_bounding_client_rect_offsets=d;var i=function(){function b(b,a){b.style.opacity=a}function c(c,a){a*=100;var b;try{b=c.filters.item("DXImageTransform.Microsoft.Alpha");if(a<100){b.Opacity=a;if(!b.enabled)b.enabled=true}else b.enabled=false}catch(d){if(a<100)c.style.filter=(c.currentStyle||c.runtimeStyle).filter+" progid:DXImageTransform.Microsoft.Alpha(opacity="+a+")"}}var a=document.createElement("div");return typeof a.style.opacity!=="undefined"&&b||typeof a.style.filter!=="undefined"&&c||function(){}}();this.set_opacity=i;var h=function(){function c(a){return parseFloat(a.style.opacity)||b(a,"opacity")}function d(b){var a=b.filters["DXIMageTransform.Microsoft.Alpha"];return a?a.Opacity/100:1}var a=document.createElement("div");return typeof a.style.opacity!=="undefined"&&c||typeof a.style.filter!=="undefined"&&d||function(){}}();this.get_opacity=h;function b(d,b){var a="";if(d.currentStyle&&(b==="right"||b==="bottom"))a=c(b,"auto","auto",d)+"px";else{var f=document.defaultView&&document.defaultView.getComputedStyle&&document.defaultView.getComputedStyle(d,null)||d.currentStyle;if(f){var a=f[b]||"",g=a.match(/px$/);if(!g){var e=a.match(/(em|ex|%|in|cm|mm|pt|pc|small|medium|large|thin|thick|auto)$/);if(e)a=c(b,a,e[0],d)+"px"}}}return a}this.get_rendered_style=b;function c(d,g,l,c){if(!g)return 0;else if(l==="px")return parseFloat(g);else if(g==="auto")switch(d){case"top":case"left":return 0;case"bottom":case"right":var h={bottom:["top","offsetTop","height","offsetHeight"],right:["left","offsetLeft","width","offsetWidth"]},m=a(c);if(m.get_style("position")==="relative"){var p=h[d][0];return-parseInt(m.get_style(p))}else{var f=c.parentNode;while(f!==document&&a(f).get_style("position")==="static")f=f.parentNode;var j=h[d][2],i;if(f===document)i=a.Screen.getViewportSize()[j];else i=parseInt(a(f).get_style(j));var o=h[d][1],n=h[d][3];return i-c[o]-c[n]}case"height":return c.clientHeight||c.offsetHeight&&c.offsetHeight-parseFloat(b(c,"borderTopWidth"))-parseFloat(b(c,"borderBottomWidth"))||0;case"width":return c.clientWidth||c.offsetWidth&&c.offsetWidth-parseFloat(b(c,"borderLeftWidth"))-parseFloat(b(c,"borderRightWidth"))||0;default:return 0}else{switch(d){case"borderLeftWidth":case"borderRightWidth":case"borderTopWidth":case"borderBottomWidth":d=d.replace("Width","Style");var k=b(c,d);return k==="none"?0:parseFloat(k)}c=c||document.body;var e=document.createElement("div");e.style.visbility="hidden";e.style.position="absolute";e.style.lineHeight="0";if(l==="%"){c=c.parentNode;if(d==="height"||d==="top")e.style.height=g;else if(d==="width"||d==="left")e.style.width=g}else{e.style.borderStyle="solid";e.style.borderBottomWidth="0";e.style.borderTopWidth=g}try{c.appendChild(e)}catch(r){c=c.parentNode;c.appendChild(e)}c.offsetWidth;c.offsetHeight;var q=e.offsetHeight||e.offsetWidth;c.removeChild(e);return q}}this.normalize_style=c};(function(){var e=a.Helper,d={},c=null,b=null;a.Events=new function(){this.capture_mouse=function(d){a.Events.release_mouse();c=d;if(typeof d.setCapture!=="undefined")d.setCapture();else{b=function(c){var e,f;e=document.createEvent("MouseEvents");e.initMouseEvent(c.type,c.bubbles,c.cancelable,window,c.detail,c.screenX,c.screenY,c.clientX,c.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,c.button,c.relatedTarget);f=a.Screen.get_scroll_pos();e.__defineGetter__("pageX",function(){return this.clientX+f.x});e.__defineGetter__("pageY",function(){return this.clientY+f.y});document.removeEventListener(c.type,b,true);e.captureTarget=c.target;d.dispatchEvent(e);b!==null&&document.addEventListener(c.type,b,true);delete e.captureTarget;c.stopPropagation()};document.addEventListener("mouseover",b,true);document.addEventListener("mouseout",b,true);document.addEventListener("mousemove",b,true);document.addEventListener("mouseup",b,true);document.addEventListener("mousedown",b,true);document.addEventListener("click",b,true);document.addEventListener("dblclick",b,true)}return this};this.release_mouse=function(){if(c!==null){if(typeof c.releaseCapture!=="undefined")c.releaseCapture();else{document.removeEventListener("mouseover",b,true);document.removeEventListener("mouseout",b,true);document.removeEventListener("mousemove",b,true);document.removeEventListener("mouseup",b,true);document.removeEventListener("mousedown",b,true);document.removeEventListener("click",b,true);document.removeEventListener("dblclick",b,true)}c=b=null}return this};this.get_capture_target=function(a){return a.captureTarget||a.srcElement||a.target};this.Pseudo={mouseenter:{wire:function(g,d,b,c){var e=c?a.ext.add_event:a.ext.remove_event;e.call(g,"mouseover",f(d),b,true)},add:function(d,c,b){a.Events.Pseudo.mouseenter.wire(d,c,b,true)},remove:function(d,c,b){a.Events.Pseudo.mouseenter.wire(d,c,b,false)}},mouseleave:{wire:function(g,d,b,c){var e=c?a.ext.add_event:a.ext.remove_event;e.call(g,"mouseout",f(d),b,true)},add:function(d,c,b){a.Events.Pseudo.mouseleave.wire(d,c,b,true)},remove:function(d,c,b){a.Events.Pseudo.mouseleave.wire(d,c,b,false)}},mousewheel:{wire:function(i,c,e,f){var g=f?a.ext.add_event:a.ext.remove_event,b="mousewheel",d=c;if(a.Browser.is_gecko){b="DOMMouseScroll";d=h(c)}g.call(i,b,d,e,true)},add:function(d,c,b){a.Events.Pseudo.mousewheel.wire(d,c,b,true)},remove:function(d,c,b){a.Events.Pseudo.mousewheel.wire(d,c,b,false)}}};function g(c,a,b){if(c===a)return false;var d=0;while(a&&a!=c){d++;a=a.parentNode}b=b||d;return a===c&&b===d}function f(b){var c=e.get_guid(b),a=d[c];if(!a)a=d[c]=function(c){var a=c.relatedTarget;if(!a||this===a||g(this,a))return;b.call(this,c)};return a}function h(b){var c=e.get_guid(b),a=d[c];if(!a)a=d[c]=function(a){a.wheelDelta=-40*a.detail;b.call(this,a);a.wheelDelta=null};return a}}})();(function(){var c=a.Helper,d={},b={};a.ext.add_event=function(){return document.addEventListener?e:document.attachEvent?f:function(){};function e(b,d,c,e){if(!e&&a.Events&&a.Events.Pseudo&&a.Events.Pseudo[b])a.Events.Pseudo[b].add(this,d,c);else this.for_each(function(a){a.addEventListener(b,d,c)});return this}function f(e,g,f,k){function j(b,a){a.eventPhase=a.eventPhase||1;a.target=a.srcElement;a.currentTarget=b;switch(a.type){case"keyup":case"keydown":case"keypress":if(b.type!=="file")a.keyCode===186?a.keyCode=59:a.keyCode===187?a.keyCode=61:a.keyCode===189?a.keyCode=109:null;a.which=a.keyCode;a.charCode=a.keyCode;break;case"mousedown":case"mouseup":case"click":case"dblclick":case"contextmenu":a.which=([1,1,3,a.button,2])[a.button];break;case"mouseover":a.relatedTarget=a.fromElement;break;case"mouseout":a.relatedTarget=a.toElement}a.preventDefault=function(){a.returnValue=false};a.stopPropagation=function(){a.cancelBubble=true};return a}function i(d,e,f){var a=b[d];if(!a)a=b[d]={};var c=a[e];if(!c)c=a[e]=[];c.push(f)}function h(k,j){var i=[],d=k;while(d&&d!==document){i.push(d);d=d.parentNode}var h;while(h=i.pop()){var a=c.get_guid(h);if(b[e][a])for(var l=b[e][a].length,f=0;f<l;f++)if(!j.cancelBubble){var g=b[e];g[a]&&g[a][f]&&g[a][f].call(h,j)}}}if(!k&&a.Events&&a.Events.Pseudo&&a.Events.Pseudo[e])a.Events.Pseudo[e].add(this,g,f);else this.for_each(function(k){var m=c.get_guid(k),n=c.get_guid(g)+(f||false).toString(),l="{"+m+" / "+e+" / "+n+"}";f&&i(e,m,g);var a=d[l];if(!a){a=function(a){a=j(k,a);b[e]&&a.eventPhase===1&&h(k,a);a.eventPhase=3;!f&&!a.cancelBubble&&g.call(k,a);a.eventPhase=a.target=a.currentTarget=a.relatedTarget;a.which=a.preventDefault=a.stopPropagation=a=null};d[l]=a;k.attachEvent("on"+e,a)}l=null;a=null});return this}}();a.ext.remove_event=function(){return document.addEventListener?e:document.attachEvent?f:function(){};function e(b,d,c,e){if(!e&&a.Events&&a.Events.Pseudo&&a.Events.Pseudo[b])a.Events.Pseudo[b].remove(this,d,c);else this.for_each(function(a){a.removeEventListener(b,d,c)});return this}function f(e,g,f,i){function h(g,e,h){var d=b[g];if(d){var c=d[e];if(c){var f=a(c).index_of(h);f!==-1&&a(c).splice(f,1);if(c.length===0)delete d[e]}}}if(!i&&a.Events&&a.Events.Pseudo&&a.Events.Pseudo[e])a.Events.Pseudo[e].remove(this,g,f);else this.for_each(function(j){var i=c.get_guid(j),k=c.get_guid(g)+(f||false).toString(),b="{"+i+" / "+e+" / "+k+"}";f&&h(e,i,g);var a=d[b];if(a){j.detachEvent("on"+e,a);delete d[b]}b=null;a=null});return this}}()})();(function(){var b=a.Helper;a.ext.add_class=function(d){var c=d.split(/\s+/);this.for_each(function(d){a(c).for_each(function(a){if(!b.has_class(d,[a]))if(d.className==="")d.className=a;else d.className+=" "+a})});return this}})();a.ext.remove_class=function(a){return this.swap_class(a,"$1")};a.ext.swap_class=function(c,b){if(b!=="$1")b=" "+b+" ";var d=c.split(/\s+/);this.for_each(function(e){var c=e.className;a(d).for_each(function(a){var d=new RegExp("(^| )"+a+"( |$)");c=c.replace(d,b)});e.className=c.replace(/^\s+|\s+$/g,"")});return this};(function(){var b=a.Helper;a.ext.has_class=function(c,d){var a=this[d||0];return a&&b.has_class(a,[c])||false}})();a.ext.get_html=function(b){var a=this[b||0];return a&&a.innerHTML||""};a.ext.set_html=function(a){this.for_each(function(b){b.innerHTML=a});return this};a.ext.get_val=function(b){var a=this[b||0];return a&&a.value||""};a.ext.set_val=function(a){this.for_each(function(b){if(typeof b.value!=="undefined")b.value=a});return this};(function(){var b=a.Helper.get_attr;a.ext.get_attr=function(c,d){var a=this[d||0];return a&&b(a,c)||""}})();a.ext.set_attr=function(a,b){this.for_each(function(c){c.setAttribute(a,b)});return this};(function(){var b=a.Style.get_rendered_style,c=a.Style.get_opacity;a.ext.get_style=function(d,e){var a=this[e||0];return a?d==="opacity"?c(a):b(a,d):""}})();(function(){var b=a.Style.set_opacity;a.ext.set_style=function(a){this.for_each(function(d){var c;for(c in a)switch(c){case"opacity":b(d,a[c]);break;default:d.style[c]=a[c]}});return this}})();a.ext.get_native_prop=function(b,c){var a=this[c||0];return a?a[b]:""};a.ext.parent=function(c){var b=this[c||0];return a(b&&b.parentNode)};a.ext.element=function(a){return this[a||0]};a.ext.get_ancestor=function(c,e){var b=this[e||0],d=c;while(d-->0)if(b)b=b.parentNode;else break;return a(b)};a.ext.get_sibling=function(c,h){var g=this[h||0],b=g;if(c!==0){var e=c>0?"nextSibling":"previousSibling",f=Math.abs(c),d=0;while(d<f){b=b[e];if(!b)break;if(b.nodeType===1)d++}}return a(b)};a.ext.for_each=function(){return typeof Array.prototype.forEach!=="undefined"?b:a;function b(b,a){this.entities().forEach(b,a);return this}function a(e,c){for(var b=this.entities(),d=b.length,a=0;a<d;a++)e.call(c,b[a],a,b);return this}}();a.ext.iterate=function(c){for(var e=this.length,b=0;b<e;b++){var d=a(this[b]);c.call(d,b)}_callback=null;return this};a.ext.filter=function(d){var c=a(),b=this.length;while(b--)d(this[b])&&c.unshift(this[b]);return c};a.ext.map=function(){return typeof Array.prototype.map!=="undefined"?c:b;function c(c,b){return a(this.entities().map(c,b))}function b(e,d){var b=a(),c=this.length;while(c--)b.unshift(e.call(d,this[c]));return b}}();(function(){var b=a.Helper;a.ext.contains=function(a){return b.contains(this.entities(),a)}})();(function(){var b=a.Helper;a.ext.index_of=function(a){return b.index_of(this.entities(),a)}})();a.ext.select=function(b){return a(b,this[0])};a.ext.has=function(b,d){var c=this[d||0];return a(b,c).length>0};(function(){var b=a.Helper;a.ext.unique=function(){return a(b.unique(this.entities()))}})();(function(){var b=a.Style.get_rendered_style;a.ext.get_style_pos=function(c){var a=this[c||0];return{x:parseFloat(b(a,"left")),y:parseFloat(b(a,"top"))}}})();(function(){var b=a.Style.get_absolute_pos;a.ext.get_absolute_pos=function(c){var a=this[c||0];return a&&b(a)||{x:0,y:0}}})();(function(){var b=a.Style.get_relative_pos;a.ext.get_relative_pos=function(c){var a=this[c||0];return a&&b(a)||{x:0,y:0}}})();(function(){a.ext.get_scroll_pos=function(d){var c=this[d||0],b={x:0,y:0};if(c===window){if(typeof window.pageYOffset!=="undefined"){b.x=window.pageXOffset;b.y=window.pageYOffset}else if(!a.Browser.is_in_quirks_mode&&typeof document.documentElement.scrollTop!=="undefined"){b.x=document.documentElement.scrollLeft;b.y=document.documentElement.scrollTop}else if(typeof document.body.scrollTop!=="undefined"){b.x=document.body.scrollLeft;b.y=document.body.scrollTop}}else{b.x=c.scrollLeft;b.y=c.scrollTop}return b}})();a.ext.animate=function(c,g,k,f,i){function h(e,c){var d=a(e).get_style(c);b.units[c]=(d+"").match(/[^\d]+$/)||"";return parseFloat(d)}function j(d,a){var f=b[a](d,a),e=eval("f"+c[a]);return e}var b={units:{}},e={};for(var d in c){b[d]=h;e[d]=j}var l=a.Effects.Storyboard.create(this,b,e,function(f,e){var g=a(f);for(var c in e){if(c==="units")continue;var d={};d[c]=e[c]+b.units[c];g.set_style(d)}},g,k,f,i);l.begin();return this};a.ext.bounce=function(b,h,d,f,c){function e(b){return a(b).get_style_pos().y}if(b===null)b=e;var g=a.Effects.Storyboard.create(this,{top:b},{top:h},function(b,a){b.style.top=Math.ceil(a.top)+"px"},d,f,c,a.Effects.Easing.Bounce.ease_out);g.begin();return this};(function(){function b(b,f,d,e,c){this.set_style({zoom:1});if(b===null)b=function(b,c){return Number(a(b).get_style(c))};var g=a.Effects.Storyboard.create(this,{opacity:b},{opacity:f},function(c,b){a(c).set_style({opacity:b.opacity})},d,e,c,null);g.begin();return this}a.ext.fade_to=b;a.ext.fade_in=function(c,e,a,d){return b.call(this,0,1,c,e,a,d)};a.ext.fade_out=function(c,e,a,d){return b.call(this,1,0,c,e,a,d)}})();a.ext.slide=function(b,e,g,j,f,h){function c(c,b){b=b==="left"?"x":"y";var d=c.__pos;if(!d)d=c.__pos=a(c).get_style_pos();if(b==="y")c.__pos=a.undefined;return d[b]}if(b===null)b={x:c,y:c};var d=Math.round,i=a.Effects.Easing.Exponential.ease_in_out,k=a.Effects.Storyboard.create(this,{left:b.x,top:b.y},{left:e.x,top:e.y},function(b,a){b.style.top=d(a.top)+"px";b.style.left=d(a.left)+"px"},g,j,f,h||function(a){return i(a,4)});k.begin();return this};a.ext.scroll_to=function(d,g,c,e){scrollPos=a.Screen.get_scroll_pos();elemPos=a(this[0]).get_absolute_pos();var b=Math.round,f=a.Effects.Easing.Exponential.ease_out,h=a.Effects.Storyboard.create([window],{scrollX:scrollPos.x,scrollY:scrollPos.y},{scrollX:elemPos.x,scrollY:elemPos.y},function(c,a){c.scrollTo(b(a.scrollX),b(a.scrollY))},d,g,c,e||function(a){return f(a,4)});h.begin();return this};a.ext.veil=function(c,j,l,i,k){var b=a.Effects.Enums.Directions;c=Math.floor(c)||b[c]||b.vertically;var f="_$gimme$_veil";function h(b,c){var d=parseInt(a(b).get_style(c),10);b[f]=b[f]||{};return b[f][c]=d}var e={},d={};if((c&b.vertically)===b.vertically){d.height=d.paddingTop=d.paddingBottom=h;e.height=e.paddingTop=e.paddingBottom=0}if((c&b.horizontally)===b.horizontally){d.width=d.paddingLeft=d.paddingRight=h;e.width=e.paddingLeft=e.paddingRight=0}var g=a.Effects.Storyboard.create(this.filter(function(b){var c=b.style.display||a(b).get_style("display");return c!=="none"}),d,e,function(e,d){var a=e.style;if((c&b.vertically)===b.vertically){a.height=d.height+"px";a.paddingTop=d.paddingTop+"px";a.paddingBottom=d.paddingBottom+"px"}if((c&b.horizontally)===b.horizontally){a.width=d.width+"px";a.paddingRight=d.paddingRight+"px";a.paddingLeft=d.paddingLeft+"px"}},j,l,i,k||function(b){return a.Effects.Easing.Exponential.ease_in_out(b,4)});g.get_animations().push(new a.Effects.Animation({startTime:0,elements:this,animate:function(a){a.style.overflow="hidden"}}),new a.Effects.Animation({startTime:g.get_duration(),elements:this,animate:function(a){a.style.display="none"}}));g.begin();return this};a.ext.unveil=function(c,i,k,h,j){var b=a.Effects.Enums.Directions;c=Math.floor(c)||b[c]||b.vertically;function g(b,d){var c=b._$gimme$_veil;if(!c)c=c||function(){var c=b.cloneNode(true);c.setAttribute("style","position:absolute;top:0;left:0;visibility:hidden;margin:0;padding:0;border:0;height:;width:;");c.style.display="block";b.parentNode.appendChild(c);c=a(c);var e=parseInt(a(b).get_style("height"),10)||parseInt(c.get_style("height"),10),f=parseInt(a(b).get_style("width"),10)||parseInt(c.get_style("width"),10);c[0].style.padding=b.style.padding;var d={height:e,width:f,paddingTop:parseInt(c.get_style("paddingTop"),10),paddingBottom:parseInt(c.get_style("paddingBottom"),10),paddingRight:parseInt(c.get_style("paddingRight"),10),paddingLeft:parseInt(c.get_style("paddingLeft"),10)};b.parentNode.removeChild(c[0]);b.style.overflow="hidden";return d}();return c[d]}var b=a.Effects.Enums.Directions;c=Math.floor(c)||b[c]||b.vertically;var e={},d={};if((c&b.vertically)===b.vertically){d.height=d.paddingTop=d.paddingBottom=0;e.height=e.paddingTop=e.paddingBottom=g}if((c&b.horizontally)===b.horizontally){d.width=d.paddingLeft=d.paddingRight=0;e.width=e.paddingLeft=e.paddingRight=g}var f=a.Effects.Storyboard.create(this.filter(function(c){var b=c.style.display||a(c).get_style("display");return b==="none"||b===null}),d,e,function(d,a){if((c&b.vertically)===b.vertically){d.style.height=a.height+"px";d.style.paddingTop=a.paddingTop+"px";d.style.paddingBottom=a.paddingBottom+"px"}if((c&b.horizontally)===b.horizontally){d.style.width=a.width+"px";d.style.paddingRight=a.paddingRight+"px";d.style.paddingLeft=a.paddingLeft+"px"}},i,k,h,j||function(b){return a.Effects.Easing.Exponential.ease_in_out(b,4)});f.get_animations().push(new a.Effects.Animation({startTime:0,elements:this,animate:function(a){a.style.overflow="hidden";a.style.display="block"}}),new a.Effects.Animation({startTime:f.get_duration(),elements:this,animate:function(a){a.style.overflow=""}}));f.begin();return this};a.toString=function(){return"Gimme v2.7.0 (Edmund) :: Wednesday, August 17, 2011 11:23:21 AM"};return a}();window.Microsoft=window.Microsoft||{};window.Microsoft.Maps=window.Microsoft.Maps||{};window.Microsoft.Maps.initMapCode=function(){var qb="© {year} Microsoft Corporation",p=window.Microsoft.Maps,m=p.Gimme,b=p.Globals,n,o={},L="mm$";if(typeof PRF==="undefined")PRF={add:function(){},start:function(){},end:function(){}};o.PRF=PRF;var jb=new function(){var a=1e3;this.getNext=function(){return a++}};o.IdGenerator=jb;var H=1e-11;function T(a){return typeof a==="number"&&isFinite(a)}function Cb(b){var c={};for(var a in b)if(b.hasOwnProperty(a))c[a]=b[a];return c}function k(d,b,c){var a=document.createElement(d||"div");if(b)a.style.cssText=b;c&&c.appendChild(a);return a}function Db(a){a.stopPropagation();a.preventDefault()}function mb(a){a.stopPropagation()}function Mb(a,b){return a.priority-b.priority}function fb(a){return typeof Array.isArray==="function"?Array.isArray(a):Object.prototype.toString.call(a)==="[object Array]"}var g=new function(){var a=navigator.userAgent,f=a.indexOf("MSIE"),j=a.indexOf("Firefox"),h=a.indexOf("Chrome"),w=j!==-1,i=h!==-1,d=f!==-1,m=parseInt(a.substring(f+5)),u=d&&m===6,v=d&&m===9,n=i&&parseInt(a.substring(h+7))>=11,o=w&&parseInt(a.substring(j+8))>=4,p=document.documentMode,s=a.indexOf("Gecko"),k=s!==-1,g=a.indexOf("Trident/"),q=parseInt(a.substring(g+8)),e=a.indexOf("AppleWebKit")!==-1,b=navigator.vendor==="Apple Computer, Inc.",l=b&&a.indexOf("iPhone OS 3_")!==-1,t=e&&a.indexOf("Android")!==-1,r=a.indexOf("BlackBerry")!==-1;this.isWebkit=e;this.cursorHotspot=e?" 10 9":"";this.useTransform3d=b;this.useTransform3dForTranslate=b;this.useImageDisposer=b;this.isIOSBrowser=a.indexOf("iPhone")!==-1;this.safariRenderHack=b?"-webkit-transform:matrix3d(1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1);":"";this.isIE6=u;this.isIE9=v;this.isIOS3=l;var c=g>0&&q>=5;this.isZoomFasterThanMatrixFilter=c;this.useFilterReflowWorkaround=c;this.cssZoomAffectsTopLeft=d&&p===8;this.animateOverlayLayers=c||n||o||b;this.animateShapes=this.animateOverlayLayers&&!l;this.canRenderOpacityAndRotationOnSemiTransparentPngs=!(d&&!c);this.scrollAdjustment=i?1.5:1;this.useOnResize=c;this.autoSizesElementsTooSmall=k||e;this.opacityGlitchAtBrowserEdges=k;this.isIE8OrEarlier=d&&parseInt(a.substring(f+5))<9;this.emulateDblClick=r;this.isShapeEventsSupported=function(){return typeof gb!=="undefined"&&gb.isEventsSupported?gb.isEventsSupported():true};this.allowFocus=!t};o.Quirks=g;var t=new function(){var i=5,g=new Date(0),e,a=[],c=[],d=L+"dispatchOrder";this.dispatch=function(b,e){b[d]=e||0;var c=a.length;while(c--)if(a[c]===b)return;a.push(b);f()};this.cancelDispatch=function(d){var b;b=a.length;while(b--)a[b]===d&&a.splice(b,1);b=c.length;while(b--)c[b]===d&&c.splice(b,1)};function j(){g=new Date;var b=a;a=c;c=b;c.sort(h);while(c.length)c.shift()();e=null;a.length&&f()}function h(a,b){return a[d]-b[d]}function f(){if(!e){var c=new Date-g,a=Math.max(1e3/b.maxFPS-c,i);e=window.setTimeout(j,a)}}};o.Dispatcher=t;function d(a,b){this.x=a;this.y=b}d.prototype={clone:function(){return new d(this.x,this.y)},toString:function(){return"[Point "+this.x+","+this.y+"]"}};d.clone=function(a){return new d(a.x,a.y)};d.add=function(a,b){return new d(a.x+b.x,a.y+b.y)};d.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)};d.subtract=function(a,b){return new d(a.x-b.x,a.y-b.y)};d.multiply=function(a,b){return new d(a.x*b,a.y*b)};d.areEqual=function(a,b){return a&&b&&a.x===b.x&&a.y===b.y};p.Point=d;var X={fromTileId:function(b,f){var g=1;if(f)g=0;for(var a="",c=b.x,d=b.y,e=0;e<b.levelOfDetail;e++){a=((c&1)+2*(d&1)).toString()+a;c>>=1;d>>=1}return a},toTileId:function(c){var a=0,b=0,e=0;if(c!=null&&c.length>0){e=c.length;for(var d=0;d<c.length;d++)switch(c.charAt(d)){case"0":a=a*2+0;b=b*2+0;break;case"1":a=a*2+1;b=b*2+0;break;case"2":a=a*2+0;b=b*2+1;break;case"3":a=a*2+1;b=b*2+1}}return new v(e,a,b)},wrapX:function(a){var b=1<<a.levelOfDetail;return new v(a.levelOfDetail,(a.x%b+b)%b,a.y)},wrapY:function(a){var b=1<<a.levelOfDetail;return new v(a.levelOfDetail,a.x,(a.y%b+b)%b)},isInBounds:function(a){if(a.x<0||a.y<0)return false;var b=1<<a.levelOfDetail;return a.x>=b||a.y>=b?false:true}};p.QuadKey=X;var K={ground:0,ellipsoid:1,isValid:function(a){return a===K.ground||a===K.ellipsoid}};p.AltitudeReference=K;function l(d,c,b,a){this.latitude=d;this.longitude=c;if(T(b)&&K.isValid(a)){this.altitude=b;this.altitudeReference=a}}l.prototype={clone:function(){return new l(this.latitude,this.longitude,this.altitude,this.altitudeReference)},toString:function(){return"[Location "+this.latitude+","+this.longitude+(this.altitude!==n&&this.altitudeReference!==n?","+this.altitude+","+this.altitudeReference:"")+"]"}};l.normalizeLongitude=function(a){return a<-180||a>180?a-Math.floor((a+180)/360)*360:a};l.areEqual=function(a,b){return a&&b&&a.latitude===b.latitude&&a.longitude===b.longitude&&a.altitude===b.altitude&&a.altitudeReference===b.altitudeReference};p.Location=l;function w(a,c,b){this.center=a;this.width=c;this.height=b}w.prototype={getNorthwest:function(){return new l(this.getNorth(),this.getWest(),this.center.altitude,this.center.altitudeReference)},getSoutheast:function(){return new l(this.getSouth(),this.getEast(),this.center.altitude,this.center.altitudeReference)},getNorth:function(){return this.center.latitude+this.height/2},getSouth:function(){return this.center.latitude-this.height/2},getWest:function(){return this.width>=360?-180:l.normalizeLongitude(this.center.longitude-this.width/2)},getEast:function(){return this.width>=360?180:l.normalizeLongitude(this.center.longitude+this.width/2)},toString:function(){return"[LocationRect "+this.center.toString()+" "+this.width+","+this.height+"]"},clone:function(){return new w(this.center.clone(),this.width,this.height)},contains:function(b){var c=Math.abs(this.center.latitude-b.latitude),a=Math.abs(this.center.longitude-b.longitude);if(a>180)a=360-a;return c<=this.height/2&&a<=this.width/2},intersects:function(b){var c=Math.abs(this.center.latitude-b.center.latitude),a=Math.abs(this.center.longitude-b.center.longitude);if(a>180)a=360-a;return c<=this.height/2+b.height/2&&a<=this.width/2+b.width/2}};w.fromEdges=function(c,b,d,a,f,e){if(Math.abs(a-b)>360){b=-180;a=180}b=l.normalizeLongitude(b);a=l.normalizeLongitude(a);if(b>a)a+=360;return new w(new l((d+c)/2,(b+a)/2,f,e),a-b,c-d)};w.fromCorners=function(a,b){return w.fromEdges(a.latitude,a.longitude,b.latitude,b.longitude,a.altitude,a.altitudeReference)};w.fromLocations=function(){var h=fb(arguments[0])?arguments[0]:arguments,b,c,e,d,f,g,a,i=h.length;while(i--){a=h[i];if(isFinite(a.latitude)&&isFinite(a.longitude)){b=b===n?a.latitude:Math.max(b,a.latitude);c=c===n?a.latitude:Math.min(c,a.latitude);d=d===n?a.longitude:Math.max(d,a.longitude);e=e===n?a.longitude:Math.min(e,a.longitude);if(isFinite(a.altitude)&&K.isValid(a.altitudeReference)){g=a.altitude;f=a.altitudeReference}}}return w.fromEdges(b,e,c,d,g,f)};w.fromString=function(g){var b=null,a=g.split(",");if(a&&a.length==4){var c=parseFloat(a[0]),f=parseFloat(a[1]),d=parseFloat(a[2]),e=parseFloat(a[3]);b=w.fromEdges(c,f,d,e)}return b};p.LocationRect=w;var I={road:"r",aerial:"a",birdseye:"be"};p.MapTypeId=I;var u={visible:0,hidden:1,isValid:function(a){return a===u.hidden||a===u.visible}};p.LabelOverlay=u;var V={viewport:0,page:1,control:2,isValid:function(a){return a===V.viewport||a===V.page||a===V.control}};p.PixelReference=V;var a=new function(){var b=this,a=L+"events";this.addHandler=function(b,c,f){if(b&&typeof c==="string"&&typeof f==="function"){b[a]=b[a]||{};var e=b[a][c]||[];b[a][c]=e;var d={target:b,eventName:c,handler:f};e.push(d);return d}};this.addThrottledHandler=function(f,d,e,c){var a=b.addHandler(f,d,e);a.throttleInterval=c;return a};this.removeHandler=function(c){if(c){var g=c.target,f=c.eventName;if(b.hasHandler(g,f)){var d=g[a][f],e=d.length;while(e--)if(c===d[e]){c.willBeInvokedBy&&window.clearInterval(c.willBeInvokedBy);d.splice(e,1)}}}};this.hasHandler=function(b,c){return b&&b[a]&&b[a][c]&&b[a][c].length};this.invoke=function(h,f,d){if(b.hasHandler(h,f)){var i=new Date,e=h[a][f],j=e.length,c;while(j--){c=e[j];if(c.handler)if(!c.throttleInterval)c.handler(d);else if(c.willBeInvokedBy)c.willBeInvokedWithArgs=d;else{var g=c.throttleInterval-(i-(c.lastInvokedAt||new Date(0)));if(g<=0){c.lastInvokedAt=i;c.handler(d)}else{c.willBeInvokedWithArgs=d;c.willBeInvokedBy=window.setTimeout(function(){var a=c;return function(){var b=a.willBeInvokedWithArgs;delete a.willBeInvokedBy;delete a.willBeInvokedWithArgs;a.lastInvokedAt=new Date;a.handler&&a.handler(b)}}(),g)}}}}}};p.Events=a;function yb(c){var h=this,k=c.onresize!==n,d,f,e,i=m(c),j=m(window);this.getWidth=function(){return c.offsetWidth};this.getHeight=function(){return c.offsetHeight};this.startMonitoring=function(){if(k){i.add_event("resize",b);if(g.useOnResize)c.onresize=b}else{if(!d)d=window.setInterval(b,1e3);j.add_event("resize",b)}};this.stopMonitoring=function(){i.remove_event("resize",b);if(g.useOnResize)if(c.onresize===b)c.onresize=null;if(d){window.clearInterval(d);_timeoutId=null}j.remove_event("resize",b)};this.poll=function(){f=null;e=null;b()};function b(){var c=h.getWidth(),b=h.getHeight();if(c!==f||b!==e){f=c;e=b;a.invoke(h,"resize",{width:c,height:b})}}}o.ElementSizeHelper=yb;var tb={singleByteHex:function(c){if(!c)return"";for(var a=c.toString(16),b=a.length;b<2;b++)a="0"+a;return a},twoByteHex:function(c){if(!c)return"";for(var a=c.toString(16),b=a.length;b<4;b++)a="0"+a;return a},encodeUrl:function(d){if(!d)return"";for(var a,e=d.length,b=new Array(e),c=0;c<e;++c){a=d.charCodeAt(c);if(a>96&&a<123||a>64&&a<91||a>47&&a<58||a==46||a==45||a==95)b.push(String.fromCharCode(a));else if(a>127){b.push("%u");b.push(tb.twoByteHex(a))}else{b.push("%");b.push(tb.singleByteHex(a))}}return b.join("")}};o.IOSec=tb;var ib=[];function kb(nb,f){var c=this,p=new sb(this),G=nb,h,M=true,O,N,A,C,v,w,s,x="z-index:0;overflow:hidden;background-color:";if(f&&f.backgroundColor)x+=D.clone(f.backgroundColor).toHex()+";";else x+="#F4F2EE;";var ob=x+(m.Browser.is_in_quirks_mode?"position:absolute;top:0;left:0;width:100%;height:100%":"position:absolute;left:0;top:0;right:0;bottom:0"),mb=x+"position:relative;width:{width}px;height:{height}px",P=true,E=true,z,L,j,y,J,q,e=null,T,l=[],H=null,i={width:null,height:null,disableUserInput:false,disableKeyboardInput:false,disableMouseInput:false,disableTouchInput:false,disableZooming:false,disablePanning:false,labelOverlay:u.visible,useInertia:true,inertiaIntensity:-1,tileBuffer:0,showBackground:null},gb=new bb,X={};function rb(){f=f||{};h=k();h.className="MicrosoftMap";if(g.allowFocus)j=k("button","position:fixed;width:1px;height:1px;left:0;top:0;padding:0;font-size:0;line-height:0;border:0;background:transparent;",h);z=ab();L=ab();G.appendChild(h);y=m(document);J=m(z);q=m(h);a.invoke(kb,"mapcreationstart",{map:c,options:f});T=f.credentials;p.authenticate(f.credentials);typeof B!=="undefined"&&B.authenticate(c.getCredentials);s=new yb(h);a.addHandler(s,"resize",pb);jb(f.width,f.height);b.ddCoreStyles&&b.ddCoreStyles!==""&&W.downloadStyles(b.ddCoreStyles);var d=Cb(f);d.mapTypeId=d.mapTypeId||I.auto||I.road;d.animate=false;c.setView(d);window.top==window.self&&c.focus();q.add_event("mousedown",c.focus).add_event("touchstart",c.focus);t.dispatch(function(){var a={showDashboard:f.showDashboard,showMapTypeSelector:f.showMapTypeSelector,showDualMapTypeSelector:f.showDualMapTypeSelector,disableBirdseye:f.disableBirdseye,showBreadcrumb:f.showBreadcrumb,showScalebar:f.showScalebar,showLogo:f.showLogo,clickable:f.enableClickableLogo,enableSearch:f.enableSearchLogo,showCopyright:f.showCopyright};p.showOverlays(a)});if(f.showHotRegions===true){t.dispatch(function(){p.showHotRegions(f.disableLabelZoom)});f.showVenueMapsExplorer===true&&t.dispatch(function(){p.showVenueMapsExplorer()})}if(f.fixedMapPosition===true)P=false}this.addComponent=function(b,d){X[b]=d;a.invoke(c,"componentadded",{componentName:b,component:d})};this.getComponent=function(a){return X[a]};this.getCredentials=function(a){if(p)p.getCredentials(a);else typeof a==="function"&&a(null)};this.getWidth=function(){return O};this.getHeight=function(){return N};this.getPageX=function(){o();return A};this.getPageY=function(){o();return C};this.getViewportX=function(){o();return v};this.getViewportY=function(){o();return w};this.focus=function(){if(!i.disableUserInput&&!i.disableKeyboardInput){j&&(j.offsetWidth>0||j.offsetHeight>0)&&j.focus();if(Z!==c){Z&&Z.blur();j&&y.add_event("keydown",eb).add_event("keypress",cb).add_event("keyup",hb);Z=c;a.invoke(c,"focus")}}};this.blur=function(){if(j){j.blur();y.remove_event("keydown",eb).remove_event("keypress",cb).remove_event("keyup",hb)}if(Z===c){a.invoke(c,"blur");Z=null}};this.getRootElement=function(){return h};this.getModeLayer=function(){return z};this.getUserLayer=function(){return L};this.updateMapPosition=Q;this.dispose=function(){if(c){a.invoke(c,"ondispose",null);p.dispose();c.blur();c.entities.clear();e&&e.deactivating&&e.deactivating();R();e&&e.deactivated&&e.deactivated();e=null;l.length=0;s.stopMonitoring();s=null;q.remove_event("mousedown",c.focus).remove_event("touchstart",c.focus);G.removeChild(h);h=null;G=null;z=null;L=null;y=null;J=null;q=null;p=null;var b=ib.length;while(b--)ib[b]===c&&ib.splice(b,1);c=null}};this.setView=function(b){c.setOptions(b);if(b.mapTypeId){var d=l[b.mapTypeId];if(d){this.entities=gb;var g=e,f=null;if(g)f=g.getCenter();d.activating();H=d;qb(d.getMode());d.activated();a.invoke(c,"maptypechanged");if(!b.center&&!b.bounds&&f&&g!==e){b.center=f;if(b.animate==null)b.animate=false}}}e.setView(b)};this.setOptions=function(d){var b,e=false;for(b in d)if(i[b]!==n&&d[b]!==n&&i[b]!==d[b]){i[b]=d[b];e=true}if(e){i.width!==n&&i.height!==n&&jb(i.width,i.height);a.invoke(c,"optionschanged")}};this.getOptions=function(){return Cb(i)};this.getCenter=function(){return e.getCenter()};this.getZoom=function(){return e.getZoom()};this.getZoomRange=function(){return{min:b.minMercatorZoom,max:b.maxMercatorZoom}};this.getHeading=function(){return e.getHeading()};this.getBounds=function(){return e.getBounds()};this.getMetersPerPixel=function(){return e.getMetersPerPixel()};this.getTargetCenter=function(){return e.getTargetCenter()};this.getTargetZoom=function(){return e.getTargetZoom()};this.getTargetHeading=function(){return e.getTargetHeading()};this.getTargetBounds=function(){return e.getTargetBounds()};this.getTargetMetersPerPixel=function(){return e.getTargetMetersPerPixel()};this.tryLocationToPixel=function(h,f){if(!e.tryLocationToViewport)return null;var a=e.tryLocationToViewport(h);if(a&&f){var b=0,c=0;switch(f){case V.page:o();b=v;c=w;break;case V.control:o();b=v-A;c=w-C}var d;if(b||c)if(fb(a)){var g=a.length;while(g--){d=a[g];if(d){d.x+=b;d.y+=c}}}else{a.x+=b;a.y+=c}}return a};this.tryPixelToLocation=function(a,h){if(!e.tryViewportToLocation)return null;var g=a;if(h){var b=0,c=0;switch(h){case V.page:o();b=v;c=w;break;case V.control:o();b=v-A;c=w-C}if(b||c)if(fb(a)){var f=a.length;g=new Array(f);while(f--)g[f]=new d(a[f].x-b,a[f].y-c)}else g=new d(a.x-b,a.y-c)}return e.tryViewportToLocation(g)};this.isDownloadingTiles=function(){return e&&e.isDownloadingTiles?e.isDownloadingTiles():false};this.getImageryId=function(){return e&&e.getImageryId?e.getImageryId():""};this.isMercator=function(){return e.isMercator?e.isMercator():false};this.isRotationEnabled=function(){return e.isRotationEnabled()};this.getCopyrights=function(a){e&&e.getCopyrights&&e.getCopyrights(a);return[]};this.getMode=function(){return e.getPublicApi?e.getPublicApi():{}};this.setMapType=function(a){this.setView({mapTypeId:a})};this.getMapTypeId=function(){return H?H.getMapTypeId():""};this.registerMapType=function(a){var b=a.getMapTypeId();if(l[b])throw"InvalidOperation: already registered";l.push(a);l[b]=a};this.entities=gb;var r=[["viewchangestart",null],["viewchange",null],["viewchangeend",null],["targetviewchanged",null],["imagerychanged",null],["copyrightchanged",null],["tiledownloadcomplete",null],["click",null],["dblclick",null],["rightclick",null],["mousedown",null],["mouseup",null],["mousemove",null],["mousewheel",null]];function lb(d){var b=r.length;while(b--)r[b][1]=a.addHandler(d,r[b][0],function(){var d=r[b][0];return function(b){a.invoke(c,d,b)}}());m(h).add_event("mouseenter",function(b){a.invoke(c,"mouseover",new Y(c,S.map,c,"mouseover",b.clientX,b.clientX,0,false,b))});m(h).add_event("mouseleave",function(b){a.invoke(c,"mouseout",new Y(c,S.map,c,"mouseout",b.clientX,b.clientX,0,false,b))})}function R(){var b,d=r.length;while(d--){b=r[d][1];b&&a.removeHandler(b);r[d][1]=null}m(h).remove_event("mouseenter",function(b){a.invoke(c,"mouseover",new Y(c,S.map,c,"mouseover",b.clientX,b.clientX,0,false,b))});m(h).remove_event("mouseleave",function(b){a.invoke(c,"mouseout",new Y(c,S.map,c,"mouseout",b.clientX,b.clientX,0,false,b))})}function ab(){return k("div","z-index:0;position:absolute;left:50%;top:50%;"+g.safariRenderHack,h)}function jb(b,a){if(b>0&&a>0){s.stopMonitoring();M=false;h.style.cssText=mb.replace("{width}",b).replace("{height}",a);db(b,a)}else{h.style.cssText=ob;M=true;s.startMonitoring();s.poll()}}function db(d,b){d=Math.round(Math.max(1,d));b=Math.round(Math.max(1,b));if(d!==O||b!==N){O=d;N=b;a.invoke(c,"resize")}}function pb(a){M&&db(a.width,a.height)}function o(){if(E){var b=q.get_absolute_pos();A=b.x;C=b.y;var a=J.get_absolute_pos();v=a.x;w=a.y;E=false;P&&t.dispatch(Q)}}function Q(){E=true}function U(b){for(var a in l)if(l.hasOwnProperty(a)&&l[a].getMode()===b)return l[a];return null}function qb(b){if(e!=b){var d=e,g=U(d),h=U(b),f="MapTypeId_";b.activating&&b.activating(c,{credentials:T});d&&d.deactivating&&d.deactivating();R();e=b;g&&q.remove_class(f+g.getMapTypeId());d&&d.deactivated&&d.deactivated();h&&q.add_class(f+h.getMapTypeId());lb(b);b.activated&&b.activated();a.invoke(c,"modechanged");a.invoke(c,"imagerychanged");a.invoke(c,"copyrightchanged")}}function F(d){if(Z!==c)return false;var a=d.target;if(a){var b=a.tagName;if(b==="INPUT"&&a.type==="text"||b==="TEXTAREA"||b==="SELECT")return false}return true}function K(e,b){var f=false;if(a.hasHandler(c,e)){var d=new Ab(e,b.keyCode,b.altKey,b.ctrlKey,b.shiftKey);d.originalEvent=b;a.invoke(c,e,d);f=d.handled||d.keyboardHandled}f&&Db(b);return f}function eb(a){if(F(a)){var b=K("keydown",a);b&&a.target===j&&Db(a)}}function hb(a){F(a)&&K("keyup",a)}function cb(a){F(a)&&K("keypress",a)}rb();ib.push(c);PRF.add("MapObject instantiated")}kb.getAllInstances=function(){return ib};kb.getVersion=function(){return b.version};var Z;p.Map=kb;function U(b,d){var a=b,c=d;this.getMapTypeId=function(){return a};this.getMode=function(){return c};this.activating=function(){};this.activated=function(){}}o.MapType=U;var W=new function(){var l=this,k=5e3,d,g=1,a={};window.microsoftMapsNetworkCallback=h;this.downloadScript=function(a){return f(a)};this.downloadStyles=function(c,a,b){j(c,a,b)};this.getObjectAsync=function(d,h,j,c,e){var b=e;if(!b){b="r"+ ++g;d=d.replace("{jsono}",b)}if(typeof c!=="number"||c<=0)c=k;a[b]={callback:h,userData:j,elScript:f(d),timeoutId:window.setTimeout(function(){i(b)},c)};return b};this.isRequestCompleted=function(b){return a[b]?false:true};this.abortRequest=function(b){if(a[b])delete a[b]};function h(d,c){t.dispatch(function(){if(c){var e=a[c];if(e){delete a[c];e.timeoutId&&window.clearTimeout(e.timeoutId);e.callback(d,{requestId:c,success:true,userData:e.userData});b(e.elScript)}}})}function i(d){if(d){var c=a[d];if(c){delete a[d];c.callback(null,{requestId:d,success:false,userData:c.userData});b(c.elScript)}}}function f(d){var b=c();if(b){var a=document.createElement("script");a.type="text/javascript";a.language="javascript";a.src=d;b.appendChild(a);return a}}function j(f,e,d){var b=c();if(b){var a=document.createElement("link");a.rel=e?"alternate stylesheet":"stylesheet";if(d)a.media=d;a.type="text/css";a.rev="stylesheet";a.href=f;b.appendChild(a);return a}}function c(){if(!d){var a=document.getElementsByTagName("head");if(a.length>0)d=a[0]}return d}function e(a,d,c){b(c);a&&a(d)}this.getObjectAsyncCacheFriendly=function(f,b,d){var a=document.createElement("script");a.type="text/javascript";a.language="javascript";a.src=f;if(navigator.userAgent.indexOf("IE")>=0)a.onreadystatechange=function(){if(a&&("loaded"==a.readyState||"complete"==a.readyState)){a.onreadystatechange=null;e(b,d,a)}};else a.onload=function(){a.onload=null;e(b,d,a)};c().appendChild(a);return a};function b(a){if(a){if(a.src)a.src="";a.parentNode&&a.parentNode.removeChild(a)}}};o.Network=W;var S={map:"map",pushpin:"pushpin",polyline:"polyline",polygon:"polygon",infobox:"infobox"};function Y(j,d,g,f,h,i,e,c,a){var b=j;this.pageX=h;this.pageY=i;this.eventName=f;this.targetType=d;this.target=g;this.wheelDelta=e;this.isTouchEvent=c;this.originalEvent=a;this.isPrimary=a.which===1;this.isSecondary=a.which===3;this.getX=function(){return this.pageX-b.getViewportX()};this.getY=function(){return this.pageY-b.getViewportY()}}Y.prototype={handled:false,toString:function(){return"[MouseEventArgs]"}};function Ab(a,d,e,c,b){this.eventName=a;this.keyCode=d;this.altKey=e;this.ctrlKey=c;this.shiftKey=b;this.originalEvent={}}Ab.prototype={handled:false,toString:function(){return"[KeyEventArgs]"}};function D(a,d,c,b){this.a=a;this.r=d;this.g=c;this.b=b}D.prototype={clone:function(){return new D(this.a,this.r,this.g,this.b)},getOpacity:function(){return isFinite(this.a)?this.a/255:1},toHex:function(){var c=this.r,b=this.g,a=this.b;return"#"+(c<16?"0":"")+Number(c).toString(16)+(b<16?"0":"")+Number(b).toString(16)+(a<16?"0":"")+Number(a).toString(16)},toString:function(){return"[Color "+this.toHex()+"]"}};D.clone=function(a){return new D(a.a,a.r,a.g,a.b)};D.fromHex=function(c){var b=null,a=/^#(\w{2})(\w{2})(\w{2})$/.exec(c);if(a&&a.length==4)b=new D(255,parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16));return b};p.Color=D;function bb(k){var d=this,e="_ech"+jb.getNext(),c=[[e+"a","entityadded",j],[e+"r","entityremoved",i],[e+"c","entitychanged",h]],b=[];this.get=function(a){return b[a]};this.getLength=function(){return b.length};this.push=function(a){b.push(a);g(a,b.length)};this.insert=function(a,c){b.splice(c,0,a);g(a,c)};this.pop=function(){var a=b.pop();f(a);return a};this.removeAt=function(c){var a=b[c];b.splice(c,1);f(a);return a};this.remove=function(d){var c=null,a=b.length;while(a--)if(b[a]===d){c=this.removeAt(a);break}return c};this.clear=function(){while(b.length>0)this.pop()};this.indexOf=function(c){var a=b.length;while(a--)if(b[a]===c){foundEntity=true;break}return a};function h(b){if(!b.collection)b.collection=d;a.invoke(d,"entitychanged",b)}function j(b){a.invoke(d,"entityadded",b)}function i(b){a.invoke(d,"entityremoved",b)}function g(e,f){var b=c.length;while(b--)if(!e[c[b][0]])e[c[b][0]]=a.addHandler(e,c[b][1],c[b][2]);a.invoke(d,"entityadded",{collection:d,entity:e,index:f})}function f(b){if(b){var e=c.length;while(e--){a.removeHandler(b[c[e][0]]);b[c[e][0]]=null}a.invoke(d,"entityremoved",{collection:d,entity:b})}}this.setOptions(k)}bb.prototype={_visible:true,_zIndex:null,setOptions:function(b,d){var c=false;if(b){if(typeof b.visible=="boolean"){this._visible=b.visible;c=true}if(typeof b.zIndex!="undefined"){this._zIndex=b.zIndex;c=true}c&&!d&&a.invoke(this,"entitychanged",{entity:this})}return c},getVisible:function(){return this._visible},getZIndex:function(){return this._zIndex},toString:function(){return"[EntityCollection]"}};p.EntityCollection=bb;function Eb(a,b){this._location=a;this.setOptions(b,false)}Eb.prototype={_width:256,_height:126,_showCloseButton:true,_offset:new d(0,0),_htmlContent:null,_id:null,_visible:true,_zIndex:null,_options:null,setLocation:function(b){this._location=b;a.invoke(this,"entitychanged",{entity:this})},getLocation:function(){return this._location},setOptions:function(b,e){if(b){var c=false;this._options=b;var f=this.setOptions.caller!=null;if(b.width>0){this._width=b.width;c=true}if(b.height>0){this._height=b.height;c=true}if(typeof b.showCloseButton==="boolean"){this._showCloseButton=b.showCloseButton;c=true}if(b.offset){this._offset=d.clone(b.offset);c=true}if(typeof b.htmlContent==="string"){this._htmlContent=b.htmlContent;c=true}if(typeof b.id==="string"){this._id=b.id;c=true}if(typeof b.visible==="boolean"){this._visible=b.visible;c=true}if(isFinite(b.zIndex)){this._zIndex=b.zIndex;c=true}}c&&(e===null||!e)&&a.invoke(this,"entitychanged",{entity:this});return c},getWidth:function(){return this._width},getHeight:function(){return this._height},getShowCloseButton:function(){return this._showCloseButton},getOffset:function(){return this._offset},getOptions:function(){return this._options},setHtmlContent:function(b){var c=this._htmlContent!=b;this._htmlContent=b;c&&a.invoke(this,"entitychanged",{entity:this})},getHtmlContent:function(){return this._htmlContent},getId:function(){return this._id},getVisible:function(){return this._visible},getZIndex:function(){return this._zIndex},toString:function(){return"[InfoboxBase]"}};function Nb(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.baseConstructor=b;a.superClass=b.prototype}function s(b,a){s.baseConstructor.call(this,b,a);this.setOptions(a)}Nb(s,Eb);p.Infobox=s;s.prototype._title=null;s.prototype._description=null;s.prototype._titleClickHandler=null;s.prototype._showPointer=true;s.prototype._actions=[];s.prototype.setOptions=function(b,d){if(b){var c=s.superClass.setOptions.call(this,b,false);if(typeof b.title==="string"){this._title=b.title;c=true}if(typeof b.description==="string"){this._description=b.description;c=true}if(typeof b.showPointer==="boolean"){this._showPointer=b.showPointer;c=true}if(typeof b.actions==="object"){this._actions=b.actions;c=true}if(typeof b.titleClickHandler==="function"){this._titleClickHandler=b.titleClickHandler;c=true}c&&(d===null||!d)&&a.invoke(this,"entitychanged",{entity:this})}};s.prototype.getActions=function(){return this._actions};s.prototype.getTitle=function(){return this._title};s.prototype.getTitleClickHandler=function(){return this._titleClickHandler};s.prototype.getDescription=function(){return this._description};s.prototype.getDescription=function(){return this._description};s.prototype.getShowPointer=function(){return this._showPointer};s.prototype.getAnchor=function(){var b=28,a=38;return this._showPointer?new d(20+b/2,this.getHeight()+a):new d(0,this.getHeight())};s.prototype.getOptions=function(){return s.superClass.getOptions.call(this)};s.prototype.toString=function(){return"[Infobox]"};function hb(a,b){this._location=a;this.setOptions(b)}hb.prototype={_icon:b.pushpinImageUrl,_width:25,_height:39,_draggable:false,_anchor:null,_calculatedAnchor:new d(13,39),_text:null,_textOffset:new d(0,5),_id:null,_typeName:null,_visible:true,_zIndex:null,setLocation:function(b){this._location=b;a.invoke(this,"entitychanged",{entity:this})},getLocation:function(){return this._location},setOptions:function(b){if(b){var c=false;if(typeof b.icon==="string"){this._icon=b.icon;c=true}if(b.width>0&&b.height>0){this._width=b.width;this._height=b.height;c=true}if(typeof b.draggable==="boolean"){this._draggable=b.draggable;c=true}if(b.anchor){this._anchor=d.clone(b.anchor);c=true}if(typeof b.text==="string"){this._text=b.text;c=true}if(b.textOffset){this._textOffset=d.clone(b.textOffset);c=true}if(typeof b.id==="string"){this._id=b.id;c=true}if(typeof b.typeName==="string"){this._typeName=b.typeName;c=true}if(typeof b.visible==="boolean"){this._visible=b.visible;c=true}if(isFinite(b.zIndex)){this._zIndex=b.zIndex;c=true}if(c){this._calculatedAnchor=this._anchor?this._anchor:new d(Math.ceil(this._width/2),this._height);a.invoke(this,"entitychanged",{entity:this})}}},getIcon:function(){return this._icon},getWidth:function(){return this._width},getHeight:function(){return this._height},getDraggable:function(){return this._draggable},getAnchor:function(){return this._calculatedAnchor},getText:function(){return this._text},getTextOffset:function(){return this._textOffset},getId:function(){return this._id},getTypeName:function(){return this._typeName},getVisible:function(){return this._visible},getZIndex:function(){return this._zIndex},toString:function(){return"[Pushpin]"}};p.Pushpin=hb;function eb(a,b){this._locations=a;this.setOptions(b)}eb.prototype={_strokeColor:new D(255,255,0,0),_strokeThickness:3,_strokeDashArray:"none",_visible:true,_id:null,setLocations:function(b){this._locations=b;a.invoke(this,"entitychanged",{entity:this})},getLocations:function(){return this._locations},setOptions:function(b){if(b){var c=false;if(b.strokeColor){this._strokeColor=D.clone(b.strokeColor);c=true}if(isFinite(b.strokeThickness)){this._strokeThickness=b.strokeThickness;c=true}if(typeof b.strokeDashArray==="string"){this._strokeDashArray=b.strokeDashArray;c=true}if(typeof b.visible==="boolean"){this._visible=b.visible;c=true}if(typeof b.id==="string"){this._id=b.id;c=true}c&&a.invoke(this,"entitychanged",{entity:this})}},getStrokeColor:function(){return this._strokeColor},getStrokeThickness:function(){return this._strokeThickness},getStrokeDashArray:function(){return this._strokeDashArray},getVisible:function(){return this._visible},getId:function(){return this._id},toString:function(){return"[Polyline]"}};p.Polyline=eb;function ab(a,b){this._locations=a;this.setOptions(b)}ab.prototype={_strokeColor:new D(255,255,0,0),_strokeThickness:3,_strokeDashArray:"none",_fillColor:new D(255,0,0,255),_visible:true,setLocations:function(b){this._locations=b;a.invoke(this,"entitychanged",{entity:this})},getLocations:function(){return this._locations},setOptions:function(b){if(b){var c=false;if(b.strokeColor){this._strokeColor=D.clone(b.strokeColor);c=true}if(isFinite(b.strokeThickness)){this._strokeThickness=b.strokeThickness;c=true}if(typeof b.strokeDashArray==="string"){this._strokeDashArray=b.strokeDashArray;c=true}if(b.fillColor){this._fillColor=D.clone(b.fillColor);c=true}if(typeof b.visible==="boolean"){this._visible=b.visible;c=true}c&&a.invoke(this,"entitychanged",{entity:this})}},getStrokeColor:function(){return this._strokeColor},getStrokeThickness:function(){return this._strokeThickness},getStrokeDashArray:function(){return this._strokeDashArray},getFillColor:function(){return this._fillColor},getVisible:function(){return this._visible},toString:function(){return"[Polygon]"}};p.Polygon=ab;var wb={show:"s",hide:"h",auto:"a"};function ob(b){var i=this,g=true,h=0,f=1,d={},e=wb.auto;this.setOptions=function(b){if(b){var c=false;if(typeof b.visible==="boolean"){g=b.visible;c=true}if(T(b.zIndex)){h=b.zIndex;c=true}if(T(b.opacity)){f=b.opacity;c=true}if(b.animationDisplay){e=b.animationDisplay;c=true}c&&a.invoke(i,"entitychanged",{entity:i})}};var j=typeof G!=="undefined"?G:{mercator:{}};for(var c in j)if(b[c]instanceof rb)d[c]=b[c];this.getVisible=function(){return g};this.getZIndex=function(){return h};this.getOpacity=function(){return f};this.getAnimation=function(){return e};this.getTileSource=function(a){return d[a]};this.setOptions(b)}ob.prototype={toString:function(){return"[TileLayer]"}};p.AnimationVisibility=wb;p.TileLayer=ob;function rb(a){var f=b.defaultTileSize,e=b.defaultTileSize,c,d;if(isFinite(a.width))f=a.width;if(isFinite(a.height))e=a.height;if(typeof a.uriConstructor==="string"){c=a.uriConstructor;d=a.uriConstructor}else{if(typeof a.uriConstructor==="function")c=a.uriConstructor;if(typeof a.uriFormat==="string")d=a.uriFormat}this.getWidth=function(){return f};this.getHeight=function(){return e};this.getUriConstructor=function(){return c};this.getUriFormat=function(){return d}}rb.prototype={toString:function(){return"[TileSource]"}};p.TileSource=rb;if(!p.Globals.disableGeoLocation){var Ib=function(b){var d=null,k=128,o=new D(150,0,163,239),p=new D(25,0,163,239),a=0,i=navigator&&navigator.geolocation,g=this,j=r.earthRadiusInMeters,c=r.earthMinorAxisRadiusInMeters,e=r.flatteningOfEllipsoidWGS84;this.getCurrentPosition=function(b){g.removeAccuracyCircle();if(i&&a===0){a=Math.random();navigator.geolocation.getCurrentPosition(function(c){m(c,b,a)},function(c){n(c,b,a)},b)}else if(b&&b.errorCallback){var c=i?4:5;b.errorCallback({internalError:null,errorCode:c})}};this.cancelCurrentRequest=function(){a=0};function m(c,b,e){if(a&&e===a&&c&&c.coords){var d=new l(c.coords.latitude,c.coords.longitude,c.coords.altitude);(!b||b&&b.showAccuracyCircle!=false)&&g.addAccuracyCircle(d,c.coords.accuracy,k,{displayOnMap:true});(!b||b&&b.updateMapView!=false)&&q(c);b&&b.successCallback&&b.successCallback({center:d,position:c})}a=0}function n(c,b,d){a&&d===a&&b.errorCallback&&b.errorCallback({internalError:c,errorCode:c.code});a=0}function q(a){if(a)if(a.coords.accuracy<300)b.setView({center:new l(a.coords.latitude,a.coords.longitude,a.coords.altitude),zoom:16});else{var h=f(a.coords.latitude,a.coords.longitude,0,a.coords.accuracy),e=(h.latitude-a.coords.latitude)*2,c=b.getHeight(),d=b.getWidth(),g=c>d?c:d;b.setView({bounds:new w(new l(a.coords.latitude,a.coords.longitude,a.coords.altitude),e,e),padding:g/3})}}this.addAccuracyCircle=function(e,a,c,i){var j=null;if(e&&c&&a&&e instanceof l&&T(c)&&T(a)){for(var h=[],m=e.latitude,n=e.longitude,k=0;k<c;k++){var t=k/c*360,r=f(m,n,t,a);h.push(r)}var s=f(m,n,0,a);h.push(s);var q=i.polygonOptions||{fillColor:p,strokeColor:o};j=new ab(h,q);if(i&&i.displayOnMap!=false){g.removeAccuracyCircle();d=j;b.entities.push(d)}}return j};this.removeAccuracyCircle=function(){if(d){b.entities.remove(d);d=null}};function f(F,E,G,z){var i=h,r=i.degreesToRadians(G),m=(1-e)*Math.tan(i.degreesToRadians(F)),o=Math.cos(r),y=Math.sin(r),g=1/Math.sqrt(1+m*m),q=g*y,x=q*q,n=1-x,s=Math.atan2(m,Math.cos(r)),f=n*((j*j-c*c)/(c*c)),C=1+f/16384*(4096+f*(-768+f*(320-175*f))),u=f/1024*(256+f*(-128+f*(74-47*f))),a=z/(c*C),A=2*Math.PI,b=Math.sin(a),p=2*s+a,d=Math.cos(p);while(Math.abs(a-A)>1e-12){p=2*s+a;d=Math.cos(p);var w=d*d;b=Math.sin(a);var L=Math.cos(a)*(-1+2*w),M=u/6*d*(-3+4*b*b)*(-3+4*w),D=u*b*(d+u/4*(L-M));A=a;a=z/(c*C)+D}d=Math.cos(2*s+a);b=Math.sin(a);var k=Math.cos(a),t=m*g,B=t*b-g*k*o,I=Math.atan2(t*k+g*b*o,(1-e)*Math.sqrt(x+B*B)),H=Math.atan2(b*y,g*k-t*b*o),v=e/16*n*(4+e*(4-3*n)),K=a+v*b*(d+v*k*(-1+2*d*d)),N=H-(1-v)*e*q*K,J=(i.degreesToRadians(E)+N+3*Math.PI)%(2*Math.PI)-Math.PI;return new l(i.radiansToDegrees(I),i.radiansToDegrees(J))}};p.GeoLocationProvider=Ib}function sb(a){this._map=a;this.dispose=function(){this._map=null}}o.DelayMap=sb;var F=new function(){var a={};this.register=function(d,e,b){var c=b?b:{};a[d]={key:d,downloadScript:true,loaded:false,queue:[],scriptUrl:e,styleUrls:c.styleUrls?c.styleUrls:[]}};function c(g,f){var c=a[g];if(c){var h=c.downloadScript;c.downloadScript=false;if(c.loaded)b(g,f);else{f&&c.queue.push(f);if(h){p.InternalNamespaceForDelay=o;W.downloadScript(c.scriptUrl);for(var e=c.styleUrls,d=0;d<e.length;d++)e[d]&&W.downloadStyles(e[d])}}}}this.add=function(e,a,d,b){c(e,a?{obj:a,name:d,args:b}:null)};this.load=function(b,a){PRF.start(b);c(b,a&&typeof a.callback==="function"?{callback:a.callback}:null)};function b(b,a){if(typeof a.callback==="function")a.callback(b);else a.obj&&a.obj[a.name].apply(a.obj,a.args)}this.done=function(g){var c=a[g];if(c){c.loaded=true;for(var f=c.queue,d=0;d<f.length;d++){var h=f[d];b(g,h)}var e=0;for(var i in a)if(a.hasOwnProperty(i))++e;if(e===0)delete p.InternalNamespaceForDelay}}};p.loadModule=F.load;p.registerModule=F.register;p.moduleLoaded=F.done;o.Dynamic=F;!p.Globals.disableDirections&&F.register("Microsoft.Maps.Directions",b.ddDirectionsJs,{styleUrls:[b.ddDirectionsCss]});!p.Globals.disableStreetside&&F.register("Microsoft.Maps.Streetside",b.ddStreetsideControl,{styleUrls:[b.ddStreetsideStyles]});!p.Globals.disableVenueMaps&&F.register("Microsoft.Maps.VenueMaps",b.ddVenueMaps);var cb="Microsoft.Maps.Overlays",Fb=[b.ddDelayStyles];g.isIE6&&Fb.push(b.ddDelayStylesIE6);F.register(cb,b.ddDelayControl,{styleUrls:Fb});sb.prototype={showOverlays:function(){F.add(cb,this,"showOverlays",arguments)},showHotRegions:function(){F.add(cb,this,"showHotRegions",arguments)},showVenueMapsExplorer:function(){F.add(cb,this,"showVenueMapsExplorer",arguments)},authenticate:function(){F.add(cb,this,"authenticate",arguments)},getCredentials:function(){F.add(cb,this,"getCredentials",arguments)}};F.register("Microsoft.Maps.Traffic",b.ddTraffic);F.register("Microsoft.Maps.Overlays.Style",b.ddOverlaysStyleV2Js,{styleUrls:[b.ddOverlaysStyleV2Css],version:"v2"});var h={LOGE2:Math.log(2),degreesPerRadian:180/Math.PI,radiansPerDegree:Math.PI/180,log2:function(a){return Math.log(a)/h.LOGE2},ceilLog2:function(a){return Math.ceil(Math.log(a)/h.LOGE2)},lerpDouble:function(a,c,b){return a+b*(c-a)},normalizeDegrees:function(a){return(a%360+360)%360},distanceDegrees:function(b,c){var a=h.normalizeDegrees(b-c);return Math.min(a,360-a)},lerpAngle:function(c,b,d){var a=h.normalizeDegrees(c-b);if(a>180)a=a-360;return b+(1-d)*a},degreesToRadians:function(a){return a*h.radiansPerDegree},radiansToDegrees:function(a){return a*h.degreesPerRadian}};o.VectorMath=h;function c(a,b,c){this.x=a;this.y=b;this.z=c}c.prototype={normalize:function(){var b=this.getLength();if(b===0)return point;var a=1/b;return new c(this.x*a,this.y*a,this.z*a)},isZero:function(){return this.x===0&&this.y===0&&this.z===0},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},toPoint:function(){return new d(this.x,this.y)},clone:function(){return new c(this.x,this.y,this.z)},toString:function(){return"[Point3D "+this.x+","+this.y+","+this.z+"]"}};c.add=function(a,b){return new c(a.x+b.x,a.y+b.y,a.z+b.z)};c.subtract=function(a,b){return new c(a.x-b.x,a.y-b.y,a.z-b.z)};c.multiply=function(a,b){return new c(b*a.x,b*a.y,b*a.z)};c.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};c.cross=function(a,b){return new c(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z,a.x*b.y-a.y*b.x)};c.distanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e};c.lerp=function(a,b,d){return new c(a.x+(b.x-a.x)*d,a.y+(b.y-a.y)*d,a.z+(b.z-a.z)*d)};c.areEqual=function(a,b){return a&&b&&a.x===b.x&&a.y===b.y&&a.z===b.z};c.areAlmostEqual=function(a,b){return a&&b&&Math.abs(a.x-b.x)<H&&Math.abs(a.y-b.y)<H&&Math.abs(a.z-b.z)<H};o.Point3D=c;function z(b,a){this.width=b;this.height=a}z.prototype={clone:function(){return new z(this.width,this.height)},toString:function(){return"[Size "+this.width+","+this.height+"]"}};z.clone=function(a){return new z(a.width,a.height)};z.areEqual=function(a,b){return a&&b&&a.width===b.width&&a.height===b.height};o.Size=z;function E(c,d,b,a){this.x=c;this.y=d;this.width=b;this.height=a}E.prototype={getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height},getCenter:function(){return new d(this.x+this.width/2,this.y+this.height/2)},contains:function(a){return a.x>=this.x&&a.y>=this.y&&a.x<=this.getRight()&&a.y<=this.getBottom()},clone:function(){return new E(this.x,this.y,this.width,this.height)},toString:function(){return"[Rect "+this.x+","+this.y+" "+this.width+","+this.height+"]"}};E.union=function(){var g=fb(arguments[0])?arguments[0]:arguments,a=g[0],c=a.x,d=a.y,e=a.x+(a.width?a.width:0),f=a.y+(a.height?a.height:0),h=g.length;while(h--){var b=g[h];c=Math.min(c,b.x);d=Math.min(d,b.y);e=Math.max(e,b.x+(b.width?b.width:0));f=Math.max(f,b.y+(b.height?b.height:0))}return new E(c,d,e-c,f-d)};E.intersect=function(a,b){return!(a.getRight()<b.x||b.getRight()<a.x||a.getBottom()<b.y||b.getBottom()<a.y)};E.areEqual=function(a,b){return;a&&b&&a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height};o.Rect=E;function C(c,d,e,f,a,b){this.m11=c;this.m12=d;this.m21=e;this.m22=f;this.offsetX=a;this.offsetY=b}C.prototype={transform:function(a){return new d(a.x*this.m11+a.y*this.m21+this.offsetX,a.x*this.m12+a.y*this.m22+this.offsetY)},invert:function(){var a=this.m11*this.m22-this.m12*this.m21;if(a===0)throw"matrix cannot be inverted";return new C(this.m22/a,-1*this.m12/a,-1*this.m21/a,this.m11/a,(this.offsetY*this.m21-this.offsetX*this.m22)/a,(this.offsetX*this.m12-this.offsetY*this.m11)/a)},clone:function(){return new C(this.m11,this.m12,this.m21,this.m22,this.offsetX,this.offsetY)},toString:function(){return"[Matrix "+this.m11+", "+this.m12+", "+this.m21+", "+this.m22+", "+this.offsetX+", "+this.offsetY+"]"}};C.multiply=function(b,a){return new C(b.m11*a.m11+b.m12*a.m21,b.m11*a.m12+b.m12*a.m22,b.m21*a.m11+b.m22*a.m21,b.m21*a.m12+b.m22*a.m22,b.offsetX*a.m11+b.offsetY*a.m21+a.offsetX,b.offsetX*a.m12+b.offsetY*a.m22+a.offsetY)};C.unitToPoints=function(a,b,c){return new C(b.x-a.x,b.y-a.y,c.x-a.x,c.y-a.y,a.x,a.y)};C.conversion=function(c,d,e,f,g,h){var b=C.unitToPoints(c,d,e).invert(),a=C.unitToPoints(f,g,h);return C.multiply(b,a)};o.Matrix=C;function e(d,e,f,g,h,i,j,k,l,m,n,o,a,b,c,p){this.m11=d;this.m12=e;this.m13=f;this.m14=g;this.m21=h;this.m22=i;this.m23=j;this.m24=k;this.m31=l;this.m32=m;this.m33=n;this.m34=o;this.offsetX=a;this.offsetY=b;this.offsetZ=c;this.m44=p}e.prototype={multiplyBy:function(a){var e=this.m11,f=this.m12,g=this.m13,h=this.m14,i=this.m21,j=this.m22,k=this.m23,l=this.m24,m=this.m31,n=this.m32,o=this.m33,p=this.m34,b=this.offsetX,c=this.offsetY,d=this.offsetZ,q=this.m44;this.m11=e*a.m11+f*a.m21+g*a.m31+h*a.offsetX;this.m12=e*a.m12+f*a.m22+g*a.m32+h*a.offsetY;this.m13=e*a.m13+f*a.m23+g*a.m33+h*a.offsetZ;this.m14=e*a.m14+f*a.m24+g*a.m34+h*a.m44;this.m21=i*a.m11+j*a.m21+k*a.m31+l*a.offsetX;this.m22=i*a.m12+j*a.m22+k*a.m32+l*a.offsetY;this.m23=i*a.m13+j*a.m23+k*a.m33+l*a.offsetZ;this.m24=i*a.m14+j*a.m24+k*a.m34+l*a.m44;this.m31=m*a.m11+n*a.m21+o*a.m31+p*a.offsetX;this.m32=m*a.m12+n*a.m22+o*a.m32+p*a.offsetY;this.m33=m*a.m13+n*a.m23+o*a.m33+p*a.offsetZ;this.m34=m*a.m14+n*a.m24+o*a.m34+p*a.m44;this.offsetX=b*a.m11+c*a.m21+d*a.m31+q*a.offsetX;this.offsetY=b*a.m12+c*a.m22+d*a.m32+q*a.offsetY;this.offsetZ=b*a.m13+c*a.m23+d*a.m33+q*a.offsetZ;this.m44=b*a.m14+c*a.m24+d*a.m34+q*a.m44},transform:function(a){var d=a.x*this.m11+a.y*this.m21+this.offsetX,e=a.x*this.m12+a.y*this.m22+this.offsetY,f=a.x*this.m13+a.y*this.m23+this.offsetZ;if(a.z){d+=a.z*this.m31;e+=a.z*this.m32;f+=a.z*this.m33}if(this.m14!==0||this.m24!==0||this.m34!==0||this.m44!==1){var b=a.x*this.m14+a.y*this.m24+(a.z?a.z:0)*this.m34+this.m44;d/=b;e/=b;f/=b}return new c(d,e,f)},invert:function(){var j=this.m11,o=this.m12,p=this.m13,q=this.m14,k=this.m21,r=this.m22,s=this.m23,t=this.m24,l=this.m31,u=this.m32,v=this.m33,w=this.m34,i=this.offsetX,m=this.offsetY,n=this.offsetZ,x=this.m44,b=p*t-s*q,c=p*w-v*q,d=p*x-n*q,f=s*w-v*t,g=s*x-n*t,h=v*x-n*w,C=r*c-u*b-o*f,B=o*g-r*d+m*b,A=u*d-m*c-o*h,z=r*h-u*g+m*f,y=i*C+l*B+k*A+j*z;if(y===0||!isFinite(y))throw"InvalidOperation: Matrix3D.invert";var M=j*f-k*c+l*b,J=k*d-i*b-j*g,G=j*h-l*d+i*c,D=l*g-i*f-k*h;b=j*r-k*o;c=j*u-l*o;d=j*m-i*o;f=k*u-l*r;g=k*m-i*r;h=l*m-i*u;var O=p*f-s*c+v*b,L=s*d-n*b-p*g,I=p*h-v*d+n*c,F=v*g-n*f-s*h,N=t*c-w*b-q*f,K=q*g-t*d+x*b,H=w*d-x*c-q*h,E=t*h-w*g+x*f,a=1/y;return new e(z*a,A*a,B*a,C*a,D*a,G*a,J*a,M*a,E*a,H*a,K*a,N*a,F*a,I*a,L*a,O*a)},projectOnPlane:function(a){var b=this,g=a.a*b.m11+a.b*b.m12+a.c*b.m13-a.d*b.m14,h=a.a*b.m21+a.b*b.m22+a.c*b.m23-a.d*b.m24,d=a.a*b.m31+a.b*b.m32+a.c*b.m33-a.d*b.m34,f=a.a*b.offsetX+a.b*b.offsetY+a.c*b.offsetZ-a.d*b.m44;if(d===0)throw"InvalidOperation: Matrix3D.projectOnPlane";var c=-1/d,i=new e(1,0,g*c,0,0,1,h*c,0,0,0,1,0,0,0,f*c,1);return e.multiply(i,this)},clone:function(){return new e(this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.offsetX,this.offsetY,this.offsetZ,this.m44)},toString:function(){return"[Matrix3D "+this.m11+","+this.m12+","+this.m13+","+this.m14+", "+this.m21+","+this.m22+","+this.m23+","+this.m24+", "+this.m31+","+this.m32+","+this.m33+","+this.m34+", "+this.offsetX+","+this.offsetY+","+this.offsetZ+","+this.m44+"]"}};e.multiply=function(){for(var c=arguments.length,b=arguments[0].clone(),a=1;a<c;a++)b.multiplyBy(arguments[a]);return b};e.identity=function(){return new e(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)};e.translation=function(a){var b=arguments.length==3;return new e(1,0,0,0,0,1,0,0,0,0,1,0,b?arguments[0]:a.x,b?arguments[1]:a.y,b?arguments[2]:a.z,1)};e.scaling=function(a,c,d){var b=new e(a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1);if(arguments.length==3){b.m22=c;b.m33=d}return b};e.rotationX=function(d){var c=d*h.radiansPerDegree,b=Math.sin(c),a=Math.cos(c);return new e(1,0,0,0,0,a,b,0,0,-b,a,0,0,0,0,1)};e.rotationY=function(d){var c=d*h.radiansPerDegree,b=Math.sin(c),a=Math.cos(c);return new e(a,0,-b,0,0,1,0,0,b,0,a,0,0,0,0,1)};e.rotationZ=function(d){var c=d*h.radiansPerDegree,b=Math.sin(c),a=Math.cos(c);return new e(a,b,0,0,-b,a,0,0,0,0,1,0,0,0,0,1)};o.Matrix3D=e;function P(a,b,c,d){this.a=a;this.b=b;this.c=c;this.d=d}P.prototype={intersectWithLine:function(a,e){var b=c.subtract(e,a),f=this.d-this.a*a.x-this.b*a.y-this.c*a.z,d=this.a*b.x+this.b*b.y+this.c*b.z;if(d===0)throw"InvalidOperation: Plane3D.intersectWithLine";return c.add(a,c.multiply(b,f/d))},clone:function(){return new P(this.a,this.b,this.c,this.d)},toString:function(){return"[Plane3D]"}};P.fromPoints=function(b,d,g){var f=c.subtract(g,d),e=c.subtract(d,b),a=c.cross(f,e);a=a.normalize();return P.fromNormal(b,a)};P.fromNormal=function(b,a){return new P(a.x,a.y,a.z,c.dot(a,b))};P.areEqual=function(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d};o.Plane3D=P;function J(a,b){this.x=a;this.y=b}J.prototype={dot:function(a){return this.x*a.x+this.y*a.y},perp:function(){return new J(this.y,-this.x)},normalize:function(){var b,a;b=this.length();if(b<MathHelper.zeroTolerance)return new J(0,0);a=1/b;return new J(this.x*a,this.y*a)},length:function(){return MathHelper.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},add:function(a){return new J(this.x+a.x,this.y+a.y)},subtract:function(a){return new J(this.x-a.x,this.y-a.y)},multiplyScalar:function(a){return new J(this.x*a,this.y*a)},equals:function(a){return this.x===a.x&&this.y===a.y},toString:function(){return"["+this.x+", "+this.y+"]"}};o.Vector2=J;var r={earthRadiusInMeters:6378137,earthCircumferenceInMeters:6378137*2*Math.PI,northUpHeading:0,eastUpHeading:90,southUpHeading:180,westUpHeading:270,enhancedBirdseyePitch:-h.degreesPerRadian*Math.asin(180/256),earthMinorAxisRadiusInMeters:6356752.3142,flatteningOfEllipsoidWGS84:1/298.2572235631,snapToCardinalHeading:function(b){var a=Math.round(b/90);a=(a%4+4)%4;return a*90},locationRectToMercatorZoom:function(c,a){var e=Math.abs(a.getWest()-a.getEast())/360,d=Math.abs(i.latitudeToY(a.getNorth())-i.latitudeToY(a.getSouth())),f=Math.min(c.width/(b.zoomOriginWidth*e),c.height/(b.zoomOriginWidth*d));return h.log2(f)},getMercatorCenter:function(a){var b=a.center;return new l(i.yToLatitude((i.latitudeToY(a.getNorth())+i.latitudeToY(a.getSouth()))/2),b.longitude,b.altitude,b.altitudeReference)},getMercatorFootprint:function(j,g){var b=g.width/2,a=g.height/2,c=[new d(-b,-a),new d(b,-a),new d(b,a),new d(-b,a)],k=j.getViewportToWorld(),h=j.getCrs(),e,f=c.length;while(f--){e=k.transform(c[f]);c[f]=h===i?e:i.fromLocation(h.toLocation(e))}return c}};o.MapMath=r;var i={latitudeLimit:85.051128,unitsPerMeterAtEquator:1/r.earthCircumferenceInMeters,toLocation:function(a){var b=i.yToLatitude(a.y);return new l(b,(a.x-.5)*360,a.z?i.unitsToMetersAtLatitude(b,a.z):0,K.ellipsoid)},fromLocation:function(a){return new c(a.longitude/360+.5,i.latitudeToY(a.latitude),i.metersToUnitsAtLatitude(a.latitude,a.altitude))},wrap:function(b,e){var a=b.x,d=e?e.x:.5;return new c(a<d-.5||a>d+.5?a-Math.floor(a-d+.5):a,b.y,b.z)},getUpVector:function(){return new c(0,0,1)},getNadirMatrix:function(a){return new e(1,0,0,0,0,1,0,0,0,0,-1,0,-a.x,-a.y,a.z,1)},unitsToMeters:function(b,c){var a=i.yToLatitude(b.y);return i.unitsToMetersAtLatitude(a,c)},metersToUnits:function(c,b){var a=i.yToLatitude(c.y);return i.metersToUnitsAtLatitude(a,b)},changeAltitude:function(a,b){var d=i.yToLatitude(a.y),e=i.metersToUnitsAtLatitude(d,b);return new c(a.x,a.y,e)},unitsToMetersAtLatitude:function(b,a){return a===0?0:a*Math.cos(b*h.radiansPerDegree)/i.unitsPerMeterAtEquator},metersToUnitsAtLatitude:function(b,a){return a===0?0:a*i.unitsPerMeterAtEquator/Math.cos(b*h.radiansPerDegree)},yToLatitude:function(a){return 90-2*Math.atan(Math.exp((a*2-1)*Math.PI))*h.degreesPerRadian},latitudeToY:function(a){if(a>=i.latitudeLimit)return 0;if(a<=-i.latitudeLimit)return 1;var b=Math.sin(a*h.radiansPerDegree);return.5-Math.log((1+b)/(1-b))/(4*Math.PI)}};o.MercatorCube=i;var pb=new function(){var b=1/298.257222101,d=b*(2-b),f=1/(1-d),a=r.earthRadiusInMeters,g=new c(0,0,-a);this.toLocation=function(p){var q=p.x,r=p.y,g=p.z,o,s,e,n,m,i,j=Math.sqrt(q*q+r*r),f=g,c,k;s=Math.atan2(r,q);c=j*(1-b);k=1/Math.sqrt(f*f+c*c);o=Math.atan2(f,c);n=f*k;m=c*k;i=a;if(j>1)e=j/m-i;else if(g>0)e=g-a*(1-b);else e=-g-a*(1-b);var t=3;while(t--){c=j*(1-d*i/(i+e));k=1/Math.sqrt(f*f+c*c);o=Math.atan2(f,c);n=f*k;m=c*k;i=a/Math.sqrt(1-d*n*n);if(j>1)e=j/m-i;else if(g>0)e=g-a*(1-b);else e=-g-a*(1-b)}return new l(o*h.degreesPerRadian,s*h.degreesPerRadian,e,K.ellipsoid)};this.fromLocation=function(f){var j=f.latitude*h.radiansPerDegree,i=f.longitude*h.radiansPerDegree,e=f.altitude,g=Math.sin(j),k=Math.cos(j),m=Math.sin(i),l=Math.cos(i),b=a/Math.sqrt(1-d*g*g);return new c((b+e)*k*l,(b+e)*k*m,(b*(1-d)+e)*g)};this.wrap=function(){return wrap.clone()};this.getUpVector=function(a){return new c(a.x,a.y,a.z*f).normalize()};this.getNadirMatrix=function(b){var a,d=this.getUpVector(b),f=c.multiply(d,-1),i=c.cross(d,c.subtract(g,b));if(i.isZero())a=new c(1,0,0);else a=c.cross(i,d).normalize();var h=c.cross(d,a);return e.multiply(e.translation(-b.x,-b.y,-b.z),new e(h.x,a.x,f.x,0,h.y,a.y,f.y,0,h.z,a.z,f.z,0,0,0,0,1))};this.unitsToMeters=function(b,a){return a};this.metersToUnits=function(b,a){return a};this.changeAltitude=function(c,b){var a=self.toLocation(c);a.altitude=b;return self.fromLocation(a)}};function v(a,b,c){this.levelOfDetail=a;this.x=b;this.y=c}v.prototype={getParent:function(){return new v(this.levelOfDetail-1,Math.floor(this.x/2),Math.floor(this.y/2))},clone:function(){return new v(this.levelOfDetail,this.x,this.y)},toString:function(){return"[TileId "+this.levelOfDetail+" "+this.x+","+this.y+"]"}};v.areEqual=function(a,b){return a&&b&&a.levelOfDetail===b.levelOfDetail&&a.x===b.x&&a.y===b.y};o.TileId=v;function f(Q,N,O,F,G,I,K,M,J,L){var R=this,j=Q,g=N,h=O,C=F||0,l=G===n?-90:G,v=I||0,m=K||0,B=M||0,w=J||new c(0,0,0),u,o,t,k,p,s,q,x,D,A,y,z,r=L||b.zoomOriginWidth,E=false;function a(){if(!E){t=P.fromNormal(g,j.getUpVector(g));u=F===0&&l===-90&&I===0;o=u||m<=H;var a,L=1/h,d=h*1e3;k=j.getNadirMatrix(g);if(!u)k=e.multiply(k,e.rotationZ(-C),e.rotationX(-(l+90)),e.rotationZ(-v));if(o)a=e.multiply(k,e.scaling(L,L,1/d));else{var J=Math.pow(2,B)*h,n=1/m,M=1/J*n;d=Math.min(n*.99,d);var K=n-d,G=n+d;a=e.multiply(k,e.translation(w),e.translation(0,0,n),new e(M,0,0,0,0,M,0,0,0,0,G/(G-K),1,0,0,K*G/(K-G),0),e.scaling(J/h,J/h,1));var N=a.transform(g);a.multiplyBy(e.translation(c.multiply(N,-1)))}if(u)p=a;else{s=a.invert().projectOnPlane(t);p=s.invert()}q=e.multiply(p,e.scaling(r));x=q.invert();D=j.toLocation(g);A=f.widthToMercatorZoom(h,j,g);y=j.unitsToMeters(g,h)/b.zoomOriginWidth;z=!o||Math.abs(l+90)>H||j!==i;E=true}}this.getCrs=function(){return j};this.getLookAt=function(){return g};this.getWidth=function(){return h};this.getHeading=function(){return C};this.getPitch=function(){return l};this.getRoll=function(){return v};this.getDistanceInverse=function(){return m};this.getZoomDelta=function(){return B};this.getPerspectiveOrigin=function(){return w};this.getZoomOriginWidth=function(){return r};this.getGroundPlane=function(){a();this.getGroundPlane=function(){return t};return t};this.getWorldToViewport=function(){a();this.getWorldToViewport=function(){return q};return q};this.getViewportToWorld=function(){a();this.getViewportToWorld=function(){return x};return x};this.getWorldToFrustum=function(){a();this.getWorldToFrustum=function(){return p};return p};this.getFrustumToWorld=function(){a();this.getFrustumToWorld=function(){return s};return s};this.getCenter=function(){a();this.getCenter=function(){return D};return D};this.getMercatorZoom=function(){a();this.getMercatorZoom=function(){return A};return A};this.getMetersPerPixel=function(){a();this.getMetersPerPixel=function(){return y};return y};this.getNeedsElevation=function(){a();this.getNeedsElevation=function(){return z};return z};this.getAlignedCamera=function(u,y,q,t){a();var x=h/Math.pow(2,u),b,c=null,i=0,p=null;if(y){b=y;if(!o){p=e.multiply(k,e.translation(w));c=p.transform(b);i=u+B}}else b=g;var n=C;if(t)n=n+t;i=0;var s=new f(j,b,x,n,l,v,m,i,c,r);if(q){b=s.getViewportToWorld().transform(new d(-q.x,-q.y));if(!o)c=p.transform(b);s=new f(j,b,x,n,l,v,m,i,c,r)}return s}}f.prototype={convertCoordinateReferenceSystem:function(a){if(a!==this.getCrs()){var b=a.fromLocation(this.getCrs().toLocation(this.getLookAt()));return new f(a,b,a.metersToUnits(b,this.getCrs().unitsToMeters(this.getLookAt(),this.getWidth())),this.getHeading(),this.getPitch(),this.getRoll(),this.getDistanceInverse()<H?0:1/a.metersToUnits(b,this.getCrs().unitsToMeters(this.getLookAt(),1/this.getDistanceInverse())),n,n,this.getZoomOriginWidth())}else return this.clone()},clone:function(){return new f(this.getCrs(),this.getLookAt().clone(),this.getWidth(),this.getHeading(),this.getPitch(),this.getRoll(),this.getDistanceInverse(),this.getZoomDelta(),this.getPerspectiveOrigin().clone(),this.getZoomOriginWidth())},toString:function(){return"[MapCamera]"}};f.smallWidthRatioDiff=.1;f.smallAngle=1;f.smallPixelDistance=2;f.fromDirectionVector=function(m,g,q,p,r,o){var j=m.getNadirMatrix(g),a=j.transform(c.add(g,p)).normalize(),b=0;if(a.x!==0||a.y!==0){directionXY=new c(a.x,a.y,0).normalize();b=Math.acos(c.dot(directionXY,new c(0,-1,0)))*h.degreesPerRadian;if(directionXY.x<0)b=360-b}var k=(Math.PI/2-Math.acos(c.dot(a,new c(0,0,-1))))*h.degreesPerRadian,i=0,n=e.multiply(j,e.rotationZ(-b),e.rotationX(-(k+90))),d=n.transform(c.add(g,r));if(d.x!=0||d.y!=0){var l=new c(d.x,d.y,0).normalize(),i=Math.acos(c.dot(l,new c(0,-1,0)))*h.degreesPerRadian;if(l.x<0)i=360-i}return new f(m,g,q,b,k,i,o)};f.mercatorZoomToWidth=function(d,a,c){var b=1/Math.pow(2,d);return a===i?b:a.metersToUnits(c,i.unitsToMeters(i.fromLocation(a.toLocation(c)),b))};f.widthToMercatorZoom=function(c,a,b){var d=a===i?c:i.metersToUnits(i.fromLocation(a.ToLocation(b)),a.unitsToMeters(b,c));return h.log2(1/d)};f.snapSmallDifferences=function(a,d){if(a.getCrs()!==d.getCrs())a=d.convertCoordinateReferenceSystem(d.getCrs());var h=Math.max(a.getWidth(),d.getWidth())/b.zoomOriginWidth,g=h*f.smallPixelDistance,e=g*g;return new f(a.getCrs(),c.distanceSquared(d.getLookAt(),a.getLookAt())>e?a.getLookAt():d.getLookAt(),Math.abs(d.getWidth()/a.getWidth()-1)>f.smallWidthRatioDiff?a.getWidth():d.getWidth(),Math.abs(a.getHeading()-d.getHeading())>f.smallAngle?a.getHeading():d.getHeading(),Math.abs(a.getPitch()-d.getPitch())>f.smallAngle?a.getPitch():d.getPitch(),Math.abs(a.getRoll()-d.getRoll())>f.smallAngle?a.getRoll():d.getRoll(),Math.abs(a.getDistanceInverse()-d.getDistanceInverse())>H?a.getDistanceInverse():d.getDistanceInverse(),Math.abs(a.getZoomDelta()-d.getZoomDelta())>f.smallWidthRatioDiff?a.getZoomDelta():d.getZoomDelta(),c.distanceSquared(d.getPerspectiveOrigin(),a.getPerspectiveOrigin())>e?a.getPerspectiveOrigin():d.getPerspectiveOrigin(),a.getZoomOriginWidth())};f.lerp=function(a,b,d){var e=d,g=b.getWidth()/a.getWidth();if(Math.abs(g-1)>f.smallWidthRatioDiff)e=(Math.pow(g,d)-1)/(g-1);return new f(b.getCrs(),c.lerp(a.getLookAt(),b.getLookAt(),e),h.lerpDouble(a.getWidth(),b.getWidth(),e),h.lerpAngle(a.getHeading(),b.getHeading(),d),h.lerpAngle(a.getPitch(),b.getPitch(),d),h.lerpAngle(a.getRoll(),b.getRoll(),d),h.lerpDouble(a.getDistanceInverse(),b.getDistanceInverse(),d),h.lerpDouble(a.getZoomDelta(),b.getZoomDelta(),d),c.lerp(a.getPerspectiveOrigin(),b.getPerspectiveOrigin(),e),a.getZoomOriginWidth())};f.areAligned=function(a,b){return a&&b&&a.getWidth()===b.getWidth()&&a.getHeading()===b.getHeading()&&a.getPitch()===b.getPitch()&&a.getRoll()===b.getRoll()&&a.getDistanceInverse()===b.getDistanceInverse()};f.areEqual=function(a,b){return a&&b&&(a===b||c.areEqual(a.getLookAt(),b.getLookAt())&&a.getWidth()===b.getWidth()&&a.getHeading()===b.getHeading()&&a.getPitch()===b.getPitch()&&a.getRoll()===b.getRoll()&&a.getDistanceInverse()===b.getDistanceInverse()&&a.getZoomDelta()===b.getZoomDelta()&&c.areEqual(a.getPerspectiveOrigin(),b.getPerspectiveOrigin()))};o.MapCamera=f;var G={mercator:new f(i,new c(.5,.5,0),1),enhancedBirdseyeNorthUp:new f(i,new c(.5,.5,0),1,r.northUpHeading,r.enhancedBirdseyePitch),enhancedBirdseyeEastUp:new f(i,new c(.5,.5,0),1,r.eastUpHeading,r.enhancedBirdseyePitch),enhancedBirdseyeSouthUp:new f(i,new c(.5,.5,0),1,r.southUpHeading,r.enhancedBirdseyePitch),enhancedBirdseyeWestUp:new f(i,new c(.5,.5,0),1,r.westUpHeading,r.enhancedBirdseyePitch)};o.StandardMapCameras=G;function db(g){var d=this,f=g,e=3,b=L+"count",a=[{}];a[0][b]=0;var c;this.get=function(e,g){var b,f=a.length,c=true;while(f--){b=a[f][e];if(b!==n){g&&!c&&d.insert(e,b);return b}c=false}};this.insert=function(k,l){var g=a[a.length-1];if(g[k]===n)if(g[b]<f)g[b]++;else{g={};g[b]=0;a.push(g);if(a.length>e){var i=a.shift();if(c)for(var h in i)if(h!==b&&i.hasOwnProperty(h)){var j=i[h];j!==d.get(h)&&c(j)}}}g[k]=l};this.useDisposer=function(a){c=a}}var q={tileIdToCacheKey:function(a){return a.levelOfDetail+"~"+a.x+"~"+a.y},latLonToMercatorXY:function(c,b){var a=b/360+.5;a-=Math.floor(a);return new d(a,i.latitudeToY(c))},mercatorXYToTileId:function(b,a){var c=1<<a;return new v(a,Math.floor(b.x*c),Math.floor(b.y*c))},mercatorXYToCacheKey:function(b,a){return q.tileIdToCacheKey(q.mercatorXYToTileId(b,a))},latLonToTileId:function(d,c,a){var b=q.latLonToMercatorXY(d,c);return q.mercatorXYToTileId(b,a)},latLonToCacheKey:function(c,b,a){return q.tileIdToCacheKey(q.latLonToTileId(c,b,a))},tileIdToMercatorXY:function(a){var b=1<<a.levelOfDetail;return new d((a.x+.5)/b,(a.y+.5)/b)},tileIdToLocation:function(b){var a=q.tileIdToMercatorXY(b);return i.toLocation(a)},normalizeMercatorBounds:function(a){if(a.width<1)a.x-=Math.floor(a.x);else{a.x=0;a.width=1}var b=Math.min(a.getBottom(),1);a.y=Math.max(a.y,0);a.height=b-a.y}};o.SpatialCache=q;var B=new function(){var g=this,s,D=64,k=h.log2(b.zoomOriginWidth/D),m=10+k,y=20+k,C=3,e=new db(1e4),f=[],o=0,p=0,i=4,z=3,B=new c(0,0,1),w=L+"ellipsoid",u;this.authenticate=function(a){if(!u){u=true;a(function(a){if(a){s=b.elevationServiceUrl.replace("{credentials}",a);j()}})}};this.getAltitudeAtLatLon=function(b,a){return g.getAltitudeAtMercatorXY(q.latLonToMercatorXY(b,a))};this.getAltitudeAtMercatorXY=function(p){var f=q.mercatorXYToTileId(p,y),c;while(f.levelOfDetail>=1){c=e.get(q.tileIdToCacheKey(f));if(c!==n){var g=f.levelOfDetail,t=1<<g,d=p.x*t-.5,l=p.y*t-.5,k=Math.floor(d),j=Math.ceil(d),s=Math.floor(l),r=Math.ceil(l),o=e.get(q.tileIdToCacheKey(new v(g,k,s))),i=e.get(q.tileIdToCacheKey(new v(g,j,s))),m=e.get(q.tileIdToCacheKey(new v(g,k,r))),h=e.get(q.tileIdToCacheKey(new v(g,j,r))),b;if(o!==n)if(i!==n)b=o*(j-d)+i*(d-k);else b=o;else if(i!==n)b=i;var a;if(m!==n)if(h!==n)a=m*(j-d)+h*(d-k);else a=m;else if(h!==n)a=h;if(b!==n)if(a!==n)c=b*(r-l)+a*(l-s);else c=b;else if(a!==n)c=a;return c}f=f.getParent()}return 0};this.rayToGround=function(h,a,d){if(Math.abs(a.x-d.x)<=H&&Math.abs(a.y-d.y)<=H)return h.changeAltitude(a,g.getAltitudeAtMercatorXY(a));var f,c,e,b=a,i=z;while(i--){c=g.getAltitudeAtMercatorXY(b);if(Math.abs(f-c)<1)break;f=c;e=P.fromNormal(h.changeAltitude(b,c),B);b=e.intersectWithLine(a,d)}return b};this.toEllipsoid=function(a,e){if(a.altitudeReference===K.ellipsoid)return a;if(e)return new l(a.latitude,a.longitude,0,K.ellipsoid);var b=a[w];if(b&&b.latitude===a.latitude&&b.longitude===a.longitude&&b.forAltitude===a.altitude&&b.forAltitudeReference===a.altitudeReference&&b.forGeneration===p)return b;else{var d=g.getAltitudeAtLatLon(a.latitude,a.longitude),c;if(a.altitudeReference===K.ground)c=a.altitude+d;else c=d;b=new l(a.latitude,a.longitude,c,K.ellipsoid);b.forAltitude=a.altitude;b.forAltitudeReference=a.altitudeReference;b.forGeneration=p;a[w]=b}return b};this.isElevationAvailableAtLatLon=function(f,d,c){var b=x(c);if(b<m)return true;var a=q.latLonToTileId(f,d,b),g=C;while(g--){if(e.get(q.tileIdToCacheKey(a))!==n)return true;a=a.getParent()}return false};this.adjustCameraElevation=function(a){var d=a.getLookAt(),b=g.rayToGround(a.getCrs(),d,a.getViewportToWorld().transform(new c(0,0,1)));return!c.areAlmostEqual(d,b)?a.getAlignedCamera(0,b):a};this.downloadElevationData=function(e,g){var b=x(e.getMercatorZoom());if(b>=m){var a=E.union(r.getMercatorFootprint(e,g));q.normalizeMercatorBounds(a);var i=q.mercatorXYToTileId(a,b),h=q.mercatorXYToTileId(new d(a.getRight(),a.getBottom()),b),c={};f.push({topLeft:i,bottomRight:h,requestHandle:c});t.dispatch(j);return c}};this.cancelDownload=function(b){if(b){var a=f.length;while(a--)f[a].requestHandle===b&&f.splice(a,1)}};function j(){if(f.length&&o<1&&s){for(var g=f.shift(),b=g.topLeft,c=g.bottomRight,h=true,u=b.x,t=c.x,w=b.y,r=c.y,d=new v(b.levelOfDetail,0,0),k=w;k<=r;k++){for(var j=u;j<=t;j++){d.x=j;d.y=k;d=X.wrapX(d);if(e.get(q.tileIdToCacheKey(d))===n){h=false;break}}if(!h)break}if(h)a.invoke(g.requestHandle,"downloaded",{cacheHit:true});else{var p=1<<b.levelOfDetail;b.x-=i;b.y=Math.max(0,b.y-i);c.x+=i;c.y=Math.min(p-1,c.y+i);var l=q.tileIdToLocation(b),m=q.tileIdToLocation(c),x=s.replace("{north}",l.latitude.toFixed(6)).replace("{west}",l.longitude.toFixed(6)).replace("{south}",m.latitude.toFixed(6)).replace("{east}",m.longitude.toFixed(6)).replace("{cols}",c.x-b.x+1).replace("{rows}",c.y-b.y+1);o++;W.getObjectAsync(x,A,{topLeft:b,bottomRight:c,requestHandle:g.requestHandle})}}}function A(w,d){if(d.success){var f=d.userData.topLeft,k=d.userData.bottomRight,s=f.x,r=k.x,t=f.y,n=k.y,g=w.alt;if(g&&g.length===(n-t+1)*(r-s+1)){for(var c=new v(f.levelOfDetail,0,0),b,x,u=0,l=0,i=t;i<=n;i++)for(var h=s;h<=r;h++){l+=g[u++];c.x=h;c.y=i;c=X.wrapX(c);b=c;while(b.levelOfDetail>=m){e.insert(q.tileIdToCacheKey(b),l);b=b.getParent()}}p++;a.invoke(d.userData.requestHandle,"downloaded",{cacheHit:false})}}o--;j()}function x(a){return Math.floor(Math.min(a+k,y))}};o.ElevationService=B;function y(b,a,d,e,c){this.nativeCamera=b;this.maxLocalZoom=d;this.minLocalZoom=0;this.tilePyramid=a;this.imageryId=e;this.copyrightProvider=c;this.needsElevation=b.getNeedsElevation()||a&&a.projectingCamera&&a.projectingCamera.getNeedsElevation()}y.nativeMercatorCamera=G.mercator.getAlignedCamera(b.minMercatorZoom);y.createMercatorScene=function(c,f,d,e){var a=null;if(c){a=M.createQuadKeyTilePyramid(b.defaultTileSize,b.defaultTileSize,c,x.horizontal,e);a.projectingCamera=G.mercator}return new y(y.nativeMercatorCamera,a,b.maxMercatorZoom-b.minMercatorZoom,f,d)};o.CompositeModeScene=y;function Lb(){var q=this,ib=false,Hb="cm"+jb.getNext(),s=null,I=null,eb=null,U=null,C=null,wb=y.createMercatorScene(null,"Mercator",null),p=wb,o=p.nativeCamera,e=o,D,K,P,Ib=k(null,g.safariRenderHack),G=[],N=[],db=u.visible,F,R=0,j=new z(800,600),tb,v=new Bb;a.addHandler(v,"tiledownloadcomplete",function(){a.invoke(q,"tiledownloadcomplete")});var ub,S=new lb,M=k("div","position:absolute;"+g.safariRenderHack),ab=false,sb,Y=false,bb,x,V=true,J,O,X,Q,yb={Grab:"url("+b.cursorPath+"grab.cur)"+g.cursorHotspot+", move",Grabbing:"url("+b.cursorPath+"grabbing.cur)"+g.cursorHotspot+", move",SEResize:"se-resize"},Fb=1e3/30,Z=.3,Cb=.1,Ab=.4;this.activating=function(b){s=b;bb=a.addHandler(b,"resize",pb);pb()};this.activated=function(){I=s.getModeLayer();eb=s.getRootElement();U=m(eb);I.appendChild(v.getRootElement());I.appendChild(M);ub=k("div","position:absolute;z-index:0;left:0;top:0;"+g.safariRenderHack,I);S.activate(s,q,v,ub,Hb+"_er");C=new zb(q,s,U,S,true);vb();a.removeHandler(Q);Q=a.addHandler(s,"optionschanged",vb);W(p.needsElevation);U.set_style({cursor:yb.Grab});ib=true;A()};this.deactivating=function(){a.removeHandler(Q);Q=null;W(false);a.removeHandler(bb);bb=null;C.enableOrDisableUserInput(false,x);gb(e,false);S.deactivate();I.removeChild(v.getRootElement());v.disposeTiles();C=null;U=null;eb=null;I=null;s=null;ib=false};this.getInternalMaxZoom=function(){return b.maxMercatorZoom};this.getInternalMinZoom=function(){return b.minMercatorZoom};this.setView=function(a){var o=e.getCrs(),m,b,s=null,c=a.bounds,t=false;if(c instanceof w){if(a.center){b=a.center;var g=c.getNorthwest(),y=new l(b.latitude*2-g.latitude,b.longitude*2-g.longitude,g.altitude,g.altitudeReference),k=c.getSoutheast(),A=new l(b.latitude*2-k.latitude,b.longitude*2-k.longitude,k.altitude,k.altitudeReference),C=c.getSoutheast().clone();c=w.fromLocations(g,k,y,A)}else b=o===i?r.getMercatorCenter(c):c.center.clone();var x=T(a.padding)?new z(Math.max(1,j.width-a.padding),Math.max(1,j.height-a.padding)):j;m=r.locationRectToMercatorZoom(x,c);t=true}else{if(a.center){b=a.center;s=a.centerOffset}if(T(a.zoom))m=a.zoom}var d=false,q=e.getLookAt(),v=e.getWidth(),p=e.getHeading(),u=true;if(b){q=o.fromLocation(B.toEllipsoid(b));d=true}if(T(m)){v=f.mercatorZoomToWidth(m,o,q);d=true}if(T(a.heading)){p=h.normalizeDegrees(a.heading);K=p;d=true}else K=null;if(a.animate===false){u=a.animate;d=true}if(a.suspend!==n)if(a.suspend)ob(true);else qb();d&&cb(o,q,s,v,p,u,t)};this.setWrapping=function(a){V=a};this.getCenter=function(){var a=o.getCenter();return new l(a.latitude,a.longitude)};this.getZoom=function(){return o.getMercatorZoom()};this.getHeading=function(){return o.getHeading()};this.getBounds=function(){return xb(o)};this.getMetersPerPixel=function(){return o.getMetersPerPixel()};this.getTargetCenter=function(){var a=e.getCenter();return new l(a.latitude,a.longitude)};this.getTargetZoom=function(){return e.getMercatorZoom()};this.getTargetHeading=function(){return e.getHeading()};this.getTargetBounds=function(){return xb(e)};this.getTargetMetersPerPixel=function(){return e.getMetersPerPixel()};this.tryLocationToViewport=function(a){return this.internalTryLocationToViewport(o,a)};this.tryViewportToLocation=function(a){return this.internalTryViewportToLocation(o,a,true)};this.internalTryLocationToViewport=function(b,c){var d=b.getCrs(),h=b.getWorldToViewport(),i=b.getDistanceInverse()<H,g=!b.getNeedsElevation(),a,k,f=b.getLookAt();if(fb(c)){var e=c.length,j=new Array(e);while(e--){a=d.fromLocation(B.toEllipsoid(c[e],g));if(V)a=d.wrap(a,f);f=a;viewportPoint=h.transform(a);j[e]=i||viewportPoint.z>=-1&&viewportPoint.z<=1?viewportPoint.toPoint():null}return j}else{a=d.fromLocation(B.toEllipsoid(c,g));if(V)a=d.wrap(a,f);viewportPoint=h.transform(a);return i||viewportPoint.z>=-1&&viewportPoint.z<=1?viewportPoint.toPoint():null}};this.internalTryViewportToLocation=function(g,d,i){var h=g.getCrs(),f=g.getViewportToWorld(),b,a;if(fb(d)){var e=d.length,j=new Array(e);while(e--){b=f.transform(d[e]);if(i)b=B.rayToGround(g.getCrs(),b,f.transform(new c(d[e].x,d[e].y,1)));a=h.toLocation(b);a=new l(a.latitude,l.normalizeLongitude(a.longitude));j[e]=h.toLocation(b)}return j}else{b=f.transform(d);if(i)b=B.rayToGround(g.getCrs(),b,f.transform(new c(d.x,d.y,1)));a=h.toLocation(b);a=new l(a.latitude,l.normalizeLongitude(a.longitude));return a}};this.isDownloadingTiles=function(){return v.isDownloadingTiles()};this.getImageryId=function(){return p.imageryId?p.imageryId:""};this.isRotationEnabled=function(){return p.imageryId==="EnhancedBirdseye"||p.imageryId==="NativeBirdseye"};this.isMercator=function(){return Gb(p)};this.getCopyrights=function(a){if(a&&p.copyrightProvider)p.copyrightProvider.getCopyrights(q.getBounds(),o.getMercatorZoom(),a);else a&&a([]);return[]};function rb(){a.invoke(q,"copyrightchanged")}this.setSceneContributors=function(c){var b=N.length;while(b--)a.removeHandler(N[b]);N.length=0;b=c.length;G.length=b;while(b--){G[b]=c[b];N.push(a.addHandler(G[b],"newsceneavailable",L))}G.sort(function(b,a){return b.priority-a.priority});A();L()};function gb(c,a){if(a&&f.areEqual(e,c))return;c=B.adjustCameraElevation(c);e=c;D=c;var i=false;if(Z<1/b.maxFPS)a=false;if(a){D=f.snapSmallDifferences(B.adjustCameraElevation(o),e);if(f.areEqual(D,e))a=false;if(a){var d=new z(j.width*1.2,j.height*1.2),h=E.union(r.getMercatorFootprint(D,d)),g=E.union(r.getMercatorFootprint(e,d));if(!E.intersect(h,g))a=false}}if(a){F=new Date(new Date-Fb);A();if(a!=true)R=a}else{F=new Date(0);kb()}}function cb(t,k,w,s,C,r,z){var d,j,o=f.widthToMercatorZoom(s,t,k),i,n,l=k,y=2,b,m=false;while(y--){j=t.toLocation(l);n=B.isElevationAvailableAtLatLon(j.latitude,j.longitude,o);b=null;var u=G.length;while(u--){b=G[u].getScene(p,j.latitude,j.longitude,o,C,db);if(b&&b.needsElevation){m=true;if(!n)b=null}if(b)break}b=b||wb;b=P?p:b;if(i&&d===b)break;d=b;var g=h.log2(d.nativeCamera.getWidth()/s);g=z?Math.floor(g):Math.round(g);g=Math.min(g,d.maxLocalZoom);g=Math.max(g,d.minLocalZoom);i=d.nativeCamera.getAlignedCamera(g,k,w);if(c.areAlmostEqual(l,i.getLookAt()))break;l=i.getLookAt()}W(m);if(r&&f.areEqual(e,i)&&d===p)return;var v=d.imageryId!==p.imageryId,x=d!==p;p=d;gb(i,r);A();if(x){a.invoke(q,"scenechanged");rb()}v&&a.invoke(q,"imagerychanged")}function L(){var a=B.adjustCameraElevation(e);cb(a.getCrs(),a.getLookAt(),null,a.getWidth(),K!=null?K:a.getHeading(),true)}var hb=false;function kb(){t.cancelDispatch(kb);if(!ib||hb)return;hb=true;var l=false,k=true,h=true,g,i;C.processPendingUserInput();if(!z.areEqual(tb,j)){g=true;i=true}tb=j;if(Y){g=true;i=true;h=false;Y=false}if(F){var w=o,s=new Date,b=(s-F)/1e3/Z;if(e.getMercatorZoom()>D.getMercatorZoom()){if(b<Ab)k=false}else if(b<Cb)k=false;var m;if(R>0){b=(s-F)/R;if(b>=1){b=1;R=0}m=1-Math.pow(1-b,4)}else m=b<=.5?Math.pow(b*2,2)*.5:Math.pow((1-b)*2,2)*-.5+1;if(b<=1){o=f.lerp(D,e,m);l=true}else{var d=e.getLookAt();if(V)d=e.getCrs().wrap(d);if(d.y<0)d.y=0;else if(d.y>1)d.y=1;if(!c.areAlmostEqual(e.getLookAt(),d)){h=false;e=e.getAlignedCamera(0,d)}o=e;D=e;F=null}if(!f.areAligned(w,o))h=false;g=true}v.allowTileGridSwitch=k;var n=!ab&&g,r=ab&&!g;ab=g;if(g)l=true;if(!f.areEqual(sb,e))i=true;sb=e;v.render(j,o,p.tilePyramid,e);var u=n?0:r?2:1;S.update(j,o,h,u);i&&a.invoke(q,"targetviewchanged");n&&a.invoke(q,"viewchangestart");g&&a.invoke(q,"viewchange",{linear:h});if(r){a.invoke(q,"viewchangeend");rb()}hb=false;l&&A()}function pb(){if(s){var b=s.getWidth(),a=s.getHeight();if(j.width!==b||j.height!==a){j=new z(s.getWidth(),s.getHeight());Eb();A()}}}function Eb(){if(j){M.style.left=-(j.width/2)+"px";M.style.top=-(j.height/2)+"px";M.style.width=j.width+"px";M.style.height=j.height+"px"}}function A(){t.dispatch(kb)}function ob(a){a&&v.suspendGettingNewTiles();P=true}function qb(){v.allowGettingNewTiles();if(P){P=false;L();A()}}function xb(e){var c=e.getViewportToWorld(),b=e.getCrs(),a=w.fromLocations(b.toLocation(c.transform(new d(-j.width/2,-j.height/2))),b.toLocation(c.transform(new d(j.width/2,-j.height/2))),b.toLocation(c.transform(new d(j.width/2,j.height/2))),b.toLocation(c.transform(new d(-j.width/2,j.height/2))));a.center=new l(a.center.latitude,a.center.longitude);return a}function Gb(a){return f.areEqual(a.nativeCamera,y.nativeMercatorCamera)}function vb(){x=s.getOptions();C.enableOrDisableUserInput(true,x);var b=.9;if(x.inertiaIntensity!==n&&x.inertiaIntensity!==-1)b=x.inertiaIntensity;C.enableOrDisableInertialScrolling(x.useInertia,b);C.setTouchZoomThreshold(.1);var a=x.labelOverlay;if(a!==db&&u.isValid(a)){db=a;L()}x.showBackground!==n&&v.showBackground(x.showBackground);v.setBufferSize(x.tileBuffer)}function W(b){if(b){if(!J){J=a.addThrottledHandler(q,"targetviewchanged",nb,500);t.dispatch(nb)}}else{mb();a.removeHandler(J);J=null}}function nb(){if(J){mb();O=B.downloadElevationData(e,j);if(O)X=a.addHandler(O,"downloaded",Db)}}function mb(){a.removeHandler(X);X=null;B.cancelDownload(O)}function Db(a){Y=!a.cacheHit;L();A()}this.ensureUpdateDispatched=function(){A()};this.getTargetCamera=function(){return e};this.getCurrentCamera=function(){return o};this.getCameraAnimationDuration=function(){return Z};this.setAlignedCamera=function(g,b,a,f,e,d,c){K=null;cb(g,b,a,f,e,d,c)};this.setCamera=function(b,a){gb(b,a)};this.allowSceneChanges=function(){qb()};this.suspendSceneChanges=function(a){ob(a)};this.getCursors=function(){return yb};this.getPublicApi=function(){return{tryPixelToMercatorPoint:function(a){return q.getTargetCamera().getViewportToWorld().transform(a)}}}}var N=new function(){var a=this;this.Properties={};this.Attributes={};this.Events={};var c=[{transform:["msTransform","-ms-transform"],transformOrigin:["msTransformOrigin","-ms-transform-origin"]},{transform:["webkitTransform","-webkit-transform"],transformOrigin:["webkitTransformOrigin","-webkit-transform-origin"],transition:["webkitTransition","-webkit-transition"],transitionDelay:["webkitTransitionDelay","-webkit-transition-delay"],transitionProperty:["webkitTransitionProperty","-webkit-transition-property"],transitionDuration:["webkitTransitionDuration","-webkit-transition-duration"]},{transform:["MozTransform","-moz-transform"],transformOrigin:["MozTransformOrigin","-moz-transform-origin"]},{transform:["OTransform","-o-transform"],transformOrigin:["OTransformOrigin","-o-transform-origin"]}],b=[{webkitTransition:{transitionEnd:"webkitTransitionEnd"}},{MozTransition:{transitionEnd:"MozTransitionEnd"}}];function d(){for(var m=k(),i=false,d=0;d<c.length&&!i;d++){var h=c[d];for(var e in h){var l=h[e][0],n=h[e][1];if(l in m.style){a.Properties[e]=l;a.Attributes[e]=n;i=true}}}for(var d=0;d<b.length;d++){var g=b[d];for(var f in g)if(f in m.style)for(var j in g[f])a.Events[j]=g[f][j]}}d()},Q=new function(){var m=this,p={msTransform:{p:"",f:f},webkitTransform:{p:"",f:g.useTransform3d?r:f},MozTransform:{p:"px",f:f},OTransform:{p:"",f:f}},l,c=6,a=Math.pow(10,c),i=[new d(0,0),new d(128,128),new d(-128,128)],j=[],o=false,n=false,q=false;function u(){var a=null,c=k(),b=N.Properties.transform;if(b&&b in p){var d=p[b];try{c.style[b]="matrix(1,0,0,1,0,0)";l=d.p;a=d.f}catch(e){}}if("opacity"in c.style)o=true;if(a==null&&"filter"in c.style){a=s;m.requireFlowLayout=true;n=true;m.usingIEFilters=true;if("zoom"in c.style&&g.isZoomFasterThanMatrixFilter)q=true}if(a==null)a=t;m.setTransformAndOpacity=a}this.setExactTransformOrHide=function(k,l,f,d){d=d||{};var a=d.excludeCommonCss?{}:b(l),c=h(k).invert();if(Math.abs(c.m11-1)<H&&Math.abs(c.m12-0)<H&&Math.abs(c.m21-0)<H&&Math.abs(c.m22-1)<H&&f>=.01){var i=-Math.round(c.offsetX)+"px",j=-Math.round(c.offsetY)+"px";a.display="block";if(g.useTransform3dForTranslate)a[d.returnStyleObject?N.Properties.transform:N.Attributes.transform]="translate3d("+i+","+j+",0px)";else{a.left=i;a.top=j}if(f<=.99)if(o)a.opacity=f.toFixed(2);else if(n)a.filter="alpha(opacity = "+(f*100).toFixed(0)+")"}else a.display="none";return d.returnStyleObject?a:e(a)};function h(a){if(a.m41===0&&a.m42===0&&a.m43===0)return new C(a.m11/a.m44,a.m12/a.m44,a.m21/a.m44,a.m22/a.m44,a.offsetX/a.m44,a.offsetY/a.m44);else{var c=a.invert(),b=3;while(b--)j[b]=c.transform(i[b]);return C.conversion(j[0],j[1],j[2],i[0],i[1],i[2])}}function b(b){var a={};a.position="absolute";a["white-space"]="nowrap";a["line-height"]="0";if(b){a.width=b.width.toFixed(0)+"px";a.height=b.height.toFixed(0)+"px"}return a}function e(b){var a="";for(styleKey in b)a+=styleKey+":"+b[styleKey]+";";return a}function s(A,r,p,m){m=m||{};var d=h(A),o=Math.round(d.m11*a)/a,x=Math.round(d.m22*a)/a,v=Math.round(d.m12*a)/a,w=Math.round(d.m21*a)/a,f=m.excludeCommonCss?{}:b(r),i=null,k,l;if(o==1&&v==0&&w==0&&x==1){k=d.offsetX.toFixed(0);l=d.offsetY.toFixed(0)}else if(q&&o==x&&v==0&&w==0){var n=Math.abs(o-1)>.02?Math.round(o*1e4)/1e4:1,s=d.invert(),y=s.offsetX,z=s.offsetY,k,l;if(g.cssZoomAffectsTopLeft){k=-y;l=-z}else{k=-y*n;l=-z*n}if(n!=1)f.zoom=n}else{var t=Math.round(r.width/2),u=Math.round(r.height/2);k=-t;l=-u;var j=C.multiply(d,new C(1,0,0,1,t,u));i="progid:DXImageTransform.Microsoft.Matrix(FilterType=nearest,  M11="+j.m11.toFixed(c)+", M21="+j.m12.toFixed(c)+", M12="+j.m21.toFixed(c)+", M22="+j.m22.toFixed(c)+", dX="+j.offsetX.toFixed(0)+", dY="+j.offsetY.toFixed(0)+")"}f.left=k+"px";f.top=l+"px";if(p<.01)f.display="none";else{f.display="block";if(p<.99)i=(i==null?"":i+", ")+"alpha(opacity = "+(p*100).toFixed(0)+")"}if(i)f.filter=i;return m.returnStyleObject?f:e(f)}function f(t,d,q,p){p=p||{};var o=h(t),f=Math.round(o.m11*a)/a,j=Math.round(o.m22*a)/a,s=Math.round(o.m12*a)/a,r=Math.round(o.m21*a)/a,m=Math.round(o.offsetX*a)/a,n=Math.round(o.offsetY*a)/a,i=p.excludeCommonCss?{}:b(d);if(f===1&&s===0&&r===0&&j===1){i.left=m+"px";i.top=n+"px"}else{if(d&&g.isIE9&&f&&j&&r===0&&Math.abs(f-j)<.01){var c=f-1,k=j-1;if(c<=.0102&&c>=-.009998)if(c<=.0079&&c>=-.0075){m+=d.width*c*.5;n+=d.height*k*.5;f+=c*.2;j+=k*.2}else if(c<=.009175&&c>=-.009086){f+=c*.17;j+=k*.17;if(c>0&&f<1.0100995||c<0&&f>.99){m+=d.width*c*.5;n+=d.height*k*.5}else{m+=d.width*c*-.09;n+=d.height*k*-.09}}else{m+=d.width*c*-.05;n+=d.height*k*-.05;f+=c*.1;j+=k*.1}}i[p.returnStyleObject?N.Properties.transformOrigin:N.Attributes.transformOrigin]="0 0";i[p.returnStyleObject?N.Properties.transform:N.Attributes.transform]="matrix("+f+","+s+","+r+","+j+","+m+l+","+n+l+")"}if(q>=.01){if(q<=.99)i.opacity=q.toFixed(2);i.display="block"}else i.display="none";return p.returnStyleObject?i:e(i)}function r(c,k,h,f){f=f||{};var g=f.excludeCommonCss?{}:b(k),d=c.m44,l=Math.round(c.m11*a/d)/a,m=Math.round(c.m12*a/d)/a,n=Math.round(c.m14*a/d)/a,o=Math.round(c.m21*a/d)/a,p=Math.round(c.m22*a/d)/a,q=Math.round(c.m24*a/d)/a,r=Math.round(c.m31*a/d)/a,s=Math.round(c.m32*a/d)/a,t=Math.round(c.m34*a/d)/a,i=Math.round(c.offsetX/d),j=Math.round(c.offsetY/d);g[f.returnStyleObject?N.Properties.transformOrigin:N.Attributes.transformOrigin]="0 0";g[f.returnStyleObject?N.Properties.transform:N.Attributes.transform]="matrix3d("+l+","+m+",0,"+n+","+o+","+p+",0,"+q+","+r+","+s+",1,"+t+","+i+","+j+",0,1)";if(h>=.01||f.explicitOpacity){if(h<=.99||f.explicitOpacity)g.opacity=h.toFixed(2);g.display="block"}else g.display="none";return f.returnStyleObject?g:e(g)}function t(f,i,g,c){c=c||{};var d=h(f).invert(),a=c.excludeCommonCss?{}:b(i);a.left=(-d.offsetX).toFixed(0)+"px";a.top=(-d.offsetY).toFixed(0)+"px";a.display=g>.1?"block":"none";return c.returnStyleObject?a:e(a)}u()},nb=new function(){var r=this,v=5e3,c=[],h=0,e={},j=new db(50),l=new db(30),m=new db(200);g.useImageDisposer&&j.useDisposer(function(a){if(a&&a.src)a.src=b.spacerImageUrl});var d=L+"downloadRequest",p=L+"timeoutid",f=L+"processed";this.getState=function(a){if(j.get(a))return A.ready;if(m.get(a))return A.cacheExpired;var b=l.get(a);return b!==n?b:e[a]?A.downloading:A.none};this.setDownloadBasket=function(a,b){r.removeDownloadBasket(a.basketId);if(a.length>0){if(b)c.push(a);else c.unshift(a);t.dispatch(q,-10)}};this.removeDownloadBasket=function(b){for(var a=0;a<c.length;)if(c[a].basketId===b)c.splice(a,1);else a++};function q(){for(var m=0;m<c.length;m++){for(var g=c[m],j=0;j<g.length;j++){var l=g[j],i=l.url,n=r.getState(i);switch(n){case A.none:case A.timedout:case A.cacheExpired:if(h<b.maxConcurrentTileDownloads){l.basket=g[j];if(!e[i]){h++;var f=k("img");e[i]=f;f[d]=l;f.onload=s;f.onerror=o;f.onabort=o;f[p]=window.setTimeout(function(){var a=f;return function(){u.call(a)}}(),v);f.src=i}}break;case A.downloading:break;default:g.hasNewTiles=true}}if(g.hasNewTiles){a.invoke(g,"hasnewtiles");g.hasNewTiles=false}}}function s(){if(!this[f]){var a=this[d].url;i(this,a);m.insert(a,true);j.insert(a,this)}}function o(){if(!this[f]){var a=this[d].url;i(this,a);if(g.useImageDisposer)this.src=b.spacerImageUrl;l.insert(a,A.failed)}}function u(){if(!this[f]){var a=this[d].url;i(this,a);if(g.useImageDisposer)this.src=b.spacerImageUrl;l.insert(a,A.timedout)}}function i(a,i){a[f]=true;a.onload=null;a.onerror=null;a.onabort=null;window.clearTimeout(a[p]);var g=a[d],b=g.basket;b.hasNewTiles=true;var c=b.length;while(c--)b[c]===g&&b.splice(c,1);h--;delete e[i];t.dispatch(q,-10)}},A={none:0,downloading:1,ready:2,failed:3,timedout:4,cacheExpired:5};function Jb(a){this.url=a}function M(b,a,i,g,e,f,j,k,d){var c=h.ceilLog2(Math.max(b,a));this.getWidth=function(){return b};this.getHeight=function(){return a};this.getTileWidth=function(){return i};this.getTileHeight=function(){return g};this.getTileOverlap=function(){return e};this.getTileBorder=function(){return f};this.getOffsetX=function(){return j};this.getOffsetY=function(){return k};this.getMaxLevelOfDetail=function(){return c};this.getUrl=d}M.createQuadKeyTilePyramid=function(a,c,e,g,f){var d=Math.pow(2,b.maxMercatorZoom);return new M(a*d,c*d,a,c,0,0,0,0,M.createMercatorQuadKeyUrlRetriever(e,a,g,f))};M.createMercatorQuadKeyUrlRetriever=function(a,e,d,c){return M.createQuadKeyUrlRetriever(a,c,e,d,b.minMercatorZoom,b.maxMercatorZoom)};M.createQuadKeyUrlRetriever=function(b,f,i,g,l,k,e){var j=h.ceilLog2(i),d,a,c;if(typeof b==="string"){d=b;if(f)a=f;else a=d}else c=b;return function(i,n){var m=i.levelOfDetail-j;if(m>=l&&m<=k){var b=new v(m,i.x,i.y);if(g&x.horizontal)b=X.wrapX(b);if(g&x.vertical)b=X.wrapY(b);if(X.isInBounds(b))if(c)return c(b);else{var f,h;if(b.levelOfDetail===0)if(e){f=X.fromTileId(b,true);h=e}else return null;else{f=X.fromTileId(b,false);h=f.charAt(f.length-1)}return n?a.replace("{quadkey}",f).replace("{subdomain}",h):d.replace("{quadkey}",f).replace("{subdomain}",h)}}return null}};var x={none:0,horizontal:1,vertical:2};o.TilePyramid=M;o.TilePyramidWrapMethod=x;function O(gb,F,ib){var n=this,h=k(),c,j,o,u,B,y,X=0,Y,P,T="",w=0,D=0,M=true,hb=false,i=gb,m,l,q,r,V,U,x,O,N,Z,bb,cb,K,W,C=[],S=[],p=[],s=[],H,db=3,R;this.levelOfDetail=F;this.opacity=1;this.isOverlay=false;this.hideWhileAnimating=false;this.allowTileRender=true;m=i.getTileWidth();l=i.getTileHeight();q=i.getTileOverlap();r=i.getTileBorder();V=m+2*q;U=l+2*q;var G=Math.pow(2,i.getMaxLevelOfDetail()-F);x=Math.ceil(i.getWidth()/G);O=Math.ceil(i.getHeight()/G);x=Math.ceil(x);bb=Math.ceil(x/m)-1;cb=Math.ceil(O/l)-1;N=e.multiply(i.projectingCamera.getWorldToFrustum(),e.scaling(x),e.translation(x/2+i.getOffsetX()/G,O/2+i.getOffsetY()/G,0));Z=N.invert();if(ib)R=true;this.populate=function(r,n,a){var f=e.multiply(r.getViewportToWorld(),N),h=Math.ceil(n.width/2),g=Math.ceil(n.height/2),i=E.union(f.transform(new d(-h,-g)),f.transform(new d(h,-g)),f.transform(new d(h,g)),f.transform(new d(-h,g))),k=new v(F,Math.floor(i.x/m),Math.floor(i.y/l)),b=new v(F,Math.floor(i.getRight()/m),Math.floor(i.getBottom()/l));if(!o||!u||a>X||o.x>k.x||o.y>k.y||u.x<b.x||u.y<b.y){K=null;X=a;o=k;u=b;B=c;y=j;c=o.clone();c.x-=a;c.y-=a;j=b.clone();j.x+=a;j.y+=a;Y=e.multiply(e.translation(c.x*m,c.y*l,0),Z);var p=j.x-c.x+1,q=j.y-c.y+1;P=new z(p*m,q*l);ab()}};this.render=function(b,c){if(!f.areEqual(b,K)||W!==n.opacity){var a=e.multiply(Y.projectOnPlane(b.getGroundPlane()),b.getWorldToViewport());if(c){a.offsetX+=c;a.offsetY+=c}T=this.hideWhileAnimating?Q.setExactTransformOrHide(a,P,n.opacity):Q.setTransformAndOpacity(a,P,n.opacity,{explicitOpacity:true});h.style.cssText=T;J()}W=n.opacity;K=b};this.getRootElement=function(){return h};this.getTilePyramid=function(){return i};this.getDownloadProgress=function(){return w>0&&p?1-p.length/w:1};this.getNoImageTileRatio=function(){return w>0?D/w:0};this.stopDownloading=function(){M=false;nb.removeDownloadBasket(n)};this.dispose=function(){hb=true;n.stopDownloading();h&&h.parentNode&&h.parentNode.removeChild(h)};function ab(){var Y,kb,db=Math.round((c.x+j.x)/2),eb=Math.round((c.y+j.y)/2);if(H){a.removeHandler(H);H=null}var t=[],K=k();w=0;D=0;p=[];s=[];for(var X,d,G,E,N,P,F=0,O=0,W,f=c.y;f<=j.y;f++){F=0;W=false;for(var ib=B&&B.y<=f&&y&&y.y>=f,e=c.x;e<=j.x;e++){X=new v(c.levelOfDetail,e,f);d=null;var hb=B&&B.x<=e&&y&&y.x>=e;E=i.getUrl(X,R);if(E){N=nb.getState(E);if(N!=A.failed){var z=V,Z=0;if(e===0){z-=q;z+=r;Z=-r}if(e===bb){z-=q;z+=r}var x=U,ab=0;if(f===0){x-=q;x+=r;ab=-r}if(f===cb){x-=q;x+=r}G="width:"+z+"px;height:"+x+"px;border:0px;"+g.safariRenderHack;if(Q.requireFlowLayout){if(F)G+="margin-left:"+F*m+"px;";if(O)G+="margin-top:"+O*l+"px;"}else G+="position:absolute;left:"+((e-c.x)*m+Z)+"px;top:"+((f-c.y)*l+ab)+"px";d=k("img",G);d[L+"tileId"]=X;d[L+"tileUrl"]=E;d.width=z;d.height=x;d.border=0;if(N===A.ready||N===A.cacheExpired&&hb&&ib){var gb=e<o.x||f<o.y||e>u.x||f>u.y;if(!gb)d.src=E;else{d.style.visibility="hidden";s.push(d)}}else{d.style.visibility="hidden";p.push(d)}if(N!=A.ready){P=new Jb(E);P.priority=(db-e)*(db-e)+(eb-f)*(eb-f);t.push(P)}S.push(d)}else if(!n.isOverlay)D++;w++}if(d){F=0;W=true;K.appendChild(d)}else F++}if(W){O=0;Q.requireFlowLayout&&k("br",null,K)}else O++}if(g.useImageDisposer){Y=C.length;while(Y--)C[Y].src=b.spacerImageUrl}C.length=0;var jb=C;C=S;S=jb;K.style.cssText=T;h.parentNode&&h.parentNode.replaceChild(K,h);h=K;J();if(M&&t.length){t.basketId=n;t.sort(Mb);H=a.addHandler(t,"hasnewtiles",fb);nb.setDownloadBasket(t,R)}I()}function I(){s.length&&t.dispatch(eb)}function eb(){if(n.allowTileRender){var b=Math.min(s.length,db);while(b--){var a=s.shift();a.style.visibility="visible";a.src=a[L+"tileUrl"]}}I()}function fb(){if(M){var c=p.length,a=true;while(c--&&a){var d=true,b=p[c],f=b[L+"tileUrl"],e=nb.getState(f);switch(e){case A.ready:s.push(b);break;case A.failed:if(Q.requireFlowLayout)a=false;else{h.removeChild(b);D++}break;default:d=false}d&&p.splice(c,1)}if(!a)ab();else I()}}var J=function(){};if(g.useFilterReflowWorkaround&&Q.usingIEFilters)J=function(){h.offsetWidth}}O.getBestLevelOfDetail=function(c,b){var a=b.getMaxLevelOfDetail()-h.log2(b.getWidth()/b.projectingCamera.getWidth()/(c.getZoomOriginWidth()/c.getWidth()));a=Math.round(a-.25);a=Math.min(a,b.getMaxLevelOfDetail());return a};function Bb(){var I=this,G=.5,x=true,c=null,e=null,j=null,m=null,o=null,C=[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,11,14,14,14,17,17,17,20,20,20,23,23,23,23],E=g.animateOverlayLayers,v=g.isIOSBrowser?2:4,K,q=k();q.style.cssText="position:absolute;z-index:0;left:0;top:0;"+g.safariRenderHack;var n,l,p,s,d=[],y=true,B=false;_allowNewTiles=true;var w=0,A=false,r;this.allowTileGridSwitch=true;this.render=function(e,d,c,b,a){if(b!=l)A=false;if(c!==n){B=true;A=false}x=a!=null?a:x;s=e;p=d;n=c;l=b;u()};this.addOverlay=function(c,a){var b=jb.getNext();d.push({id:b,tilePyramid:c,zIndex:a.getZIndex(),opacity:a.getOpacity(),animation:a.getAnimation(),tileLayer:a,havePendingDownloads:false,hadPendingDownloadsLastUpdate:true});H();t.dispatch(u,10);return b};this.removeOverlay=function(c){var b,a=d.length;while(a--)if(d[a].id===c){b=d[a].tileGrid;b&&b.dispose();if(d[a].tempDisplayGrid){d[a].tempDisplayGrid.dispose();d[a].tempDisplayGrid=null}d.splice(a,1);t.dispatch(u,10);break}};this.updateOverlay=function(e,c,f){_overlaysUpdated=true;var a=d.length;while(a--)if(d[a].id===e){var b=d[a];b.opacity=f;if(b.zIndex!==c){b.zIndex=c;H()}if(d[a].tempDisplayGrid){d[a].tempDisplayGrid.dispose();d[a].tempDisplayGrid=null}t.dispatch(u,10);break}};this.suspendGettingNewTiles=function(){_allowNewTiles=false;i(j);j=null;i(e);e=null;i(r);r=null;if(c){c.opacity=1;c.allowTileRender=false}};this.allowGettingNewTiles=function(){if(c)c.allowTileRender=true;if(!_allowNewTiles){_allowNewTiles=true;t.dispatch(u,10)}};this.disposeTiles=function(){t.cancelDispatch(u);i(j);j=null;i(e);e=null;i(r);r=null;i(c);c=null;i(m);m=null;i(o);o=null;var b,a,f=d.length;while(f--){b=d[f];a=b.tileGrid;if(a){a.dispose();b.tileGrid=null}}};this.showBackground=function(a){if(a!==null){E=a;if(!a){i(m);m=null;i(o);o=null}}};this.setBufferSize=function(a){a=Math.max(0,Math.min(4,a));if(a!=w){w=a;t.dispatch(u)}};this.getRootElement=function(){return q};this.isDownloadingTiles=function(){return j&&j.getDownloadProgress()<1||c&&c.getDownloadProgress()<1};function F(a,c,b){return a&&a.getTilePyramid()===c&&a.levelOfDetail===b}function i(a){a&&a.dispose()}function u(){t.cancelDispatch(u);var H,L=false,N=false,K=false;if(n){if(_allowNewTiles&&!A){var U=O.getBestLevelOfDetail(l,n);if(F(c,n,U)){i(j);j=null;if(f.areAligned(l,p)&&l.getWidth()===p.getWidth())c.populate(p,s,w);else c.populate(l,s,w);if(e){var V=(_lastTileGridBlendOn?new Date-_lastTileGridBlendOn:0)/1e3,P=V/G;if(c.mercatorZoom>e.mercatorZoom){c.opacity+=P;e.opacity=1;if(c.opacity>=1||P>=.5){c.opacity=1;r=e;e=null}else L=true}else{e.opacity-=P;c.opacity=1;if(e.opacity<=0||P>=.5){i(e);e=null}else L=true}_lastTileGridBlendOn=new Date}}else{J();if(c==null){c=j;j=null;q.appendChild(c.getRootElement());K=true}else{i(e);e=null;c.opacity=1;i(r);r=null;if(I.allowTileGridSwitch&&(!x||j.getDownloadProgress()>.7)){if(j.getNoImageTileRatio()>.5){i(j);j=null;A=true}else if(x&&G>1/b.maxFPS){e=c;c=j;j=null;if(c.mercatorZoom>e.mercatorZoom){if(e.getRootElement().nextSibling==null)q.appendChild(c.getRootElement());else q.insertBefore(c.getRootElement(),e.getRootElement().nextSibling);e.opacity=1;c.opacity=0;K=true}else{q.insertBefore(c.getRootElement(),e.getRootElement());c.opacity=1;e.opacity=1;K=true}}else{q.insertBefore(j.getRootElement(),c.getRootElement());i(c);c=j;j=null;K=true}e&&e.stopDownloading();_lastTileGridBlendOn=new Date}L=true}}}}else{i(c);c=null;i(e);e=null;i(r);r=null}if(c){if(c.getDownloadProgress()<1)N=true;c.render(p)}e&&e.render(p);r&&r.render(p);if(m)if(!n){i(m);m=null;i(o);o=null}else{var R=C[O.getBestLevelOfDetail(l,n)];if(_allowNewTiles&&R==m.levelOfDetail){var T=new z(s.width*v,s.height*v);m.populate(l,T,0)}m.render(p,1);if(o)if(o.getDownloadProgress()>.9&&(o.mercatorZoom<=m.mercatorZoom||l.getWidth()/p.getWidth()>.9)){i(m);m=o;m.render(p,1);o=null}else N=true}var h,k,S,Q,M;H=d.length;while(H--){h=d[H];h.havePendingDownloads=false;k=h.tileGrid;S=O.getBestLevelOfDetail(l,h.tilePyramid);M=h.tilePyramid.projectingCamera;Q=l.getHeading()!==M.getHeading()||l.getPitch()!==M.getPitch()||l.getRoll()!==M.getRoll()||l.getDistanceInverse()!==M.getDistanceInverse();if(k&&(k.levelOfDetail!==S||Q)){if(!h.tempDisplayGrid){h.tempDisplayGrid=k;h.swapping=null}else k.dispose();k=null}if(_allowNewTiles&&!Q){if(!k){k=new O(h.tilePyramid,S);k.isOverlay=true;k.hideWhileAnimating=h.animation==="s"?false:h.animation==="h"?true:g.animateOverlayLayers?false:true;k.opacity=h.opacity;K=true}k.populate(l,s,w)}if(k||h.tempDisplayGrid){if(h.tempDisplayGrid)if(h.swapping&&k){(h.swapping!=k||K||y)&&D(k,H);k.render(p);h.tempDisplayGrid.dispose();h.tempDisplayGrid=null;h.swapping=null}else{h.tempDisplayGrid.render(p);if(k&&k.getDownloadProgress()>.85&&(k.mercatorZoom<h.tempDisplayGrid.mercatorZoom||l.getWidth()/p.getWidth()>.9)){D(k,H);k.render(p);h.swapping=k;L=true}}else{(K||y)&&D(k,H);k.render(p)}if(k&&k.getDownloadProgress()<1)h.havePendingDownloads=true}h.tileGrid=k}y=false;if(N)L=true;else B&&a.invoke(I,"tiledownloadcomplete");B=N;H=d.length;while(H--){h=d[H];if(h.havePendingDownloads)L=true;else h.hadPendingDownloadsLastUpdate&&h.tileLayer&&a.invoke(h.tileLayer,"tiledownloadcomplete");h.hadPendingDownloadsLastUpdate=h.havePendingDownloads}L&&t.dispatch(u,10);if(E&&!o&&_allowNewTiles&&n&&m){var R=C[O.getBestLevelOfDetail(l,n)];if(!F(m,n,R)){i(o);o=new O(n,R,true);var T=new z(s.width*v,s.height*v);o.populate(l,T,0);q.insertBefore(o.getRootElement(),m.getRootElement());t.dispatch(u,10)}}if(r&&l.getWidth()/p.getWidth()>.95){i(r);r=null}}function D(b,c){if(d[c].tempDisplayGrid){q.insertBefore(b.getRootElement(),d[c].tempDisplayGrid.getRootElement());return}var a=c+1;while(a<d.length){if(d[a].tempDisplayGrid){q.insertBefore(b.getRootElement(),d[a].tempDisplayGrid.getRootElement());break}else if(d[a].tileGrid){q.insertBefore(b.getRootElement(),d[a].tileGrid.getRootElement());break}a++}a>=d.length&&q.appendChild(b.getRootElement())}function J(){var a=O.getBestLevelOfDetail(l,n);if(!F(j,n,a)){i(j);j=new O(n,a);j.mercatorZoom=n.projectingCamera.getMercatorZoom()+h.log2(n.projectingCamera.getWidth()/l.getWidth())}j.populate(l,s,w);if(E&&x&&n){var b=C[O.getBestLevelOfDetail(l,n)];if(!m){m=new O(n,b,true);var c=new z(s.width*v,s.height*v);m.populate(l,c,0);if(q.childNodes[0])q.insertBefore(m.getRootElement(),q.childNodes[0]);else q.appendChild(m.getRootElement())}}}function H(){y=true;d.sort(function(a,b){return a.zIndex-b.zIndex})}}o.TileRenderer=Bb;var gb=new function(){var d,a,c;this.isClipped=function(){b();return d};this.isEventsSupported=function(){b();return a};this.getContext=function(a){if(!a.harmonyContext){b();var d;switch(c){case 1:d=new l(a);break;case 2:d=new m(a);break;case 3:d=new k(a)}a.harmonyContext=d}return a.harmonyContext};function b(){if(i()){c=1;d=true;a=true}else if(j()){c=2;d=false;a=true}else if(h()){c=3;d=true;a=false}b=function(){}}function i(){var a=false;if(document.implementation&&document.implementation.hasFeature)a=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");else if(document.createElementNS){var b=document.createElementNS(ns,"svg");a=typeof b.createSVGRect!=="undefined"}i=function(){return a};return a}function j(){var b=document.createElement("v:shape");b.style.behavior="url(#default#VML)";var a=typeof b.strokecolor!=="undefined";j=function(){return a};return a}function h(){var b=document.createElement("canvas"),a=b.getContext&&b.getContext("2d")!==null;h=function(){return a};return a}this.destroyContext=function(a){if(a.harmonyContext){a.harmonyContext.clear();a.harmonyContext=null}};var f={nativeShape:null,_events:null,id:null,data:"",strokeStyle:"#000",strokeOpacity:"1",dashArray:"solid",fillStyle:"#000",fillOpacity:"1",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"#000000ff",beginPath:function(){this.data=""},moveTo:function(a,b){this.data+="M"+Math.round(a)+","+Math.round(b)+" "},lineTo:function(a,b){this.data+="L"+Math.round(a)+","+Math.round(b)+" "},stroke:function(){},onMouseDown:function(a){this._events.mousedown.push(a)},onMouseUp:function(a){this._events.mouseup.push(a)},onClick:function(a){this._events.click.push(a)},onMouseMove:function(a){this._events.mousemove.push(a)},onMouseOver:function(a){this._events.mouseover.push(a)},onMouseOut:function(a){this._events.mouseout.push(a)},_dispatchEvent:function(a,c){var b=this._events[a].length;while(b--)this._events[a][b].call(this,c)},_initialize:function(a){var b=this;b._events={mousedown:[],mouseup:[],mousemove:[],mouseover:[],mouseout:[],click:[]};function c(a){a=a||window.event;b._dispatchEvent(a.type,a)}a.onmousedown=a.onmouseup=a.onclick=a.onmousemove=a.onmouseover=a.onmouseout=c;this.nativeShape=a}};function e(b){function a(a){this._surface=a;this._paths=[]}a.prototype={setSize:function(b,a){this._width=b;this._height=a},createPath:function(){},renderPath:function(){},removePath:function(b){var a=this._paths.length;while(a--)if(this._paths[a]===b){this._surface.removeChild(b.nativeShape);this._paths.splice(a,1);break}},clear:function(){var a=this._paths.length;while(a--)this._surface.removeChild(this._paths[a].nativeShape);this._paths=[]}};return new a(b)}function m(b){function a(){}a.prototype=new e(b);a.prototype.createPath=function(){return new c};a.prototype.renderPath=function(b){var c="url(#default#VML)",d=this._height!=null?this._height:this._surface.offsetHeight,e=this._width!=null?this._width:this._surface.offsetWidth,a=b.nativeShape;this._surface.appendChild(a);a.style.height=d;a.style.width=e;a.style.behavior=c;a.coordsize=e+","+d;b._stroke.style.behavior=c;b._fill.style.behavior=c;this._paths.push(b)};return new a;function c(){function a(){var d=this,a=document.createElement("v:shape");a.style.position="absolute";var b=document.createElement("v:stroke");a.appendChild(b);var c=document.createElement("v:fill");a.appendChild(c);this._stroke=b;this._fill=c;this._initialize(a)}a.prototype=f;a.prototype.stroke=function(){if(this.data!=null&&(!this.data.length||this.data.charAt(this.data.length-1)!=="E"))this.data+="E";var a=this.nativeShape;a.strokecolor=this.strokeStyle;a.strokeweight=this.lineWidth+"pt";if(this.lineCap){this._stroke.endcap=this.lineCap.toLowerCase()==="butt"?"flat":path.lineCap;this._stroke.dashstyle=this.dashArray;this._stroke.opacity=this.strokeOpacity}if(this.fillStyle&&this.fillStyle!=="none"){this._fill.color=this.fillStyle;this._fill.opacity=this.fillOpacity*100+"%"}else a.filled=false;a.path=this.data};return new a}}function l(c){function b(){}var d="http://www.w3.org/2000/svg",a=document.createElementNS(d,"svg");if(g.safariRenderHack)a.style.cssText=g.safariRenderHack;a.setAttribute("width","100%");a.setAttribute("height","100%");c.appendChild(a);b.prototype=new e(a);b.prototype.createPath=function(){return new h};b.prototype.renderPath=function(a){var b=a.nativeShape;this._surface.appendChild(b);this._paths.push(a)};return new b(c);function h(){function a(){var a=this;this._initialize(document.createElementNS(d,"path"))}a.prototype=f;a.prototype.stroke=function(){var a=this.nativeShape;a.setAttribute("stroke",this.strokeStyle);a.setAttribute("stroke-width",this.lineWidth);a.setAttribute("stroke-linecap",this.lineCap);a.setAttribute("stroke-dasharray",this.dashArray);a.setAttribute("fill",this.fillStyle);a.setAttribute("fill-opacity",this.fillOpacity);a.setAttribute("stroke-opacity",this.strokeOpacity);a.setAttribute("d",this.data)};return new a}}function k(b){function a(){}a.prototype=new e(b);a.prototype.setSize=function(b,a){if(this._width!==b||this._height!==a){this._width=b;this._height=a;var c=this._paths.length;while(c--)this._paths[c].setSize(b,a)}};a.prototype.createPath=function(){var a=this._height?this._height:this._surface.offsetHeight,b=this._width?this._width:this._surface.offsetWidth;return new c(b,a)};a.prototype.renderPath=function(a){var b=a.nativeShape;this._surface.appendChild(b);this._paths.push(a)};return new a(b);function c(h,g){var d,c;function a(){var d=this,a=document.createElement("canvas");a.style.cssText="position:absolute;";b.appendChild(a);var c=a.getContext("2d");c.beginPath();this.context=c;this._initialize(a);this.setSize(h,g)}a.prototype=f;a.prototype.setSize=function(b,a){d=b;c=a;this.nativeShape.setAttribute("width",d);this.nativeShape.setAttribute("height",c)};a.prototype.beginPath=function(){this.context.beginPath()};a.prototype.moveTo=function(a,b){this.context.moveTo(a,b)};a.prototype.lineTo=function(a,b){this.context.lineTo(a,b)};a.prototype.stroke=function(){var a=this.context;a.clearRect(0,0,d,c);if(this.fillStyle&&this.fillStyle!=="none"){a.fillStyle=e(this.fillStyle,this.fillOpacity);a.fill()}a.strokeStyle=e(this.strokeStyle,this.strokeOpacity);a.lineWidth=this.lineWidth;a.stroke();this.drawn=true};function e(b,c){if(b.length==7){var a=/^#(\w{2})(\w{2})(\w{2})$/.exec(b);return"rgba("+parseInt(a[1],16)+","+parseInt(a[2],16)+","+parseInt(a[3],16)+","+c+")"}else return""}return new a}}};function lb(){lb.ensureVmlNamespace();var K=this,B,u,q,A,C,i,c,f,o,n,F,y,p,r={first:0,middle:1,last:2},t=[["entityadded",O],["entityremoved",N],["entitychanged",L]],v=[["mercator",x.horizontal],["enhancedBirdseyeNorthUp",x.horizontal],["enhancedBirdseyeEastUp",x.vertical],["enhancedBirdseyeSouthUp",x.horizontal],["enhancedBirdseyeWestUp",x.vertical]];function O(a){D(a.collection,a.entity,true,false,r.last)}function N(a){l(a.entity,true,false);I(a.entity)}function L(a){D(a.collection,a.entity,true,false,r.last)}this.activate=function(e,j,h,d,f){B=e;q=j;u=e.entities;A=h;F=gb.isClipped();C=f;i=C+"_der";c=C+"_etr";u[c]={root:d,shape:k(null,g.safariRenderHack,d)};var b=t.length;while(b--)t[b][2]=a.addHandler(u,t[b][0],t[b][1])};this.deactivate=function(){f=null;var b=t.length;while(b--){a.removeHandler(t[b][2]);t[b][2]=null}l(u,true,false);I(u);B=null;q=null;u=null;A=null};this.onMouseDown=function(a){h(null,"mousedown",a)};this.onTouchStart=function(a){if(!p)p=[];h(null,"mousedown",a,true)};this.onMouseUp=function(a){h(this.getEntityForTarget(a.captureTarget),"mouseup",a)};this.onTouchEnd=function(c){h(this.getEntityForTarget(c.captureTarget),"mouseup",c,true);if(p){var b=p;p=null;var d=b.length;while(d--){var a=b[d];a&&a.parentNode&&a.parentNode.removeChild(a)}}};this.onMouseOver=function(a){h(null,"mouseover",a)};this.onMouseOut=function(a){h(null,"mouseout",a)};this.onMouseClick=function(a){h(null,"click",a)};this.onMouseRightClick=function(a){h(null,"rightclick",a)};this.onMouseDoubleClick=function(a){h(null,"dblclick",a)};this.onTap=function(a){h(null,"click",a,true)};this.onDoubleTap=function(a){h(null,"dblclick",a,true)};this.onTapAndHold=function(a){h(null,"rightclick",a,true)};this.getEntityForTarget=function(a){if(a&&a.nodeType===3)a=a.parentNode;return a&&a[i]?a[i]:null};this.getTargetType=function(b){var a=null;if(b instanceof hb)a=S.pushpin;else if(b instanceof s)a=S.infobox;else if(b instanceof eb)a=S.polyline;else if(b instanceof ab)a=S.polygon;return a};function h(b,f,c,g){if(!b)b=K.getEntityForTarget(c.target);if(b&&a.hasHandler(b,f)){var e;if(g&&c.touches&&c.touches[0])e=new d(c.touches[0].pageX,c.touches[0].pageY);if(!e)e=m.Screen.get_mouse_pos(c);var h=new Y(B,K.getTargetType(b),b,f,e.x,e.y,0,g,c);a.invoke(b,f,h)}}this.update=function(d,b,c,a){f=d;o=b.clone();if(a==r.last||!n){n=q.getBounds();n.width*=3;n.height*=3}if(a==r.last&&F)y=false;else y=y&&c;D(null,u,false,y,a);if(a==r.last)y=true};function D(p,b,d,q,C){if(f){var J=false;if(b instanceof bb){var a=b[c],i,r;if(!a){i=k(null,g.safariRenderHack);r=k(null,g.safariRenderHack);i.appendChild(r);a={root:i,shape:r};b[c]=a;J=true;d=true}else{i=a.root;r=a.shape}if(d){var y="position:absolute;";if(!b.getVisible())y+="display:none;";var K=b.getZIndex();if(typeof K=="number")y+="z-index:"+K+";";i.style.cssText=y+g.safariRenderHack}var t,I=a.lookAt,w=false;if(q&&I){var j=o.getWorldToViewport().transform(I);if(!F&&(Math.abs(j.x)>1e4||Math.abs(j.y)>1e4)){t="position:absolute;";w=true;a.lookAt=o.getLookAt();a.offsetLeft=0;a.offsetTop=0}else{var B=e.translation(j.x,j.y,0);t=g.isIOS3?Q.setTransformAndOpacity(B,null,1):"position:absolute;"+Q.setTransformAndOpacity(B,null,1,{excludeCommonCss:true});a.offsetLeft=j.x;a.offsetTop=j.y}}else{t="position:absolute;";a.lookAt=o.getLookAt();a.offsetLeft=0;a.offsetTop=0}r.style.cssText=t;if(a.harmony&&!z.areEqual(a.previousSize,f)){var u=a.harmony;u.style.width=f.width+"px";u.style.height=f.height+"px";u.style.left=-(f.width/2)+"px";u.style.top=-(f.height/2)+"px";a.previousSize=f}J&&p[c].root.appendChild(i);if(w&&a&&a.harmony&&a.harmony.style)a.harmony.style.display="none";for(var L=b.getLength(),m=0;m<L;m++)D(b,b.get(m),d,q&&!w,C);w&&setTimeout(function(){if(a&&a.harmony&&a.harmony.style)a.harmony.style.display="block"},1)}else if(b instanceof hb){var E=b.getVisible()&&(n.contains(b.getLocation())||b[c]&&b[c].dragging);if(E)T(p,b,d,q);else l(b,true,d)}else if(b instanceof s){var E=b.getVisible()&&n.contains(b.getLocation());if(E)R(p,b,d,q);else l(b,true,d)}else if(b instanceof eb||b instanceof ab)if(b.getVisible())P(p,b,d,q,C);else l(b,true,d);else if(b instanceof ob)if(p.getVisible()){var a=b[c];if(!a){a={};b[c]=a}if(d||!a.added){a.added=true;var m=v.length;while(m--){var h=v[m][0];if(a[h]){A.removeOverlay(a[h]);a[h]=null}if(b.getVisible()){var x=b.getTileSource(h);if(x){var H=M.createQuadKeyTilePyramid(x.getWidth(),x.getHeight(),x.getUriConstructor(),v[m][1]);H.projectingCamera=G[h];a[h]=A.addOverlay(H,b)}}}}}else l(b,true,d)}}function T(n,a,h,C){var b,d=a[c];if(!d){b=k(null,g.safariRenderHack);b[i]=a;d={dom:b,dragAttached:false};a[c]=d;h=true}else{h=d.updateEntity||h;d.updateEntity=false}b=d.dom;if(h){var l=d.icon,y=a.getIcon();if(!l&&y){l=k("img",null,b);d.icon=l;l[i]=a}if(l)l.src=y||"";var f=d.text,u=a.getText();if(!f&&u){f=k(null,g.safariRenderHack,b);f.appendChild(document.createTextNode(""));d.text=f;f[i]=a}if(f)if(u){f.style.cssText="position:absolute;text-align:center;width:100%;font:bold 10pt Arial,Helvetica,Sans-Serif;color:#fff;left:"+a.getTextOffset().x+"px;top:"+a.getTextOffset().y+"px;";f.replaceChild(document.createTextNode(u),f.firstChild)}else{b.removeChild(f);d.text=null}}var j="position:absolute;overflow:hidden;";j+=g.safariRenderHack;if(!C||!d.isDrawn){var p=q.internalTryLocationToViewport(o,a.getLocation());if(p){var z=a.getAnchor(),r=p.x-z.x-n[c].offsetLeft,s=p.y-z.y-n[c].offsetTop;if(g.useTransform3d){var v=e.translation(r,s,0),t={excludeCommonCss:true};if(h)j+=Q.setTransformAndOpacity(v,null,1,t);else{t.returnStyleObject=true;var B=Q.setTransformAndOpacity(v,null,1,t);B.display="";m(b).set_style(B)}}else if(h){j+="left:"+r+"px;";j+="top:"+s+"px;"}else{b.style.left=r+"px";b.style.top=s+"px";b.style.display=""}}else if(h)j+="display:none;";else b.style.display="none"}if(h){b.id=a.getId();var w=a.getTypeName()||"";if(b.className!=w)b.className=w;var A=a.getZIndex();if(typeof A==="number")j+="z-index:"+A+";";j+="width:"+a.getWidth()+"px;";j+="height:"+a.getHeight()+"px;";b.style.cssText=j}if(h||!d.isDrawn){var x=a.getDraggable();x!=d.dragAttached&&J(a,x)}if(!d.isDrawn){n[c].shape.appendChild(b);d.isDrawn=true}}function R(H,d,t,X){var e,a=d[c];if(!a){e=k(null,g.safariRenderHack);e[i]=d;a={dom:e};d[c]=a;t=true}else{t=a.updateEntity||t;a.updateEntity=false}e=a.dom;var l=d.getHtmlContent()==null||d.getTitle()!==null&&d.getTitle()!==""||d.getDescription()!==null&&d.getDescription()!="";if(t){if(a.htmlContent!=null&&l){a.htmlContent.style.display="none";if(a.infoBoxNode!=null)a.infoBoxNode.style.display=""}if(l){var r;if(a.infoBoxNode==null){var r=k("div");e.appendChild(r);r.className="Infobox";a.infoBoxNode=r}else r=a.infoBoxNode;if(d.getShowPointer()&&a.pointerNode==null&&l){var E=k("div"),S=k("img");S.setAttribute("src",b.domain+"/i/pointer_shadow.png");E.appendChild(S);E.style.cssText="position: absolute; border: 0px none; padding: 0px; margin: 0px";e.appendChild(E);a.pointerNode=E}else if((!d.getShowPointer()||!l)&&a.pointerNode){e.removeChild(a.pointerNode);a.pointerNode=null}if(d.getShowCloseButton()&&a.closeButtonNode==null&&l){var w=k("a"),Y=document.createTextNode("x");r.appendChild(w);w.className="close";w.href="#";w.appendChild(Y);var K=function(){d.setOptions({visible:false})};m(w).add_event("click",K).add_event("touchend",K);a.closeButtonHideEvent=K;a.closeButtonNode=w}else if((!d.getShowCloseButton()||!l)&&a.closeButtonNode){m(a.closeButtonNode).remove_event("click",a.closeButtonHideEvent).remove_event("touchend",a.closeButtonHideEvent);a.closeButtonHideEvent=null;r.removeChild(a.closeButtonNode);a.closeButtonNode=null}var O=d.getHeight()-35-20;if(d.getActions().length>0)O-=32;var s=d.getTitle();if(s==="")s=null;var u=d.getDescription();if(u==="")u=null;var p=a.contentNode;if(p==null&&l){p=k("div");p.className="content";r.appendChild(p);a.contentNode=p}else if(p!=null&&!l){r.removeChild(p);a.contentNode=null}var j;if(s!=null)if(a.titleDivNode==null){j=k("div");j.className="title";p.insertBefore(j,p.firstChild);a.titleDivNode=j}else j=a.titleDivNode;var f=a.titleLinkNode;if(f!=null){if(a.titleLinkHandler!=null){m(f).remove_event("click",a.titleLinkHandler).remove_event("touchend",a.titleLinkHandler);a.titleLinkHandler=null}f.firstChild&&f.removeChild(f.firstChild);j.removeChild(f);a.titleLinkNode=null;f=null}j!=null&&j.firstChild&&j.removeChild(j.firstChild);if(s==null&&a.titleDivNode!=null){p.removeChild(a.titleDivNode);a.titleDivNode=null}if(s!=null)if(d.getTitleClickHandler()!=null){f=k("a");j.appendChild(f);a.titleLinkNode=f;f.appendChild(document.createTextNode(s));f.setAttribute("href","#");m(f).add_event("click",d.getTitleClickHandler()).add_event("touchend",d.getTitleClickHandler());a.titleLinkHandler=d.getTitleClickHandler()}else j.appendChild(document.createTextNode(s));var n=a.descriptionNode;if(u!=null&&n==null){n=k("div");n.cssText="height:"+O+"px";n.className="description";n.innerHTML=u;p.appendChild(n);a.descriptionNode=n}if(u!=null){n.innerHTML="";n.appendChild(document.createTextNode(u))}else if(n){e.removeChild(n);a.descriptionNode=null}var v=d.getActions(),x;if(v.length>0)if(a.actionsNode!=null){while(a.actionsNode.firstChild)a.actionsNode.removeChild(a.actionsNode.firstChild);x=a.actionsNode}else{x=k("div");a.actionsNode=x;x.className="actions";r.appendChild(x)}if(a.actionsEventHandlers!=null)try{var G;while((G=a.actionsEventHandlers.pop())!=null)m(G.elem).remove_event("click",G.event).remove_event("touchend",G.event)}catch(ab){}if(v.length>0){var L=k("ul");L.className="actions-list";var Z=[];a.actionsEventHandlers=[];for(var A=0;A<v.length;A++){var U=k("li"),C=k("a");C.innerHTML=v[A].label;C.setAttribute("href","#");U.appendChild(C);L.appendChild(U);m(C).add_event("click",v[A].eventHandler).add_event("touchend",v[A].eventHandler);a.actionsEventHandlers.push({elem:C,event:v[A].eventHandler})}x.appendChild(L)}}else{var T=d.getHtmlContent(),B=a.htmlContent;if(s==null&&u==null&&T!=null){if(B==null){B=k("div");e.appendChild(B);a.htmlContent=B}B.innerHTML=T;if(a.infoBoxNode!=null)a.infoBoxNode.style.display="none";if(a.pointerNode!=null)a.pointerNode.style.display="none"}}}var D="position:absolute;overflow:visible;white-space:normal;line-height:16px;",I="position:absolute;overflow:hidden;background-color:white;border:1px solid rgb(136, 136, 136);left:0px;top:0px;",J="width:33px;height:38px;overflow:hidden;position:absolute;z-index:1;";if(!X||!a.isDrawn){var M=q.internalTryLocationToViewport(o,d.getLocation());if(M){var F=d.getOffset(),V=d.getAnchor(),y=M.x-H[c].offsetLeft,z=M.y-H[c].offsetTop;if(l){y=y+F.x-V.x;z=z-F.y-V.y}else{y=y+F.x;z=z-F.y}if(t&&l){D+="left:"+y+"px;";D+="top:"+z+"px;";J+="left:"+20+"px;";J+="top:"+(d.getHeight()+1)+"px;"}else{e.style.position="absolute";e.style.left=y+"px";e.style.top=z+"px";e.style.display=""}}else if(t)cssText+="display:none;";else e.style.display="none"}if(t&&l){var W=d.getZIndex();if(typeof W==="number")D+="z-index:"+W+";";I+="width:"+d.getWidth()+"px;";I+="height:"+d.getHeight()+"px;";e.style.cssText=D+g.safariRenderHack;a.infoBoxNode.style.cssText=I;if(d.getShowPointer())a.pointerNode.style.cssText=J}if(!a.mouseDoubleClickInfobox){var N=function(a){h(d,"dblclick",a);a.stopPropagation()};m(e).add_event("dblclick",N,true);a.mouseDoubleClickInfobox=N}if(!a.mouseEnterInfobox){var Q=function(a){h(d,"mouseenter",a);a.stopPropagation()};m(e).add_event("mouseenter",Q,true);a.mouseEnterInfobox=Q}if(!a.mouseLeaveInfobox){var R=function(a){h(d,"mouseleave",a);a.stopPropagation()};m(e).add_event("mouseleave",R,true);a.mouseLeaveInfobox=R}if(!a.mouseClickInfobox){var P=function(a){h(d,"click",a);a.stopPropagation()};m(e).add_event("click",P,false);a.mouseClickInfobox=P}m(e).add_event("touchstart",mb);m(e).add_event("MSPointerDown",mb);if(!a.isDrawn){H[c].shape.appendChild(e);a.isDrawn=true}}function P(h,d,e,A,D){var a=d[c];if(!a){a={};d[c]=a}else{e=a.updateEntity||e;a.updateEntity=false}if(!A&&D!=r.last&&!g.animateShapes){a.isDrawn&&l(d,true,e);return}if(e||!a.boundingRect){var N=d.getLocations();if(N)a.boundingRect=w.fromLocations(d.getLocations());else{l(d,true,e);return}}if(!n.intersects(a.boundingRect)){l(d,true,e);return}var p=a.harmony;if(!p)if(h){var s=h[c].harmony;if(!s){s=k("div","position:absolute;width:"+f.width+"px;height:"+f.height+"px;left:"+-(f.width/2)+"px;top:"+-(f.height/2)+"px;"+g.safariRenderHack);h[c].harmony=s;var x=h[c].shape;if(x.firstChild)x.insertBefore(s,x.firstChild);else x.appendChild(s)}p=gb.getContext(s);a.harmony=p}else return;var b=a.path,B=false;if(!b||!z.areEqual(a.previousSize,f)){p.setSize(f.width,f.height);a.previousSize=f;B=true}if(!b){b=p.createPath();b.id=C+"path"+jb.getNext();a.path=b;if(gb.isEventsSupported())b.nativeShape[i]=d;addToDiv=true;e=true}if(e){var G=d.getStrokeColor();b.strokeStyle=G.toHex();b.strokeOpacity=G.getOpacity();b.lineWidth=d.getStrokeThickness();b.dashArray=d.getStrokeDashArray();if(d instanceof ab){var J=d.getFillColor();b.fillStyle=J.toHex();b.fillOpacity=J.getOpacity()}else b.fillStyle="none"}var m;if(!A||!a.points||B){a.points=q.internalTryLocationToViewport(o,d.getLocations());a.offsetLeft=h[c].offsetLeft;a.offsetTop=h[c].offsetTop;var H=d instanceof eb&&(a.boundingRect.width>n.width||a.boundingRect.height>n.height);a.doClipping=H;if(!H){var t=a.points,F=t.length;m=t.length;while(m--)if(!t[m]){F=false;m=0}if(!F)a.points=[]}}if(!A||D==r.last||e||B){var t=a.points,y;if(a.doClipping){var M=f.width*3,L=f.height*3;y=U(new E(-h[c].offsetLeft-M/2,-h[c].offsetTop-L/2,M,L),t)}else y=[t];b.beginPath();var I=a.offsetLeft-f.width/2,K=a.offsetTop-f.height/2;m=y.length;while(m--){var v=y[m];if(v&&v.length){var u=v[0];b.moveTo(u.x-I,u.y-K);for(j=1;j<v.length;j++){u=v[j];b.lineTo(u.x-I,u.y-K)}}}!b.data&&b.moveTo(0,0);b.stroke();if(!a.isDrawn){p.renderPath(b);a.isDrawn=true}}}function l(d,g,e){if(d&&d[c]){var a=d[c];if(d instanceof bb){var b=a.root,j=false;if(g&&b&&b.parentNode)if(p){p.push(p);j=true}else b.parentNode.removeChild(b);var f=d.getLength();while(f--)l(d.get(f),j,e)}else if(d instanceof hb){J(d,false);H(d);var b=a.dom;if(b){b[i]=null;g&&b.parentNode&&b.parentNode.removeChild(b)}a.updateEntity=a.updateEntity||e;a.isDrawn=false}else if(d instanceof s){var b=a.dom;if(b){m(b).remove_event("mouseenter",a.mouseEnterInfobox,true).remove_event("mouseleave",a.mouseLeaveInfobox,true).remove_event("click",a.mouseClickInfobox,false).remove_event("dblclick",a.mouseDoubleClickInfobox,true).remove_event("touchstart",mb,false).remove_event("MSPointerDown",mb,false);a.mouseEnterInfobox=a.mouseLeaveInfobox=a.mouseClickInfobox=a.mouseDoubleClickInfobox=null;b[i]=null;g&&b.parentNode&&b.parentNode.removeChild(b)}a.updateEntity=a.updateEntity||e;a.isDrawn=false}else if(d instanceof eb||d instanceof ab){var k=a.harmony;if(k){var h=a.path;if(h){h.nativeShape[i]=null;k.removePath(h);a.path=null}}a.updateEntity=a.updateEntity||e;a.isDrawn=false}else if(d instanceof ob){a.added=false;var f=v.length;while(f--){var n=v[f][0];a[n]&&A.removeOverlay(a[n])}}}}function I(a){if(a instanceof bb){var b=a.getLength();while(b--)I(a.get(b))}else if(a instanceof hb){J(a,false);H(a)}delete a[c]}function J(e,d){var b=e[c];if(b){b.dragAttached=d;if(d)b.dragStartHandler=a.addHandler(e,"mousedown",V);else if(b.dragStartHandler){a.removeHandler(b.dragStartHandler);delete b.dragStartHandler}}}function V(f){var b=f.target,e=b[c];if(e&&(f.isTouchEvent||f.originalEvent.which===1)){e.dragging=true;var g=q.internalTryLocationToViewport(o,b.getLocation());if(g){var j=g.x-f.getX(),k=g.y-f.getY();a.invoke(b,"dragstart",{entity:b});function h(c){c.handled=true;var e=q.internalTryViewportToLocation(o,new d(c.getX()+j,c.getY()+k));e&&b.setLocation(e);a.invoke(b,"drag",{entity:b})}function i(){H(b);a.invoke(b,"dragend",{entity:b})}if(e.dragAttached&&!e.dragEndHandler){e.dragMoveHandler=a.addHandler(B,"mousemove",h);e.dragEndHandler=a.addHandler(B,"mouseup",i)}}}}function H(d){var b=d[c];if(b){b.dragging=false;if(b.dragMoveHandler){a.removeHandler(b.dragMoveHandler);delete b.dragMoveHandler}if(b.dragEndHandler){a.removeHandler(b.dragEndHandler);delete b.dragEndHandler}}}function U(c,e){for(var i=c.x,j=c.x+c.width,k=c.y,l=c.y+c.height,f=[],a=[],h=e.length,d=0;d<h;d++){var b=e[d];if(b){var g=b.x>=i&&b.y>=k&&b.x<=j&&b.y<=l;if(g){!a.length&&d&&e[d-1]&&a.push(e[d-1]);a.push(b)}else if(a.length){a.push(b);f.push(a);a=[]}}else{f.push(a);a=[]}}a.length&&f.push(a);return f}}lb.ensureVmlNamespace=function(){lb.ensureVmlNamespace=function(){};try{document.namespaces&&document.namespaces.add&&document.namespaces.add("v","urn:schemas-microsoft-com:vml")}catch(a){}};function xb(b,g,f,d,e){this.priority=e;function c(b){var d=[],a=b?b.split(";"):[],e=a.length;while(e--){var c=w.fromString(a[e]);c&&d.push(c)}return d}var a=c(d);this.getScene=function(j,h,e,c){if(c>=g&&c<f){if(!a||!a.length)return b;var i=new l(h,e),d=a.length;while(d--)if(a[d].contains(i))return b}return null}}var vb=new function(){var c={},a={};this.getCachedImageryProviders=function(a){return c[a]};this.getImageryProviders=function(e,h,f,g){if(c[e])f(c[e],g);else if(a[e])a[e].push({callback:f,userData:g});else if(b.imageryMetadataUrl){a[e]=[];a[e].push({callback:f,userData:g});var i=b.imageryMetadataUrl.replace(/{imagerySet}/,e).replace(/{credentials}/,h);W.getObjectAsync(i,d,e)}else f(null,g)};function d(b,h){var g=h.userData,d=null;if(h&&h.success&&b&&b.resourceSets&&b.resourceSets[0]&&b.resourceSets[0].resources&&b.resourceSets[0].resources[0]&&b.resourceSets[0].resources[0].imageryProviders){d=[];var j=b.resourceSets[0].resources[0].imageryProviders,f=j.length;while(f--){var m=j[f],k=m.coverageAreas,l={attribution:m.attribution,coverageAreas:[]},p=k.length;while(p--){var i=k[p],e=i.bbox;l.coverageAreas.push({zoomMax:i.zoomMax,zoomMin:i.zoomMin,boundingBox:w.fromEdges(e[2],e[1],e[0],e[3])})}d.push(l)}c[g]=d}var n=a[g];delete a[g];var f=n.length;while(f--){var o=n[f];o.callback(d,o.userData)}}},Hb=new function(){var c=0,a=[],d=qb.replace(/{year}/,(new Date).getFullYear());this.getCopyrights=function(i,f,j,h,g){if(i&&f&&j&&h&&g){var k=b.imageryCopyrightUrl.replace(/{imagerySet}/,i).replace(/{zoom}/,parseInt(j)).replace(/{minLat}/,f.getSouth()).replace(/{minLon}/,f.getWest()).replace(/{maxLat}/,f.getNorth()).replace(/{maxLon}/,f.getEast()).replace(/{credentials}/,h);a[c]={callback:g};W.getObjectAsync(k,e,c);c=++c%10}else g([d])};function e(b,e){if(e&&e.success&&b&&b.resourceSets&&b.resourceSets[0]&&b.resourceSets[0].resources&&b.resourceSets[0].resources[0]&&b.resourceSets[0].resources[0].imageryProviders){var c=e.userData,g=[d,b.resourceSets[0].resources[0].imageryProviders];if(a[c]){var f=a[c].callback;delete a[c];a[c]=null;f&&f(g)}}}};function ub(c,l){var e=this,h=qb.replace(/{year}/,(new Date).getFullYear()),a=[],b=0,d=[];function n(h,i,f){e.getCopyrights=m;var a=c.length;while(a--){var d=vb.getCachedImageryProviders(c[a]);if(d)g(d);else k(c[a])}!b&&j();e.getCopyrights(h,i,f)}function m(c,d,b){if(a.length)i(c,d,b);else b([h])}function i(l,g,j){var k=l.center,d=[],e=a.length;if(e)while(e--){var f=false,c=a[e],i=c.coverageAreas.length;while(i--&&!f){var b=c.coverageAreas[i];if(g>=b.zoomMin&&g<=b.zoomMax&&b.boundingBox.contains(k)){d.push(c.attribution);f=true}}}else d=[h];j(d)}function k(a){b++;l(function(b){if(b)vb.getImageryProviders(a,b,f);else f(null)})}function f(a){a&&g(a);b--;!b&&j()}function g(d){var f=d.length,i=a.length;while(f--){var c=false,b=d[f],g=i;while(g--&&!c){var e=a[g];if(e.attribution===b.attribution){c=true;var h=b.coverageAreas.length;while(h--)e.coverageAreas.push(b.coverageAreas[h])}}!c&&a.push(b)}}function j(){e.getCopyrights=i;var a=d.length;while(a--)d[a]();d.length=0}this.getCopyrights=n}function R(d,a){var c=d,b=qb.replace(/{year}/,(new Date).getFullYear());this.getCopyrights=function(e,f,d){a(function(a){if(a)Hb.getCopyrights(c,e,f,a,d);else d([b])})}}function zb(b,l,G,c,ab){var r=this;function H(a){a.stopPropagation();a.preventDefault()}if(ab){var u=k("div","display:none;z-index:0;position:absolute;border:1px dashed #000;background:#ccc");m(u).set_style({opacity:".5"})}var fb=.15,lb=500,Ab=1e3,L,n,I,T=.1,y=[],V=false,D=true,U=.9,j=null,M=null,x=null,N={x:0,y:0},X=new Date(0),nb=new Date(0),ob=new Date(0),mb=100,A=0,v=false,B=false,vb=[["dblclick",ib],["click",Eb],["mousewheel",Fb],["mousedown",Gb],["mousemove",Hb],["mouseup",ub],["losecapture",Cb],["contextmenu",Bb],["mouseover",Ib],["mouseout",Jb]],wb=[["touchstart",rb],["touchdown",qb],["MSPointerDown",qb],["touchmove",tb],["MSPointerMove",Db],["touchend",cb],["touchup",bb],["MSPointerUp",bb],["touchcancel",cb],["MSPointerCancel",bb]],K=[["keydown",Lb,null],["keyup",Mb,null],["blur",Z,null]],pb=null,xb=.003*g.scrollAdjustment,w=0,i=new d(0,0),C=0,hb=new Date(0),t,q,O,e=[],s=[],kb,o=[],F=0;r.enableOrDisableInertialScrolling=function(b,a){if(b){D=true;if(typeof a=="number")U=Math.min(Math.max(a,.01),.99)}else D=false};r.enableOrDisableUserInput=function(c,b){if(b){c=c&&!b.disableUserInput;jb(vb,c&&!b.disableMouseInput);jb(wb,c&&!b.disableTouchInput);c=c&&!b.disableKeyboardInput;var d,e;d=K.length;if(c)while(d--){e=K[d];if(!e[2])e[2]=a.addHandler(l,e[0],e[1])}else while(d--){a.removeHandler(K[d][2]);K[d][2]=null}v=b.disablePanning?true:false;B=b.disableZooming?true:false}};r.setTouchZoomThreshold=function(a){T=Math.min(a,.49)};function jb(c,d){var b,a;b=c.length;if(d)while(b--){a=c[b];G.add_event(a[0],a[1],false)}else while(b--){a=c[b];G.remove_event(a[0],a[1],false)}}function sb(){return j!=null&&(j.x!=0||j.y!=0)}function gb(a,c,b){if(a&&c&&b){var d=b.x-c.x,e=b.y-c.y;if(d!=0||e!=0){A+=a;if(!j)j=new J(d*1e3/A,e*1e3/A);else{j.x=.3*j.x+.7*d*1e3/A;j.y=.3*j.y+.7*e*1e3/A}A=0}else A+=a}}r.clearInertialScrolling=function(){x=null;j=null};function db(a,c){if(a&&c&&!d.areEqual(a,c)){var e=l.getViewportX(),f=l.getViewportY(),h=new d(a.x-e,a.y-f),i=new d(c.x-e,c.y-f),g=b.getCurrentCamera().getViewportToWorld().transform(h);b.setAlignedCamera(b.getCurrentCamera().getCrs(),g,i,b.getCurrentCamera().getWidth(),b.getCurrentCamera().getHeading(),false)}}r.processPendingUserInput=function(){var g=new Date,c=M?g-M:null;M=g;var k,m=b.getCurrentCamera().getWidth(),w=b.getCurrentCamera().getLookAt();if(C&&!B){r.clearInertialScrolling();m*=C<0?2:.5;if(m!==b.getTargetCamera().getWidth())k=true}if((i.x||i.y)&&!v){r.clearInertialScrolling();w=b.getCurrentCamera().getViewportToWorld().transform(new d(i.x*fb*l.getWidth(),i.y*fb*l.getHeight()));if(Math.abs(i.x)>.9&&Math.abs(i.x)<3)i.x=i.x*1.01;if(Math.abs(i.y)>.9&&Math.abs(i.y)<3)i.y=i.y*1.01;k=true}if(k){g=new Date;if((M-hb)/1e3>b.getCameraAnimationDuration()/3){b.setAlignedCamera(b.getCurrentCamera().getCrs(),w,null,m,b.getCurrentCamera().getHeading(),true);hb=g}}if(q){if(O&&!B){var H=l.getPageX(),I=l.getPageY(),f=E.union(new d(q.x-H,q.y-I),new d(t.x-H,t.y-I));u.style.left=f.x+"px";u.style.top=f.y+"px";u.style.width=f.width+"px";u.style.height=f.height+"px";u.style.display="block";G.element().appendChild(u)}else if(!v){db(q,t);D===true&&gb(c,q,t);q=t}}else if(o.length>0){var a=o.length;if(e.length>=a){switch(a){case 1:if(!v){db(o[0],e[0]);D===true&&gb(c,o[0],e[0])}break;case 2:var N=v?z():W(o),K=b.getCurrentCamera().getViewportToWorld().transform(N),P=v?z():W(e);if(!e[0]||!e[1]||!o[0]||!o[1])return;var n=0;if(!B)n=h.log2(d.distance(e[0],e[1])/d.distance(o[0],o[1]));var y=0;if(s.length>1&&b.isRotationEnabled()){var A=new J(s[1].x-s[0].x,s[1].y-s[0].y),F=new J(e[1].x-e[0].x,e[1].y-e[0].y),L=Math.atan2(F.y,F.x)-Math.atan2(A.y,A.x);y=kb-b.getCurrentCamera().getHeading()-L*180/Math.PI}b.setCamera(b.getCurrentCamera().getAlignedCamera(n,K,P,y),false);_lastTouchZoomDelta=n}while(a--)o[a]=e[a]}}else if(sb()){if(x){var p=new d(x.x+j.x*c/1e3,x.y+j.y*c/1e3);db(x,p);x=p}if(j){j.x*=U;j.y*=U;if(Math.abs(j.x)<5)j.x=0;if(Math.abs(j.y)<5)j.y=0}sb()&&b.ensureUpdateDispatched()}};function eb(b){var a=m.Screen.get_mouse_pos(b);return new d(a.x-l.getViewportX(),a.y-l.getViewportY())}function z(){return new d(0,0)}function p(p,j,f,k){var o=false;if(a.hasHandler(b,j)){var h;if(!k)if(f.touches&&f.touches[0])h=new d(f.touches[0].pageX,f.touches[0].pageY);else if(e&&e[0])h=e[0];if(!h)h=m.Screen.get_mouse_pos(f);var q=f.wheelDelta?f.wheelDelta:0,g,i;if(c){if(p)g=c.getEntityForTarget(p);if(!g)g=c.getEntityForTarget(f.target);if(g)i=c.getTargetType(g)}if(!i){g=l;i=S.map}var n=new Y(l,i,g,j,h.x,h.y,q,!k,f);a.invoke(b,j,n);o=n.handled}return o}function Lb(a){if(a.ctrlKey)switch(a.keyCode){case 37:b.setAlignedCamera(b.getTargetCamera().getCrs(),b.getTargetCamera().getLookAt(),null,b.getTargetCamera().getWidth(),b.getTargetCamera().getHeading()+90,true);break;case 39:b.setAlignedCamera(b.getTargetCamera().getCrs(),b.getTargetCamera().getLookAt(),null,b.getTargetCamera().getWidth(),b.getTargetCamera().getHeading()-90,true)}else switch(a.keyCode){case 37:if(i.x>-1)i.x=-1;a.keyboardHandled=true;break;case 39:if(i.x<1)i.x=1;a.keyboardHandled=true;break;case 38:if(i.y>-1)i.y=-1;a.keyboardHandled=true;break;case 40:if(i.y<1)i.y=1;a.keyboardHandled=true;break;case 109:case 189:C=-1;break;case 107:case 187:case 61:C=1}b.ensureUpdateDispatched()}function Mb(a){switch(a.keyCode){case 37:case 39:i.x=0;break;case 38:case 40:i.y=0;break;case 109:case 189:case 107:case 187:case 61:C=0}b.ensureUpdateDispatched()}function Z(){i.x=0;i.y=0;C=0}function ib(a){if(!p(null,"dblclick",a,true)&&!B){if(c)c.onMouseDoubleClick(a);var d=v?z():eb(a),e=b.getCurrentCamera().getViewportToWorld().transform(d);b.setAlignedCamera(b.getCurrentCamera().getCrs(),e,null,b.getCurrentCamera().getWidth()/2,b.getCurrentCamera().getHeading(),true)}H(a)}function Eb(a){if(!p(null,"click",a,true)&&c){c.onMouseClick(a);if(g.emulateDblClick){var b=m.Screen.get_mouse_pos(a);if(new Date-X<lb&&b.x===N.x&&b.y===N.y){N={x:0,y:0};X=new Date(0);ib(a)}else{N=b;X=new Date}}}}function Bb(a){if(!p(null,"rightclick",a,true)&&c)c.onMouseRightClick(a)}function Fb(c){if(!p(null,"mousewheel",c,true)&&!B){r.clearInertialScrolling();var j=new Date,d=j-pb;pb=j;if(c.wheelDelta){var g=v?z():eb(c),i=b.getCurrentCamera().getViewportToWorld().transform(g),e=xb*c.wheelDelta*(c.wheelDelta>0?1:.75);if(d>200){d=200;w=e/d}else w=(w+e/d)/2;w=Math.min(.009,w);w=Math.max(-.006,w);var h=b.getCurrentCamera().getMercatorZoom(),a=h+w*(w>0?400:250);if(e>0)a=Math.min(b.getInternalMaxZoom(),Math.ceil(a));else a=Math.max(b.getInternalMinZoom(),Math.floor(a));var l=f.mercatorZoomToWidth(a,b.getCurrentCamera().getCrs(),i),k=(a-h)/w*1.5;b.setAlignedCamera(b.getCurrentCamera().getCrs(),i,g,l,b.getCurrentCamera().getHeading(),k)}H(c)}}function Gb(a){if(!p(null,"mousedown",a,true)){Z();b.suspendSceneChanges(false);if(c)c.onMouseDown(a);O=ab&&(a.shiftKey===true||a.which===2);t=m.Screen.get_mouse_pos(a);r.clearInertialScrolling();q=t;m.Events.capture_mouse(this);V=true;if(!O)G.set_style({cursor:b.getCursors().Grabbing});else G.set_style({cursor:b.getCursors().SEResize})}H(a)}function Hb(a){if(!p(null,"mousemove",a,true))if(q){t=m.Screen.get_mouse_pos(a);b.ensureUpdateDispatched();nb=new Date;H(a)}}function Cb(a){V&&ub(a)}function ub(f){if(!p(f.captureTarget,"mouseup",f,true)){b.allowSceneChanges();if(D===true){var s=new Date,k=s-nb;if(k<mb)x=t;else r.clearInertialScrolling()}b.ensureUpdateDispatched();if(c)c.onMouseUp(f);if(O&&q)if(d.distance(q,t)>10){var a=b.getCurrentCamera(),g=l.getViewportX(),h=l.getViewportY(),e=E.union(new d(q.x-g,q.y-h),new d(t.x-g,t.y-h)),n=Math.max(e.width/l.getWidth(),e.height/l.getHeight()),i=v?z():e.getCenter(),j=a.getViewportToWorld().transform(i),o=a.getWidth()*n;b.setAlignedCamera(a.getCrs(),j,null,o,a.getHeading(),true,true)}}if(ab){u.style.display="none";u.parentNode&&u.parentNode.removeChild(u)}G.set_style({cursor:b.getCursors().Grab});q=null;V=false;m.Events.release_mouse()}function Ib(a){if(!p(null,"mouseover",a,true)&&c)c.onMouseOver(a)}function Jb(a){if(!p(null,"mouseout",a,true)&&c)c.onMouseOut(a)}function W(a){var b=l.getViewportX(),c=l.getViewportY();return a.length>1?new d((a[0].x+a[1].x)/2-b,(a[0].y+a[1].y)/2-c):a.length?new d(a[0].x-b,a[0].y-c):new d(0,0)}function R(c,e,f){for(var d={touches:[],target:c.target,stopPropagation:function(){this.baseEvent.stopPropagation()},preventDefault:function(){this.baseEvent.preventDefault()},baseEvent:c},b=false,a=0;a<y.length;a++)if(y[a].pointerId==c.pointerId)if(e){y.splice(a,1);b=true}else{y[a]=c;b=true}if(f&&!b){y.push(c);b=true}if(b){for(var a=0;a<y.length;a++)d.touches.push({pageX:y[a].clientX,pageY:y[a].clientY});return d}return null}function bb(a){if(a.pointerType==4)return;a.currentTarget.msReleasePointerCapture(a.pointerId);var b=R(a,true,false);b&&cb(b)}function qb(a){if(a.pointerType==4)return;if(a.preventManipulation){a.preventManipulation();a.currentTarget.msSetPointerCapture(a.pointerId)}a.preventMouseEvent&&a.preventMouseEvent();rb(R(a,false,true))}function Db(b){if(b.pointerType==4)return;var a=R(b,false,false);a&&tb(a)}function rb(f){Z();Q();if(!p(null,"mousedown",f,false)){b.suspendSceneChanges(true);if(c)c.onTouchStart(f);r.clearInertialScrolling();var a=Math.min(2,f.touches.length);if(F===0&&a===2)F=b.getCurrentCamera().getMercatorZoom();if(o.length===0&&a===1){n=new d(f.touches[0].pageX,f.touches[0].pageY);n.target=f.target;n.start=new Date;I=setTimeout(yb,Ab)}while(a--){e[a]=new d(f.touches[a].pageX,f.touches[a].pageY);o[a]=e[a];s[a]=e[a]}kb=b.getCurrentCamera().getHeading()}H(f)}function tb(a){if(a.touches.length>1||n&&(Math.abs(a.touches[0].pageX-n.x)>20||Math.abs(a.touches[0].pageY-n.y)>20)){P();Q()}if(a.touches.length>1||!p(null,"mousemove",a,false)){var c=o.length;if(c){c=a.touches.length;while(c--)e[c]=new d(a.touches[c].pageX,a.touches[c].pageY)}}b.ensureUpdateDispatched();ob=new Date;H(a)}function cb(g){Q();if(!p(null,"mouseup",g,false)){if(c)c.onTouchEnd(g);var h;if(n){Kb();if(L&&new Date-L.start<lb){h=new d(n.x-l.getViewportX(),n.y-l.getViewportY());zb();P()}else L=n}if(o.length===1&&D===true){var y=new Date,w=y-ob;if(w<mb)x=e[0];else r.clearInertialScrolling()}o.length=0;if(g.touches.length){r.clearInertialScrolling();e[0]=o[0]=new d(g.touches[0].pageX,g.touches[0].pageY)}b.allowSceneChanges();var i,f,a=b.getTargetCamera().getWidth(),t=b.getTargetCamera().getHeading();if(h&&!B){f=v?z():h;i=b.getCurrentCamera().getViewportToWorld().transform(f);a=a/2}else{f=v?z():W(e);i=b.getCurrentCamera().getViewportToWorld().transform(f);if(s.length>1&&b.isRotationEnabled()){var m=new J(s[1].x-s[0].x,s[1].y-s[0].y),q=new J(e[1].x-e[0].x,e[1].y-e[0].y),u=Math.atan2(q.y,q.x)-Math.atan2(m.y,m.x);if(Math.abs(u)>.7)F=0;s.length=0}if(F!==0&&T>0){var k=b.getCurrentCamera().getMercatorZoom()-F;F=0;var j=Math.abs(k);if(j>=T&&j<.5)if(k>0)a=a/2;else a=a*2}}b.setAlignedCamera(b.getTargetCamera().getCrs(),i,f,a,t,true)}}function Q(){if(I){clearInterval(I);I=null}}function P(){L=null;n=null}function Kb(){if(!p(null,"click",n,false)&&c)c.onTap(n)}function zb(){if(!p(null,"dblclick",n,false)&&c)c.onDoubleTap(n)}function yb(){if(n){if(!p(null,"rightclick",n,false)&&c)c.onTapAndHold(n);P()}}}o.ModeEventHandler=zb;var Kb=new function(){var e=this,d=256,c=180;this.createContributor=function(i){var d=b.enhancedBirdseyeUriFormat,g=b.enhancedBirdseyeWithLabelsUriFormat,h=new ub(["Aerial","Birdseye"],i),f=new ub(["Road","Aerial","Birdseye"],i),e={},c;c={};e[r.northUpHeading]=c;c[u.hidden]=a(G.enhancedBirdseyeNorthUp,d.replace("{dir}","dir_n"),x.horizontal,h);c[u.visible]=a(G.enhancedBirdseyeNorthUp,g.replace("{dir}","dir_n"),x.horizontal,f,d.replace("{dir}","dir_n"));c={};e[r.westUpHeading]=c;c[u.hidden]=a(G.enhancedBirdseyeWestUp,d.replace("{dir}","dir_w"),x.vertical,h);c[u.visible]=a(G.enhancedBirdseyeWestUp,g.replace("{dir}","dir_w"),x.vertical,f,d.replace("{dir}","dir_w"));c={};e[r.southUpHeading]=c;c[u.hidden]=a(G.enhancedBirdseyeSouthUp,d.replace("{dir}","dir_s"),x.horizontal,h);c[u.visible]=a(G.enhancedBirdseyeSouthUp,g.replace("{dir}","dir_s"),x.horizontal,f,d.replace("{dir}","dir_s"));c={};e[r.eastUpHeading]=c;c[u.hidden]=a(G.enhancedBirdseyeEastUp,d.replace("{dir}","dir_e"),x.vertical,h);c[u.visible]=a(G.enhancedBirdseyeEastUp,g.replace("{dir}","dir_e"),x.vertical,f,d.replace("{dir}","dir_e"));return{priority:30,minZoomLevel:0,getScene:function(d,g,f,c,b,a){return c>this.minZoomLevel?e[r.snapToCardinalHeading(b)][a]:null}}};function a(e,h,i,f,j,g){var a=M.createQuadKeyTilePyramid(d,c,h,i,g);a.projectingCamera=e;return new y(e.getAlignedCamera(b.minMercatorZoom),a,b.maxMercatorZoom-b.minMercatorZoom,"EnhancedBirdseye",f)}};function Gb(g){var m=this,v=17.1,e=new db(100),r=19,t=new db(100),k=45,n=400,d=256,j=b.nativeBirdseyeMetadataUrl.replace("{zoom}","20"),p;this.priority=40;this.getScene=function(){if(!p){p=true;g(function(b){j=j.replace("{credentials}",b);m.getScene=z;a.invoke(m,"newsceneavailable")})}return null};function z(o,A,z,g,c,p){if(g>=v){var y=B.toEllipsoid(new l(A,z)),d=i.wrap(i.fromLocation(y));if(s(o,d,g,c,p))return o;var D=1<<r,t=q.mercatorXYToTileId(d,r),b=q.tileIdToCacheKey(t),n=Math.round(h.normalizeDegrees(c)/k)*k%360,a=e.get(b)||[],x=a.length,f;while(x--){f=a[x];if(s(f,d,g,c,p))return f}var u="h"+n.toFixed();if(!a[u]){a[u]=true;e.insert(b,a);var m=q.tileIdToLocation(t),C=j.replace("{centerpoint}",m.latitude.toFixed(6)+","+m.longitude.toFixed(6)).replace("{heading}",n.toFixed(0));W.getObjectAsync(C,w,b)}}return null}function w(b,d){var f=d.userData;if(d.success&&b&&b.statusCode===200&&b.resourceSets&&b.resourceSets.length){var c=b.resourceSets[0];if(c.resources&&c.resources.length){var g=e.get(f)||[];x(c.resources[0],g);e.insert(f,g);a.invoke(m,"newsceneavailable")}}}function x(r,T){if(r.bes&&r.bes.bec&&r.bes.bei){var j=r.bes,J=j.s.toString(),e=j.bei,a=j.bec,p=t.get(J);if(!p){p=[];var v=2*Math.ceil(e.piw/(2*d)),C=2*Math.ceil(e.pih/(2*d)),z=v*d,s=new c(a.qcx,a.qcy,a.qcz),G=new c(a.qdx,a.qdy,a.qdz),V=new c(a.qex,a.qey,a.qez),q=pb.toLocation(s),O=B.getAltitudeAtLatLon(q.latitude,q.longitude),F=pb.fromLocation(new l(q.latitude,q.longitude,O,K.ellipsoid)),Q=P.fromNormal(F,pb.getUpVector(F)),L=Q.intersectWithLine(s,c.add(s,G)),H=c.subtract(L,s).getLength(),A=z/e.piw*(a.ox/(2*a.ol)),W=2*Math.atan(A),U=2*H*A,S=f.fromDirectionVector(pb,L,U,G,V,1/H),w=S.convertCoordinateReferenceSystem(i),M=(e.piw-n)/z,I=(e.pih-n)/z,D=new E(-M/2-a.opx,-I/2-a.opy,M,I),k,m,x;m=o(b.nativeBirdseyeUriFormat.replace("{quadkey}",j.q).replace("{runtimeindex}",j.ri),v,C,j.l,a.opx*e.piw,a.opy*e.pih);m.projectingCamera=w;x=w.getAlignedCamera(h.log2(m.getWidth()/b.zoomOriginWidth)-1);k=new y(x,m,1,"NativeBirdseye",new R("Birdseye",g));k.nativeBirdseyeFrustumRect=D;k.labelOverlay=u.hidden;p.push(k);m=o(b.nativeBirdseyeWithLabelsUriFormat.replace("{quadkey}",j.q).replace("{runtimeindex}",j.ri),v,C,j.l,a.opx*e.piw,a.opy*e.pih);m.projectingCamera=w;k=new y(x,m,1,"NativeBirdseye",new R("BirdseyeWithLabels",g));k.nativeBirdseyeFrustumRect=D;k.labelOverlay=u.visible;p.push(k)}t.insert(J,p);var N=p.length;while(N--)T.push(p[N])}}function s(a,e,f,d,c){if(a&&a.nativeBirdseyeFrustumRect&&a.labelOverlay===c&&h.distanceDegrees(d,a.nativeCamera.getHeading())<k&&f>=a.nativeCamera.getMercatorZoom()-.5){var b=a.tilePyramid.projectingCamera.getWorldToFrustum().transform(e);if(a.nativeBirdseyeFrustumRect.contains(b))return true}return false}function o(h,a,b,e,i,j){var f=Math.ceil(a/2),g=Math.ceil(b/2),c=new M(a*d,b*d,d,d,0,0,i,j,function(d){var j,i,k;switch(d.levelOfDetail){case c.getMaxLevelOfDetail()-1:i=f;k=g;j=e-1;break;case c.getMaxLevelOfDetail():i=a;k=b;j=e}if(j)if(d.x>=0&&d.x<i&&d.y>=0&&d.y<k)return h.replace("{subdomain}",(d.y&1)*2+(d.x&1)).replace("{level}",j).replace("{index}",i*d.y+d.x);return null});return c}}I.mercator="m";I.auto="auto";if(b.allowOrdnanceSurvey)I.ordnanceSurvey="os";if(b.allowCollinsBart)I.collinsBart="cb";a.addHandler(kb,"mapcreationstart",function(t){var d=t.map,s=t.options,c=d.getCredentials,a=new Lb,z=y.createMercatorScene(b.roadUriFormat,"Road",new R("Road",c),b.roadUnlabeledUriFormat),f={priority:10,getScene:function(){return z}},h={};h[u.hidden]=y.createMercatorScene(b.aerialUriFormat,"Aerial",new R("Aerial",c));h[u.visible]=y.createMercatorScene(b.aerialWithLabelsUriFormat,"Aerial",new R("AerialWithLabels",c),b.aerialUriFormat);var e={priority:20,maxZoomLevel:4.5,getScene:function(c,e,d,b,f,a){return b<this.maxZoomLevel?h[a]:null}},g=Kb.createContributor(c),k=new Gb(c),o=new U(I.mercator,a);o.activated=function(){a.setSceneContributors([])};var q=new U(I.road,a);q.activated=function(){a.setSceneContributors([f])};var p=new U(I.aerial,a);p.activated=function(){e.maxZoomLevel=1e3;a.setSceneContributors([e])};if(b.allowCollinsBart){var x=new xb(y.createMercatorScene(b.collinsBartUriFormat,"CollinsBart",new R("Road",c)),b.collinsBartMinZoom-.5,b.collinsBartMaxZoom+.5,b.collinsBartBounds,15),n=new U(I.collinsBart,a);n.activated=function(){a.setSceneContributors([f,x])};d.registerMapType(n)}if(b.allowOrdnanceSurvey){var v=new xb(y.createMercatorScene(b.ordnanceSurveyUriFormat,"OrdnanceSurvey",new R("Road",c)),b.ordnanceSurveyMinZoom-.5,b.ordnanceSurveyMaxZoom+.5,b.ordnanceSurveyBounds,15),l=new U(I.ordnanceSurvey,a);l.activated=function(){a.setSceneContributors([f,v])};d.registerMapType(l)}var j=new U(I.auto,a);if(s.disableBirdseye!==true&&b.defaultAerialTiltOn===true)j.activated=function(){e.maxZoomLevel=4.5;g.minZoomLevel=16.5;a.setSceneContributors([f,e,g,k])};else j.activated=function(){var b={priority:20,maxZoomLevelBand1:4.5,minZoomLevelBand2:16.5,getScene:function(c,e,d,a,f,b){return a<this.maxZoomLevelBand1||a>this.minZoomLevelBand2?h[b]:null}};a.setSceneContributors([b,f])};var r=new U(I.birdseye,a);r.activated=function(){if(s.disableBirdseye!==true){e.maxZoomLevel=1e3;g.minZoomLevel=12.5;a.setSceneContributors([e,g,k])}else{e.maxZoomLevel=1e3;a.setSceneContributors([e])}};d.registerMapType(o);d.registerMapType(j);d.registerMapType(q);d.registerMapType(p);d.registerMapType(r);var i={};i[u.hidden]=y.createMercatorScene(b.fbUnlabeledUriFormat,"Road",new R("Road",c));i[u.visible]=y.createMercatorScene(b.fbUriFormat,"Road",new R("Road",c),b.fbUnlabeledUriFormat);var w={priority:10,getScene:function(b,d,c,f,e,a){return i[a]}},m=new U("fb",a);m.activated=function(){a.setSceneContributors([w])};d.registerMapType(m)});delete window.Microsoft.Maps.initMapCode;PRF.add("Map core initialized")};Microsoft.Maps.Globals&&Microsoft.Maps.initMapCode&&window.Microsoft.Maps.initMapCode();if(Microsoft.Maps.Globals.onloadcallback){var onLoadCallback=Microsoft.Maps.Globals.onloadcallback;typeof window[onLoadCallback]==="function"&&window[onLoadCallback].apply()}