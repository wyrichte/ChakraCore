<!doctype>
<html>
<head>
</head>
<body>
    <h1>
        "TOP"</h1>
    <button onclick="CheckInProc()">
        Click to check implicit/explicit contexts intra-process (using the iframe below)</button><br>
    <button onclick="CheckCrossProc()">
        Click to check implicit/explicit contexts cross-process (using a window.open call)</button><br>
    <div id="foo" />
    <iframe id="F01" name="iFrame_1" src='649441sub.htm' width="400" height="300"></iframe>
    <script type="text/javascript">

        window.name = "TOP";
        var one = { one: 1, two: 2, three: 3 };

        var newWin = null;
        function CheckCrossProc() {
            newWin = window.open("sub.htm", "SubWindow");
            setTimeout(function () {
                DoTest(newWin);
            }, 1000);
        }

	function output(result) {
		alert(result)
	}

        function CheckInProc() {
            DoTest(document.getElementById('F01').contentWindow);
        }

	function testGetter() { return 20; }
	function test0(win) {
            var img;
	    img = new Image();
	    img.src = "649441test.jpg";
	    img.id = 'myImage';
            img.onload= testGetter;
	    document.body.appendChild(img);
	    Object.defineProperty(img, "mytest", {enumerable: true, get: testGetter, set:function() {return undefined;}});
	    win.remotGetter = testGetter;
	    img.mytest = obj;
	    
	    output(img.mytest);
        }
        function DoTest(win) {
            var output = document.getElementById("foo");


	    tests = [test0];
            try {
                output.innerHTML = "";
                for (var oneTest in tests) {
                    tests[oneTest](win);
                }
                output.innerHTML = output.innerHTML + "<p/>succeeded";
            }
            catch (e) {
                output.innerHTML = output.innerHTML + "test failed:" + e.message;
            }


        }

        function testagain() {
            document.write("cleanup");
            var output = document.createElement("div");
            document.body.appendChild(output);
            try {
                output.innerHTML = "";
                for (var oneTest in tests) {
                    tests[oneTest]();
                }
                output.innerHTML = output.innerHTML + "<p/>failed. should have exception";
            }
            catch (e) {
                output.innerHTML = output.innerHTML + "test succeed:" + e.message;
            }
        }

    </script>
</body>
</html>
