TARGETNAME=TsGen
TARGETTYPE=PROGRAM

USE_NOTHROW_NEW=1


_NT_TARGET_VERSION = $(_NT_TARGET_VERSION_WIN7)

JSGEN=1

!IF "$(_BUILDARCH)" == "arm" || "$(_BUILDARCH)" == "arm64"
NT_SIGNCODE=1
TEST_CODE=1
!ENDIF

WARNING_LEVEL=W4

# Turns on fretest for test code
!include $(JSCRIPT_ROOT)\jslibtest.inc

# 
# Fusionized
# 
SXS_ASSEMBLY_NAME=TSGen
SXS_ASSEMBLY_LANGUAGE_INDEPENDENT=1
SXS_MANIFEST=TSGen.Manifest 
SXS_MANIFEST_IN_RESOURCES=1
SXS_NO_BINPLACE=1 

INCLUDES=$(INCLUDES);$(COREINCLUDES);$(SDK_LIB_PATH);$(SDK_INC_PATH)\atl30;$(INTERNAL_SDK_INC_PATH)\clr45;..\..\Lib\Common\Memory;$(COM_INC_PATH)\winrt;$(COM_INC_PATH)\midlrt;
USER_INCLUDES=$(JS_LIBS_PARSER_INC);..\..\Lib\Common\DataStructures;..\..\Lib

C_DEFINES =$(C_DEFINES) -DWINNT -DUNICODE -D_UNICODE -DJSGEN

LINKER_STACKSIZE=/STACK:0x100000,0x2000

MSC_WARNING_LEVEL=-$(WARNING_LEVEL:W3=W4)

UMENTRY = wmain
UMTYPE = console

# Make sure that common.memory.lib is passed to linker prior to msvcrt so that our new/delete 
# do not cause 'already defined in msvcrt.lib error'.
CRTLIBS= \
    $(OBJECT_JSCRIPT_DIR)\lib\common\memory\$(JS_LIBTYPE)\$(O)\jscript.common.memory.lib

TARGETLIBS=     \
!IF (!$(FREEBUILD) || defined(FRETEST) || defined(NTTESTENV)) && "$(TARGET_DIRECTORY)" != "arm" && "$(TARGET_DIRECTORY)" != "arm64"
    ..\..\tools\external\lib\$(TARGET_DIRECTORY)\jitprofiling.lib \
!ENDIF
    $(SHELL_LIB_PATH)\CommonUtilityLibrary.lib       \
    $(OBJECT_INETCORE_DIR)\jscript\core\lib\common\codex\$(O)\Chakra.Common.Codex.lib \
    $(INETCORE_LIB_PATH)\iertutilp.lib \
    $(INETCORE_LIB_PATH)\IESettingsId.lib \
    $(INETCORE_LIB_PATH)\IESettingsApi.lib \
    $(JS_LIBS_COMMON) \
    $(JS_LIBS_WINRT) \
    $(INTERNAL_SDK_LIB_PATH)\clr40\mscoree.lib \
    $(SDK_LIB_PATH)\muiload.lib \
    $(SDK_LIB_PATH)\oleaut32.lib \
    $(SDK_LIB_PATH)\ole32.lib \
    $(SDK_LIB_PATH)\Uuid.lib \
    $(SDK_LIB_PATH)\Shlwapi.lib \
    $(SDK_LIB_PATH)\version.lib \
    $(SDK_LIB_PATH)\xmllite.lib \
!if !$(FREEBUILD)
    $(SDK_LIB_PATH)\dbghelp.lib \
    $(SDK_LIB_PATH)\user32.lib \
!endif

SOURCES= \
    BinaryFeatureControlOverrides.cpp \
    TsGen.cpp \
    TsGen.rc \
    Wrapper.cpp \
    TSFileDumper.cpp \
    TSWrapper.cpp \
    Settings.cpp \
    StringUtils.cpp \
    XmlReader.cpp


PRECOMPILED_INCLUDE=stdafx.h
PRECOMPILED_SOURCEFILE=stdafx.cpp
PRECOMPILED_CXX=1

MUI_DRV=1

PASS2_BINPLACE= -:DEST projection\winrt $(OBJ_PATH)\$(O)\tsgen.exe
