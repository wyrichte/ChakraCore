USE_NOTHROW_NEW=1 
TARGETNAME=JsGen
TARGETTYPE=PROGRAM

_NT_TARGET_VERSION = $(_NT_TARGET_VERSION_WIN7)

JSGEN=1  

!IF "$(_BUILDARCH)" == "arm" || "$(_BUILDARCH)" == "arm64"
NT_SIGNCODE=1
TEST_CODE=1
!ENDIF

# Turns on fretest for test code
!include $(JSCRIPT_ROOT)\jslibtest.inc

# 
# Fusionized
# 
SXS_ASSEMBLY_NAME=JSGen
SXS_ASSEMBLY_LANGUAGE_INDEPENDENT=1
SXS_MANIFEST=JSGen.Manifest 
SXS_MANIFEST_IN_RESOURCES=1
SXS_NO_BINPLACE=1 

INCLUDES=$(INCLUDES);$(COREINCLUDES);$(SDK_LIB_PATH);$(SDK_INC_PATH)\atl30;$(INTERNAL_SDK_INC_PATH)\clr45;..\..\Lib\Common\Memory;$(COM_INC_PATH)\winrt;$(COM_INC_PATH)\midlrt;
USER_INCLUDES=$(JS_LIBS_PARSER_INC);..\..\Lib\Common\DataStructures;..\..\Lib

C_DEFINES =$(C_DEFINES) -DWINNT -DUNICODE -D_UNICODE -DJSGEN

LINKER_STACKSIZE=/STACK:0x100000,0x2000

UMENTRY = wmain
UMTYPE = console

# Make sure that common.memory.lib is passed to linker prior to msvcrt so that our new/delete 
# do not cause 'already defined in msvcrt.lib error'.
CRTLIBS= \
    $(OBJECT_JSCRIPT_DIR)\lib\common\memory\$(JS_LIBTYPE)\$(O)\jscript.common.memory.lib

TARGETLIBS=     \
    $(ONECORE_SDK_LIB_VPATH)\onecore.lib \
    $(MINCORE_SDK_LIB_PATH)\mincore_fw.lib    \
    $(MINCORE_PRIV_SDK_LIB_VPATH)\mincore_private.lib \
    $(SHELL_LIB_PATH)\CommonUtilityLibrary.lib       \
    $(OBJECT_INETCORE_DIR)\lib\codex\iel1\$(O)\codex_iel1.lib \
    $(INETCORE_LIB_PATH)\iertutilp.lib \
    $(INETCORE_LIB_PATH)\IESettingsId.lib \
    $(INETCORE_LIB_PATH)\IESettingsApi.lib \
    $(OBJECT_INETCORE_DIR)\lib\common\iel1_sp\$(O)\ieshare_common_iel1.lib \
    $(JS_LIBS_COMMON) \
    $(JS_LIBS_WINRT) \
    $(INTERNAL_SDK_LIB_PATH)\clr45\mscoree.lib \
    $(SDK_LIB_PATH)\muiload.lib \
    $(SDK_LIB_PATH)\ole32.lib \
    $(SDK_LIB_PATH)\Uuid.lib \
    $(SDK_LIB_PATH)\version.lib \
!IF (!$(FREEBUILD) || defined(FRETEST) || defined(NTTESTENV)) && "$(TARGET_DIRECTORY)" != "arm" && "$(TARGET_DIRECTORY)" != "arm64"
    ..\..\tools\external\lib\$(TARGET_DIRECTORY)\jitprofiling.lib \
!ENDIF
!if !$(FREEBUILD)
    $(MINCORE_PRIV_SDK_LIB_VPATH)\ext-ms-win-ntuser-dialogbox-l1.lib \
    $(SDK_LIB_PATH)\dbghelp.lib \
    $(SDK_LIB_PATH)\user32.lib \
!endif

DELAYLOAD = $(DELAYLOAD) \
!IF (!$(FREEBUILD))
    ext-ms-win-ntuser-dialogbox-l1-1-0.dll; \
!ENDIF

ALLOW_NT_STYLE_DLOAD_ERROR_HANDLER=1
DLOAD_ERROR_HANDLER=kernelbase.dll

SOURCES= \
    BinaryFeatureControlOverrides.cpp \
    JsGen.cpp \
    JavaScriptStubDumper.cpp \
    JsGen.rc


PRECOMPILED_INCLUDE=stdafx.h
PRECOMPILED_SOURCEFILE=stdafx.cpp
PRECOMPILED_CXX=1

MUI_DRV=1

PASS2_BINPLACE= -:DEST projection\winrt $(OBJ_PATH)\$(O)\jsgen.exe
